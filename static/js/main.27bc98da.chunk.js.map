{"version":3,"sources":["old_infrastructure/const.js","color_picker.js","text_splitter.js","old_infrastructure/functions.js","old_infrastructure/widgets.js","Markdown.js","Common.js","react-lazyload/src/utils/event.js","react-lazyload/src/utils/scrollParent.js","react-lazyload/src/index.jsx","react-lazyload/src/utils/debounce.js","react-lazyload/src/utils/throttle.js","cache.js","flows_api.js","Message.js","login.js","Config.js","delete_account.js","UserAction.js","Flows.js","polling.js","PushMessage.js","Title.js","Sidebar.js","PressureHelper.js","App.js","ErrorBoundary.js","registerServiceWorker.js","index.js"],"names":["API_ROOT","process","ColorPicker","this","names","current_h","Math","random","name","toLowerCase","PID_RE","NICKNAME_RE","URL_RE","split_text","txt","rules","forEach","rule","regex","concat","apply","map","part","content","split","seg","test","filter","get_json","res","ok","Error","status","statusText","text","then","t","JSON","parse","e","console","error","trace","log","SyntaxError","substr","API_VERSION_PARAM","encodeURIComponent","floor","Date","pad2","x","format_time","time","getMonth","getDate","getHours","getMinutes","getSeconds","chinese_format","buildFormatter","chineseStrings","Time","props","stamp","className","date","formatter","title","toLocaleString","timeZone","hour12","short","TitleLine","md","MarkdownIt","html","linkify","breaks","inline","highlight","str","lang","hljs","getLanguage","value","__","utils","escapeHtml","render","escape_regex","string","replace","build_highlight_re","option","RegExp","join","ColoredSpan","style","colors","children","normalize_url","url","PureComponent","HighlightedMarkdown","processInstructions","shouldProcessNode","node","processNode","index","key","currentLevel","HeadingTag","href","attribs","target","rel","type","parent","originalText","data","hl_rules","search_param","push","splitted","Fragment","idx","p","onClick","preventDefault","show_pid","substring","color_picker","get","HtmlToReact","ProcessNodeDefinitions","React","processDefaultNode","parser","Parser","author","match","renderedMarkdown","renderMd","parseWithInstructions","rawMd","Component","window","TEXTAREA_BACKUP","SafeTextarea","state","on_change_bound","on_change","bind","on_keydown_bound","on_keydown","clear","area_ref","createRef","change_callback","submit_callback","on_submit","setState","id","event","ctrlKey","altKey","current","focus","ref","onChange","onKeyDown","pwa_prompt_event","PromotionBar","is_ios","navigator","userAgent","matchMedia","matches","standalone","prompt","BrowserWarningBar","cr_version","exec","addEventListener","ClickHandler","moved","init_y","init_x","on_begin_bound","on_begin","on_move_bound","on_move","on_end_bound","on_end","MOVE_THRESHOLD","last_fire","popup_anchor","document","getElementById","touches","screenY","screenX","abs","do_callback","length","callback","onTouchStart","onMouseDown","onTouchMove","onMouseMove","on","el","eventName","opts","attachEvent","call","off","removeEventListener","detachEvent","HTMLElement","documentElement","excludeStaticParent","position","overflowRegex","parentNode","ownerDocument","getComputedStyle","overflow","overflowX","overflowY","defaultBoundingClientRect","LISTEN_FLAG","listeners","pending","passiveEventSupported","Object","defineProperty","delayType","passiveEvent","capture","passive","checkVisible","component","ReactDom","findDOMNode","scrollParent","parentTop","parentHeight","getBoundingClientRect","top","height","windowInnerHeight","innerHeight","clientHeight","intersectionTop","max","intersectionHeight","min","offsetTop","offsets","Array","isArray","offset","checkOverflowVisible","elementHeight","offsetWidth","offsetHeight","getClientRects","checkNormalVisible","visible","hidden","once","unmountIfInvisible","hiddenIfInvisible","lazyLoadHandler","i","listener","indexOf","splice","finalLazyLoadHandler","LazyLoad","scrollport","scrollContainer","querySelector","needResetFinalLazyLoadHandler","undefined","debounce","func","wait","immediate","timeout","args","context","timestamp","result","later","last","setTimeout","arguments","callNow","throttle","fn","threshhold","scope","deferTimer","now","clearTimeout","getAttribute","listenerCount","setAttribute","scroll","resize","removeAttribute","visibility","placeholder","defaultProps","Cache","db","added_items_since_maintenance","encrypt","decrypt","open_req","indexedDB","open","onerror","onupgradeneeded","createObjectStore","keyPath","createIndex","unique","onsuccess","maintenance","pid","stringify","s","target_version","parseInt","Promise","resolve","reject","get_req","store","tx","transaction","objectStore","data_str","version","last_access","put","delete","warn","req","count_req","count","openKeyCursor","cur","primaryKey","continue","deleteDatabase","cache","hole_cache","add_variant","li","item","variant","handle_response","response","a","notify","add_v","json","code","msg","alert","API","load_replies","token","fetch","headers","TOKEN","post","updated_at","info","_display_color","load_replies_with_cache","cache_version","reason","new_reply","get_latest_visited_cid","set_attention","attention","URLSearchParams","append","method","body","report","item_type","report_type","get_list","page","get_search","keyword","is_attention","get_attention","get_messages","push_only","since_id","MessageViewer","loading_status","load","catch","err","LoginPopupSelf","recaptcha_verified","phase","username","email_verification","password","password_confirm","checkbox_terms","checkbox_account","createElement","appendChild","verify_email","do_login","token_callback","new_user_registration","old_user_registration","need_recaptcha","checked","message","msgBuffer","TextEncoder","encode","crypto","subtle","digest","hashBuffer","hashArray","from","Uint8Array","b","toString","slice","sha256","password_hashed","failed_callback","old_token","URL","location","searchParams","email","recaptcha_version","recaptcha_token","localStorage","entries","param","set_token","hashpassword","device_info","UAParser","browser","device_type","on_close","valid_registration","valid_code","recaptchaOptions","useRecaptchaNet","ReactDOM","createPortal","reCaptchaKey","display","autoFocus","defaultValue","next_step","do_popup","onVerify","disabled","LoginPopup","popup_show","on_popup_bound","on_popup","on_close_bound","RecaptchaV2Popup","captchaRef","reset","execute","recaptchaToken","sitekey","BUILTIN_IMGS","DEFAULT_CONFIG","background_img","background_color","pressure","easter_egg","color_scheme","fold","block_words","auto_order","polling_interval","load_config","loaded_config","config","assign","keys","save_config","bgimg_style","img","color","background","backgroundImage","encodeURI","backgroundColor","backgroundSize","ConfigBackground","save_changes","img_select","on_select","on_change_img","on_change_color","ConfigSelect","options","description","ConfigTextArea","sift","ConfigSwitch","switch","val","ConfigUI","save_changes_bound","chg","confirm","reload","reset_settings","array","v","UnregisterPopupSelf","nonce","delete_account","UnregisterPopup","TokenCtx","createContext","set_value","DoUpdate","clear_cache","serviceWorker","getRegistrations","registrations","registration","unregister","InfoSidebar","show_sidebar","LoginForm","Consumer","VoteEditBox","onChangeCheckAndSend","checkAndSend","order","sendVoteData","num","inputPile","maxLength","padding","margin","PostForm","img_tip","preview","vote","voteOptionNum","voteData","1","2","3","4","tag","img_ref","on_img_change_bound","on_img_change","global_keypress_handler_bound","global_keypress_handler","tagName","path","action","reply_to_ref","reply_to","voteObj","values","char","on_complete","file","return_url","reader","FileReader","onload","fixOrientation","fixed_dataurl","image","Image","width","compressed","rate","sqrt","canvas","ctx","getContext","drawImage","quality","new_url","quality_l","quality_r","toDataURL","round","src","on_got_img","readAsDataURL","files","proc_img","d","do_post","replyClassName","tagsArrayAfter","onSubmit","accept","addVote","toggle_preview","voteDataObj","preVoteData","float","detect","require","ADMIN_COMMANDS","CLICKABLE_TAGS","audio","button","QUOTE_BLACKLIST","LATEST_POST_ID","not_show_deleted","ImageComponent","onError","alt","ImageViewer","in_sidebar","images","isOpen","onClose","load_single_meta","title_elem","replies","Reply","deleted","includes","replyText","header_badges","cid","report_widget","ReportWidget","is_reply","set_variant","useState","fold_reason","set_fold_reason","tag_text","set_tag_text","report_type_str","undelete_unban","delete_ban","unban","set_tag","item_type_str","comment","permissions","VoteShowBox","alreadyVote","yourVoteText","yourVoteIndex","totalCount","eachNums","loading","vote_data","sendVoteOption","sendVote","voteOptions","voted","opIndex","optionText","PubSub","publish","resultPile","buttonPile","voteSingle","nanoid","borderColor","left","fontSize","right","innerText","FlowItem","copy","likenum","reply","vote_options","r","is_quote","from_msg","copy_link","latest_reply","FlowSidebar","error_msg","filter_name","rev","reverse","syncState","sync_state","reply_ref","freshFirst","prev","next_attention","prevState","closest","should_text","set","replies_to_show","replies_cnt","main_thread_elem","show_reply_bar","set_filter_name","toggle_rev","toggle_attention","SwitchTransition","mode","CSSTransition","classNames","appear","render_self","FlowItemRow","needFold","reply_status","reply_error","some","word","pubSubToken","subscribe","handleFreshForVote","unsubscribe","comments","update_post","showing_replies","parts","quote_id","shown_results","charAt","search_reg","FlowItemQuote","FlowChunk","list","ind","Flow","search_text","loaded_pages","chunks","announcement","has_update","on_scroll_bound","on_scroll","failed","max_id","versions_remote","web_frontend_version","versions_local","finished","scrollHeight","scrollY","load_page","read_latest_id","getItem","PollingManager","polling_timer","unread_count","latest_messages","fetch_messages_bound","fetch_messages","pubSubKey","params","update","messages","callback_key","setup_timer","clear_timer","interval","setInterval","clearInterval","latest_id","from_sidebar","latest_cid_map","Map","new_latest_id","reduce","setItem","get_latest_cid","has","is_new_message","latest_cid","is_new","PushMessageViewer","all_loaded","root","color_picker_map","on_message_update_bound","on_message_update","reload_all","polling_manager","visited","Set","load_more_pages","evt","scrollTop","get_color_picker","cascade","PushMessage","flag_re","ControlBar","new_message_count","set_mode","on_keypress_bound","on_keypress","do_refresh_bound","do_refresh","do_attention_bound","do_attention","do_hot_posts_bound","do_hot_posts","hash","decodeURIComponent","lastIndexOf","cleanup","flag_res","scrollTo","onKeyPress","Title","Sidebar","do_close_bound","do_close","do_back_bound","do_back","contents","stack","cur_title","onTouchEnd","click","PressureHelper","level","fired","esc_interval","Pressure","change","force","do_fire","end","polyfill","only","preventSelect","repeat","THRESHOLD","new_level","pad","bottom","DeprecatedAlert","needShowSuicidePrompt","App","override","update_color_scheme","classList","add","remove","addListener","listen_darkmode","default","light","dark","sidebar_stack","flow_render_key","override_suicide","show_sidebar_bound","set_mode_bound","on_pressure_bound","on_pressure","inthu_flag","atob","ns","pop","Provider","textAlign","ErrorBoundary","userSelect","isLocalhost","Boolean","hostname","registerValidSW","swUrl","register","onupdatefound","installingWorker","installing","onstatechange","controller","ready","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.27bc98da.chunk.js","sourcesContent":["export const API_ROOT=process.env.REACT_APP_API_ROOT;\n","// https://martin.ankerl.com/2009/12/09/how-to-create-random-colors-programmatically/\n\nconst golden_ratio_conjugate = 0.618033988749895;\n\nexport class ColorPicker {\n  constructor() {\n    this.names = {};\n    this.current_h = Math.random();\n  }\n\n  get(name) {\n    name = name.toLowerCase();\n    if (name === '洞主') return ['hsl(0,0%,97%)', 'hsl(0,0%,16%)'];\n\n    if (!this.names[name]) {\n      this.current_h += golden_ratio_conjugate;\n      this.current_h %= 1;\n      this.names[name] = [\n        `hsl(${this.current_h * 360}, 50%, 90%)`,\n        `hsl(${this.current_h * 360}, 60%, 20%)`,\n      ];\n    }\n    return this.names[name];\n  }\n}\n","// regexp should match the WHOLE segmented part\n// export const PID_RE=/(^|[^\\d\\u20e3\\ufe0e\\ufe0f])([2-9]\\d{4,5}|1\\d{4,6})(?![\\d\\u20e3\\ufe0e\\ufe0f])/g;\nexport const PID_RE = /(^|[^\\d\\u20e3\\ufe0e\\ufe0f])(#\\d{1,7})(?![\\d\\u20e3\\ufe0e\\ufe0f])/g;\n// TODO: fix this re\n// export const URL_PID_RE=/((?:https?:\\/\\/)?thuhole\\.com\\/?#(?:#|%23)([2-9]\\d{4,5}|1\\d{4,6}))(?!\\d|\\u20e3|\\ufe0e|\\ufe0f)/g;\n// export const URL_PID_RE = /((?:https?:\\/\\/)?thuhole\\.com\\/?#(?:#|%23)(\\d{1,7}))(?!\\d|\\u20e3|\\ufe0e|\\ufe0f)/g;\nexport const NICKNAME_RE = /(^|[^A-Za-z])((?:(?:Angry|Baby|Crazy|Diligent|Excited|Fat|Greedy|Hungry|Interesting|Jolly|Kind|Little|Magic|Naïve|Old|PKU|Quiet|Rich|Superman|Tough|Undefined|Valuable|Wifeless|Xiangbuchulai|Young|Zombie)\\s)?(?:Alice|Bob|Carol|Dave|Eve|Francis|Grace|Hans|Isabella|Jason|Kate|Louis|Margaret|Nathan|Olivia|Paul|Queen|Richard|Susan|Thomas|Uma|Vivian|Winnie|Xander|Yasmine|Zach)|You Win(?: \\d+)?|洞主)(?![A-Za-z])/gi;\nexport const URL_RE = /(^|[^.@a-zA-Z0-9_])((?:https?:\\/\\/)?(?:(?:[\\w-]+\\.)+[a-zA-Z]{2,3}|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})(?::\\d{1,5})?(?:\\/[\\w~!@#$%^&*()\\-_=+[\\]{};:,./?|]*)?)(?![a-zA-Z0-9])/gi;\n\nexport function split_text(txt, rules) {\n  // rules: [['name',/regex/],...]\n  // return: [['name','part'],[null,'part'],...]\n\n  txt = [[null, txt]];\n  rules.forEach((rule) => {\n    let [name, regex] = rule;\n    txt = [].concat.apply(\n      [],\n      txt.map((part) => {\n        let [rule, content] = part;\n        if (rule)\n          // already tagged by previous rules\n          return [part];\n        else {\n          return content\n            .split(regex)\n            .map((seg) => (regex.test(seg) ? [name, seg] : [null, seg]))\n            .filter(([name, seg]) => name !== null || seg);\n        }\n      }),\n    );\n  });\n  return txt;\n}\n","export function get_json(res) {\n    if(!res.ok) throw Error(`网络错误 ${res.status} ${res.statusText}`);\n    return (\n        res\n            .text()\n            .then((t)=>{\n                try {\n                    return JSON.parse(t);\n                } catch(e) {\n                    console.error('json parse error');\n                    console.trace(e);\n                    console.log(t);\n                    throw new SyntaxError('JSON Parse Error '+t.substr(0,50));\n                }\n            })\n    );\n}\n\nexport function listen_darkmode(override) { // override: true/false/undefined\n    function update_color_scheme() {\n        if(override===undefined ? window.matchMedia('(prefers-color-scheme: dark)').matches : override)\n            document.body.classList.add('root-dark-mode');\n        else\n            document.body.classList.remove('root-dark-mode');\n    }\n\n    update_color_scheme();\n    window.matchMedia('(prefers-color-scheme: dark)').addListener(()=>{\n        update_color_scheme();\n    });\n}\n\nexport function API_VERSION_PARAM() {\n    return '&device=0&v='+encodeURIComponent((process.env.REACT_APP_BUILD_INFO||'null')+'-'+(Math.floor(+new Date()/7200000)*2));\n}","import React, { Component, PureComponent } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport TimeAgo from 'react-timeago';\nimport chineseStrings from 'react-timeago/lib/language-strings/zh-CN';\nimport buildFormatter from 'react-timeago/lib/formatters/buildFormatter';\n\nimport './global.css';\nimport './widgets.css';\n\n// import appicon_hole from './infrastructure/appicon/hole.png';\n// import appicon_imasugu from './infrastructure/appicon/imasugu.png';\n// import appicon_imasugu_rev from './infrastructure/appicon/imasugu_rev.png';\n// import appicon_syllabus from './infrastructure/appicon/syllabus.png';\n// import appicon_score from './infrastructure/appicon/score.png';\n// import appicon_course_survey from './infrastructure/appicon/course_survey.png';\n// import appicon_dropdown from './infrastructure/appicon/dropdown.png';\n// import appicon_dropdown_rev from './infrastructure/appicon/dropdown_rev.png';\n// import appicon_homepage from './infrastructure/appicon/homepage.png';\nimport { API_ROOT } from './const';\nimport { get_json, API_VERSION_PARAM } from './functions';\n\nimport {\n  GoogleReCaptchaProvider,\n  GoogleReCaptcha,\n} from 'react-google-recaptcha-v3';\nimport ReCAPTCHA from 'react-google-recaptcha';\n\nconst LOGIN_POPUP_ANCHOR_ID = 'pkuhelper_login_popup_anchor';\n\nfunction pad2(x) {\n  return x < 10 ? '0' + x : '' + x;\n}\nexport function format_time(time) {\n  return `${time.getMonth() + 1}-${pad2(\n    time.getDate(),\n  )} ${time.getHours()}:${pad2(time.getMinutes())}:${pad2(time.getSeconds())}`;\n}\nconst chinese_format = buildFormatter(chineseStrings);\nexport function Time(props) {\n  const time = new Date(props.stamp * 1000);\n  return (\n    <span className={'time-str'}>\n      <TimeAgo\n        date={time}\n        formatter={chinese_format}\n        title={time.toLocaleString('zh-CN', {\n          timeZone: 'Asia/Shanghai',\n          hour12: false,\n        })}\n      />\n      &nbsp;\n      {!props.short ? format_time(time) : null}\n    </span>\n  );\n}\n\nexport function TitleLine(props) {\n  return (\n    <p className=\"centered-line title-line aux-margin\">\n      <span className=\"black-outline\">{props.text}</span>\n    </p>\n  );\n}\n\nexport function GlobalTitle(props) {\n  return (\n    <div className=\"aux-margin\">\n      <div className=\"title\">\n        <p className=\"centered-line\">{props.text}</p>\n      </div>\n    </div>\n  );\n}\n\n// const FALLBACK_APPS = {\n//   // id, text, url, icon_normal, icon_hover, new_tab\n//   bar: [\n//     ['hole', '树洞', '/hole', appicon_hole, null, false],\n//     [\n//       'imasugu',\n//       '教室',\n//       '/spare_classroom',\n//       appicon_imasugu,\n//       appicon_imasugu_rev,\n//       false,\n//     ],\n//     ['syllabus', '课表', '/syllabus', appicon_syllabus, null, false],\n//     ['score', '成绩', '/my_score', appicon_score, null, false],\n//   ],\n//   dropdown: [\n//     [\n//       'course_survey',\n//       '课程测评',\n//       'https://courses.pinzhixiaoyuan.com/',\n//       appicon_course_survey,\n//       null,\n//       true,\n//     ],\n//     ['homepage', '客户端', '/', appicon_homepage, null, true],\n//   ],\n//   fix: {},\n// };\n// const SWITCHER_DATA_VER='switcher_2';\n// const SWITCHER_DATA_URL=THUHOLE_API_ROOT+'web_static/appswitcher_items.json';\n\n// export class AppSwitcher extends Component {\n//     constructor(props) {\n//         super(props);\n//         this.state={\n//             apps: this.get_apps_from_localstorage(),\n//         }\n//     }\n//\n//     get_apps_from_localstorage() {\n//         let ret=FALLBACK_APPS;\n//         if(localStorage['APPSWITCHER_ITEMS'])\n//             try {\n//                 let content=JSON.parse(localStorage['APPSWITCHER_ITEMS'])[SWITCHER_DATA_VER];\n//                 if(!content || !content.bar)\n//                     throw new Error('content is empty');\n//\n//                 ret=content;\n//             } catch(e) {\n//                 console.error('load appswitcher items from localstorage failed');\n//                 console.trace(e);\n//             }\n//\n//         return ret;\n//     }\n//\n//     check_fix() {\n//         if(this.state.apps && this.state.apps.fix && this.state.apps.fix[this.props.appid])\n//             setTimeout(()=>{\n//                 window.HOTFIX_CONTEXT={\n//                     build_info: process.env.REACT_APP_BUILD_INFO || '---',\n//                     build_env: process.env.NODE_ENV,\n//                 };\n//                 eval(this.state.apps.fix[this.props.appid]);\n//             },1); // make it async so failures won't be critical\n//     }\n//\n//     componentDidMount() {\n//         this.check_fix();\n//         setTimeout(()=>{\n//             fetch(SWITCHER_DATA_URL)\n//                 .then((res)=>{\n//                     if(!res.ok) throw Error(`网络错误 ${res.status} ${res.statusText}`);\n//                     return res.text();\n//                 })\n//                 .then((txt)=>{\n//                     if(txt!==localStorage['APPSWITCHER_ITEMS']) {\n//                         console.log('loaded new appswitcher items',txt);\n//                         localStorage['APPSWITCHER_ITEMS']=txt;\n//\n//                         this.setState({\n//                             apps: this.get_apps_from_localstorage(),\n//                         });\n//                     } else {\n//                         console.log('appswitcher items unchanged');\n//                     }\n//                 })\n//                 .catch((e)=>{\n//                     console.error('loading appswitcher items failed');\n//                     console.trace(e);\n//                 });\n//         },500);\n//     }\n//\n//     componentDidUpdate(prevProps, prevState) {\n//         if(this.state.apps!==prevState.apps)\n//             this.check_fix();\n//     }\n//\n//     render() {\n//         let cur_id=this.props.appid;\n//\n//         function app_elem([id,title,url,icon_normal,icon_hover,new_tab],no_class=false,ref=null) {\n//             return (\n//                 <a ref={ref} key={id} className={no_class ? null : ('app-switcher-item'+(id===cur_id ? ' app-switcher-item-current' : ''))}\n//                    href={url} target={new_tab ? '_blank' : '_self'}>\n//                     {!!icon_normal && [\n//                         <img key=\"normal\" src={icon_normal} className=\"app-switcher-logo-normal\" />,\n//                         <img key=\"hover\" src={icon_hover||icon_normal} className=\"app-switcher-logo-hover\" />\n//                     ]}\n//                     <span>{title}</span>\n//                 </a>\n//             );\n//         }\n//\n//         let dropdown_cur_app=null;\n//         this.state.apps.dropdown.forEach((app)=>{\n//             if(app[0]===cur_id)\n//                 dropdown_cur_app=app;\n//         });\n//\n//         //console.log(JSON.stringify(this.state.apps));\n//\n//         return (\n//             <div className=\"app-switcher\">\n//                 <span className=\"app-switcher-desc app-switcher-left\">PKUHelper</span>\n//                 {this.state.apps.bar.map((app)=>\n//                     app_elem(app)\n//                 )}\n//                 {!!this.state.apps.dropdown.length &&\n//                     <div className={\n//                         'app-switcher-item app-switcher-dropdown '\n//                         +(dropdown_cur_app ? ' app-switcher-item-current' : '')\n//                     }>\n//                         <p className=\"app-switcher-dropdown-title\">\n//                             {!!dropdown_cur_app ?\n//                                 app_elem((()=>{\n//                                     let [id,title,_url,icon_normal,icon_hover,_new_tab]=dropdown_cur_app;\n//                                     return [id,title+'▾',null,icon_normal,icon_hover,false];\n//                                 })(),true) :\n//                                 app_elem(['-placeholder-elem','更多▾',null,appicon_dropdown,appicon_dropdown_rev,false],true)\n//                             }\n//                         </p>\n//                         {this.state.apps.dropdown.map((app)=>{\n//                             let ref=React.createRef();\n//                             return (\n//                                 <p key={app[0]} className=\"app-switcher-dropdown-item\" onClick={(e)=>{\n//                                     if(!e.target.closest('a') && ref.current)\n//                                         ref.current.click();\n//                                 }}>\n//                                     {app_elem(app,true,ref)}\n//                                 </p>\n//                             );\n//                         })}\n//                     </div>\n//                 }\n//                 <span className=\"app-switcher-desc app-switcher-right\">网页版</span>\n//             </div>\n//         );\n//     }\n// }\n\n// class RecaptchaV2Popup extends Component {\n//   constructor(props, context) {\n//     super(props, context);\n//     this.onChange = this.onChange.bind(this);\n//     this.state = {\n//       popup_show: false,\n//     };\n//     this.on_popup_bound = this.on_popup.bind(this);\n//     this.on_close_bound = this.on_close.bind(this);\n//   }\n//\n//   on_popup() {\n//     this.setState({\n//       popup_show: true,\n//     });\n//   }\n//   on_close() {\n//     this.setState({\n//       popup_show: false,\n//     });\n//   }\n//\n//   componentDidMount() {\n//     if (this.captchaRef) {\n//       console.log('started, just a second...');\n//       this.captchaRef.reset();\n//       this.captchaRef.execute();\n//     }\n//   }\n//   onChange(recaptchaToken) {\n//     localStorage['recaptcha'] = recaptchaToken;\n//     this.setState({\n//       popup_show: false,\n//     });\n//     this.props.callback();\n//   }\n//\n//   render() {\n//     return (\n//       <>\n//         {this.props.children(this.on_popup_bound)}\n//         {this.state.popup_show && (\n//           <div>\n//             <div className=\"treehollow-login-popup-shadow\" />\n//             <div className=\"treehollow-login-popup\">\n//               <div className=\"g-recaptcha\">\n//                 <ReCAPTCHA\n//                   ref={(el) => {\n//                     this.captchaRef = el;\n//                   }}\n//                   sitekey={process.env.REACT_APP_RECAPTCHA_V2_KEY}\n//                   // size={\"compact\"}\n//                   onChange={this.onChange}\n//                 />\n//               </div>\n//\n//               <p>\n//                 <button onClick={this.on_close_bound}>取消</button>\n//               </p>\n//             </div>\n//           </div>\n//         )}\n//       </>\n//     );\n//   }\n// }\n//\n// class LoginPopupSelf extends Component {\n//   constructor(props) {\n//     super(props);\n//     this.state = {\n//       loading_status: 'idle',\n//       recaptcha_verified: false,\n//       // excluded_scopes: [],\n//     };\n//     this.username_ref = React.createRef();\n//     this.password_ref = React.createRef();\n//     this.input_token_ref = React.createRef();\n//\n//     this.popup_anchor = document.getElementById(LOGIN_POPUP_ANCHOR_ID);\n//     if (!this.popup_anchor) {\n//       this.popup_anchor = document.createElement('div');\n//       this.popup_anchor.id = LOGIN_POPUP_ANCHOR_ID;\n//       document.body.appendChild(this.popup_anchor);\n//     }\n//   }\n//\n//   do_sendcode(type, do_popup, recaptcha_version) {\n//     if (!this.state.recaptcha_verified) {\n//       alert('reCAPTCHA风控系统正在评估您的浏览器安全状态，请稍后重试。');\n//       return;\n//     }\n//     if (this.state.loading_status === 'loading') return;\n//\n//     this.setState(\n//       {\n//         loading_status: 'loading',\n//       },\n//       () => {\n//         fetch(\n//           API_ROOT +\n//             'security/login/send_code' +\n//             '?user=' +\n//             encodeURIComponent(this.username_ref.current.value) +\n//             '&code_type=' +\n//             encodeURIComponent(type) +\n//             '&recaptcha_version=' +\n//             encodeURIComponent(recaptcha_version) +\n//             '&recaptcha_token=' +\n//             localStorage['recaptcha'] +\n//             API_VERSION_PARAM(),\n//           {\n//             method: 'POST',\n//             headers: {\n//               'Content-Type': 'application/json',\n//             },\n//             body: JSON.stringify({\n//               excluded_scopes: [],\n//             }),\n//           },\n//         )\n//           .then(get_json)\n//           .then((json) => {\n//             console.log(json);\n//             if (!json.success) throw new Error(JSON.stringify(json));\n//\n//             alert(json.msg);\n//             this.setState({\n//               loading_status: 'done',\n//             });\n//           })\n//           .catch((e) => {\n//             console.error(e);\n//\n//             if (e.toString().includes('风控系统校验失败')) {\n//               this.setState({\n//                 loading_status: 'done',\n//               });\n//               do_popup();\n//             } else {\n//               alert('发送失败\\n' + e);\n//               this.setState({\n//                 loading_status: 'done',\n//               });\n//             }\n//           });\n//       },\n//     );\n//   }\n//\n//   do_login(set_token) {\n//     if (this.state.loading_status === 'loading') return;\n//\n//     this.setState(\n//       {\n//         loading_status: 'loading',\n//       },\n//       () => {\n//         fetch(\n//           API_ROOT +\n//             'security/login/login' +\n//             '?user=' +\n//             encodeURIComponent(this.username_ref.current.value) +\n//             '&valid_code=' +\n//             encodeURIComponent(this.password_ref.current.value) +\n//             API_VERSION_PARAM(),\n//           {\n//             method: 'POST',\n//             headers: {\n//               'Content-Type': 'application/json',\n//             },\n//             body: JSON.stringify({\n//               excluded_scopes: [],\n//             }),\n//           },\n//         )\n//           .then(get_json)\n//           .then((json) => {\n//             if (json.code !== 0) {\n//               if (json.msg) throw new Error(json.msg);\n//               throw new Error(JSON.stringify(json));\n//             }\n//\n//             set_token(json.user_token);\n//             alert(`登录成功`);\n//             this.setState({\n//               loading_status: 'done',\n//             });\n//             this.props.on_close();\n//           })\n//           .catch((e) => {\n//             console.error(e);\n//             alert('登录失败\\n' + e);\n//             this.setState({\n//               loading_status: 'done',\n//             });\n//           });\n//       },\n//     );\n//   }\n//\n//   do_input_token(set_token) {\n//     if (this.state.loading_status === 'loading') return;\n//\n//     let token = this.input_token_ref.current.value;\n//     this.setState(\n//       {\n//         loading_status: 'loading',\n//       },\n//       () => {\n//         fetch(\n//           API_ROOT +\n//             'contents/system_msg?' +\n//             API_VERSION_PARAM(), {\n//             headers: {\n//               TOKEN: token,\n//             }\n//           }\n//         )\n//           .then((res) => res.json())\n//           .then((json) => {\n//             if (json.error) throw new Error(json.error);\n//             if (json.result.length === 0)\n//               throw new Error('result check failed');\n//             this.setState({\n//               loading_status: 'done',\n//             });\n//             set_token(token);\n//             this.props.on_close();\n//           })\n//           .catch((e) => {\n//             alert('Token检验失败\\n' + e);\n//             this.setState({\n//               loading_status: 'done',\n//             });\n//             console.error(e);\n//           });\n//       },\n//     );\n//   }\n//\n//   // perm_alert() {\n//   //     alert('如果你不需要 PKU Helper 的某项功能，可以取消相应权限。\\n其中【状态信息】包括你的网费、校园卡余额等。\\n该设置应用到你的【所有】设备，取消后如需再次启用相应功能需要重新登录。');\n//   // }\n//\n//   render() {\n//     // let PERM_SCOPES=[\n//     //     ['score','成绩查询'],\n//     //     ['syllabus','课表查询'],\n//     //     ['my_info','状态信息'],\n//     // ];\n//     window.recaptchaOptions = {\n//       useRecaptchaNet: true,\n//     };\n//     return ReactDOM.createPortal(\n//       <GoogleReCaptchaProvider\n//         reCaptchaKey={process.env.REACT_APP_RECAPTCHA_V3_KEY}\n//         useRecaptchaNet={true}\n//       >\n//         {!this.state.recaptcha_verified && (\n//           <GoogleReCaptcha\n//             onVerify={(token) => {\n//               this.setState({\n//                 recaptcha_verified: true,\n//               });\n//               console.log(token);\n//               localStorage['recaptcha'] = token;\n//             }}\n//           />\n//         )}\n//         <div>\n//           <div className=\"treehollow-login-popup-shadow\" />\n//           <div className=\"treehollow-login-popup\">\n//             <p>\n//               <b>接收验证码来登录 {process.env.REACT_APP_TITLE}</b>\n//             </p>\n//             <p>\n//               <label>\n//                 　邮箱&nbsp;\n//                 <input\n//                   ref={this.username_ref}\n//                   type=\"email\"\n//                   autoFocus={true}\n//                   defaultValue=\"@mails.tsinghua.edu.cn\"\n//                 />\n//               </label>\n//               <span className=\"treehollow-login-type\">\n//                 {/*<a onClick={(e)=>this.do_sendcode('sms')}>*/}\n//                 {/*    &nbsp;短信&nbsp;*/}\n//                 {/*</a>*/}\n//                 {/*/*/}\n//                 <RecaptchaV2Popup\n//                   callback={() => {\n//                     this.do_sendcode(\n//                       'mail',\n//                       () => {\n//                         alert('风控系统校验失败');\n//                       },\n//                       'v2',\n//                     );\n//                   }}\n//                 >\n//                   {(do_popup) => (\n//                     <a\n//                       onClick={(e) => this.do_sendcode('mail', do_popup, 'v3')}\n//                     >\n//                       &nbsp;发送邮件&nbsp;\n//                     </a>\n//                   )}\n//                 </RecaptchaV2Popup>\n//               </span>\n//             </p>\n//             <p>\n//               <label>\n//                 验证码&nbsp;\n//                 <input ref={this.password_ref} type=\"tel\" />\n//               </label>\n//               <button\n//                 type=\"button\"\n//                 disabled={this.state.loading_status === 'loading'}\n//                 onClick={(e) => this.do_login(this.props.token_callback)}\n//               >\n//                 登录\n//               </button>\n//             </p>\n//             <hr />\n//             <p>\n//               <b>从其他设备导入登录状态</b>\n//             </p>\n//             <p>\n//               <input ref={this.input_token_ref} placeholder=\"User Token\" />\n//               <button\n//                 type=\"button\"\n//                 disabled={this.state.loading_status === 'loading'}\n//                 onClick={(e) => this.do_input_token(this.props.token_callback)}\n//               >\n//                 导入\n//               </button>\n//             </p>\n//             <hr />\n//             <p style={{ fontSize: 11 }}>\n//               This site is protected by reCAPTCHA and the Google{' '}\n//               <a href=\"https://policies.google.com/privacy\">Privacy Policy</a>{' '}\n//               and{' '}\n//               <a href=\"https://policies.google.com/terms\">Terms of Service</a>{' '}\n//               apply.\n//             </p>\n//             <p>\n//               <button onClick={this.props.on_close}>取消</button>\n//             </p>\n//           </div>\n//         </div>\n//       </GoogleReCaptchaProvider>,\n//       this.popup_anchor,\n//     );\n//   }\n// }\n//\n// export class LoginPopup extends Component {\n//   constructor(props) {\n//     super(props);\n//     this.state = {\n//       popup_show: false,\n//     };\n//     this.on_popup_bound = this.on_popup.bind(this);\n//     this.on_close_bound = this.on_close.bind(this);\n//   }\n//\n//   on_popup() {\n//     this.setState({\n//       popup_show: true,\n//     });\n//   }\n//   on_close() {\n//     this.setState({\n//       popup_show: false,\n//     });\n//   }\n//\n//   render() {\n//     return (\n//       <>\n//         {this.props.children(this.on_popup_bound)}\n//         {this.state.popup_show && (\n//           <LoginPopupSelf\n//             token_callback={this.props.token_callback}\n//             on_close={this.on_close_bound}\n//           />\n//         )}\n//       </>\n//     );\n//   }\n// }\n","import MarkdownIt from 'markdown-it';\n// import MarkdownItKaTeX from 'markdown-it-katex';\nimport hljs from 'highlight.js';\nimport 'highlight.js/styles/atom-one-dark.css';\nimport './Markdown.css';\n\nimport 'katex/dist/katex.min.css';\n\nlet md = new MarkdownIt({\n  html: false,\n  linkify: false,\n  breaks: true,\n  inline: true,\n  highlight(str, lang) {\n    if (lang && hljs.getLanguage(lang)) {\n      try {\n        return (\n          '<pre class=\"hljs\"><code>' +\n          hljs.highlight(lang, str, true).value +\n          '</code></pre>'\n        );\n      } catch (__) {}\n    }\n    return (\n      '<pre class=\"hljs\"><code>' + md.utils.escapeHtml(str) + '</code></pre>'\n    );\n  },\n// }).use(MarkdownItKaTeX, {\n//   throwOnError: false,\n//   errorColor: '#aa0000',\n});\n\nexport default (text) => md.render(text);\n","import React, { Component, PureComponent } from 'react';\nimport { format_time, Time, TitleLine } from './old_infrastructure/widgets';\n\nimport HtmlToReact from 'html-to-react';\n\nimport './Common.css';\nimport {\n  // URL_PID_RE,\n  URL_RE,\n  PID_RE,\n  NICKNAME_RE,\n  split_text,\n} from './text_splitter';\n\nimport renderMd from './Markdown';\n\nexport { format_time, Time, TitleLine };\n\n// https://stackoverflow.com/questions/3446170/escape-string-for-use-in-javascript-regex\nexport function escape_regex(string) {\n  return string.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\nexport function build_highlight_re(txt, split = ' ', option = 'gi') {\n  return txt\n    ? new RegExp(\n        `(${txt\n          .split(split)\n          .filter((x) => !!x)\n          .map(escape_regex)\n          .join('|')})`,\n        option,\n      )\n    : /^$/g;\n}\n\nexport function ColoredSpan(props) {\n  return (\n    <span\n      className=\"colored-span\"\n      style={{\n        '--coloredspan-bgcolor-light': props.colors[0],\n        '--coloredspan-bgcolor-dark': props.colors[1],\n      }}\n    >\n      {props.children}\n    </span>\n  );\n}\n\nfunction normalize_url(url) {\n  return /^https?:\\/\\//.test(url) ? url : 'http://' + url;\n}\n\nexport class HighlightedText extends PureComponent {\n  render() {\n    return (\n      <pre>\n        {this.props.parts.map((part, idx) => {\n          let [rule, p] = part;\n          return (\n            <span key={idx}>\n              {rule === 'url_pid' ? (\n                <span className=\"url-pid-link\" title={p}>\n                  /##\n                </span>\n              ) : rule === 'url' ? (\n                <a href={normalize_url(p)} target=\"_blank\" rel=\"noopener\">\n                  {p}\n                </a>\n              ) : rule === 'pid' ? (\n                <a\n                  href={'#' + p}\n                  onClick={(e) => {\n                    e.preventDefault();\n                    this.props.show_pid(p.substring(1));\n                  }}\n                >\n                  {p}\n                </a>\n              ) : rule === 'nickname' ? (\n                <ColoredSpan colors={this.props.color_picker.get(p)}>\n                  {p}\n                </ColoredSpan>\n              ) : rule === 'search' ? (\n                <span className=\"search-query-highlight\">{p}</span>\n              ) : (\n                p\n              )}\n            </span>\n          );\n        })}\n      </pre>\n    );\n  }\n}\n\n// props: text, show_pid, color_picker\nexport class HighlightedMarkdown extends Component {\n  render() {\n    const props = this.props;\n    const processDefs = new HtmlToReact.ProcessNodeDefinitions(React);\n    const processInstructions = [\n      {\n        shouldProcessNode: (node) => node.name === 'img', // disable images\n        processNode(node, children, index) {\n          return <span key={index}>[图片]</span>;\n        },\n      },\n      {\n        shouldProcessNode: (node) => /^h[123456]$/.test(node.name),\n        processNode(node, children, index) {\n          let currentLevel = +node.name[1];\n          if (currentLevel < 3) currentLevel = 3;\n          const HeadingTag = `h${currentLevel}`;\n          return <HeadingTag key={index}>{children}</HeadingTag>;\n        },\n      },\n      {\n        shouldProcessNode: (node) => node.name === 'a',\n        processNode(node, children, index) {\n          return (\n            <a\n              href={normalize_url(node.attribs.href)}\n              target=\"_blank\"\n              rel=\"noopenner noreferrer\"\n              className=\"ext-link\"\n              key={index}\n            >\n              {children}\n              <span className=\"icon icon-new-tab\" />\n            </a>\n          );\n        },\n      },\n      {\n        shouldProcessNode(node) {\n          return (\n            node.type === 'text' &&\n            (!node.parent ||\n              !node.parent.attribs ||\n              node.parent.attribs['encoding'] !== 'application/x-tex')\n          ); // pid, nickname, search\n        },\n        processNode(node, children, index) {\n          const originalText = node.data;\n          let hl_rules = [\n            // ['url_pid', URL_PID_RE],\n            ['url', URL_RE],\n            ['pid', PID_RE],\n            ['nickname', NICKNAME_RE],\n          ];\n          if (props.search_param) {\n            hl_rules.push([\n              'search',\n              build_highlight_re(props.search_param, ' ', 'gi'),\n            ]);\n          }\n          const splitted = split_text(originalText, hl_rules);\n\n          return (\n            <React.Fragment key={index}>\n              {splitted.map(([rule, p], idx) => {\n                return (\n                  <span key={idx}>\n                    {rule === 'url_pid' ? (\n                      <span className=\"url-pid-link\" title={p}>\n                        /##\n                      </span>\n                    ) : rule === 'url' ? (\n                      <a\n                        href={normalize_url(p)}\n                        className=\"ext-link\"\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        {p}\n                        <span className=\"icon icon-new-tab\" />\n                      </a>\n                    ) : rule === 'pid' ? (\n                      <a\n                        href={'#' + p}\n                        onClick={(e) => {\n                          e.preventDefault();\n                          props.show_pid(p.substring(1));\n                        }}\n                      >\n                        {p}\n                      </a>\n                    ) : rule === 'nickname' ? (\n                      <ColoredSpan colors={props.color_picker.get(p)}>\n                        {p}\n                      </ColoredSpan>\n                    ) : rule === 'search' ? (\n                      <span className=\"search-query-highlight\">{p}</span>\n                    ) : (\n                      p\n                    )}\n                  </span>\n                );\n              })}\n            </React.Fragment>\n          );\n        },\n      },\n      {\n        shouldProcessNode: () => true,\n        processNode: processDefs.processDefaultNode,\n      },\n    ];\n    const parser = new HtmlToReact.Parser();\n    if (\n      props.author &&\n      props.text.match(/^(?:#+ |\\$\\$|>|```|\\t|\\s*-|\\s*\\d+\\.)/)\n    ) {\n      const renderedMarkdown = renderMd(props.text);\n      return (\n        <>\n          {props.author}\n          {parser.parseWithInstructions(\n            renderedMarkdown,\n            (node) => node.type !== 'script',\n            processInstructions,\n          ) || ''}\n        </>\n      );\n    } else {\n      let rawMd = props.text;\n      if (props.author) rawMd = props.author + ' ' + rawMd;\n      const renderedMarkdown = renderMd(rawMd);\n      return (\n        parser.parseWithInstructions(\n          renderedMarkdown,\n          (node) => node.type !== 'script',\n          processInstructions,\n        ) || null\n      );\n    }\n  }\n}\n\nwindow.TEXTAREA_BACKUP = {};\n\nexport class SafeTextarea extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n    };\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_keydown_bound = this.on_keydown.bind(this);\n    this.clear = this.clear.bind(this);\n    this.area_ref = React.createRef();\n    this.change_callback = props.on_change || (() => {});\n    this.submit_callback = props.on_submit || (() => {});\n  }\n\n  componentDidMount() {\n    this.setState(\n      {\n        text: window.TEXTAREA_BACKUP[this.props.id] || '',\n      },\n      () => {\n        this.change_callback(this.state.text);\n      },\n    );\n  }\n\n  componentWillUnmount() {\n    window.TEXTAREA_BACKUP[this.props.id] = this.state.text;\n    this.change_callback(this.state.text);\n  }\n\n  on_change(event) {\n    this.setState({\n      text: event.target.value,\n    });\n    this.change_callback(event.target.value);\n  }\n  on_keydown(event) {\n    if (event.key === 'Enter' && event.ctrlKey && !event.altKey) {\n      event.preventDefault();\n      this.submit_callback();\n    }\n  }\n\n  clear() {\n    this.setState({\n      text: '',\n    });\n  }\n  set(text) {\n    this.change_callback(text);\n    this.setState({\n      text: text,\n    });\n  }\n  get() {\n    return this.state.text;\n  }\n  focus() {\n    this.area_ref.current.focus();\n  }\n\n  render() {\n    return (\n      <textarea\n        ref={this.area_ref}\n        onChange={this.on_change_bound}\n        value={this.state.text}\n        onKeyDown={this.on_keydown_bound}\n      />\n    );\n  }\n}\n\nlet pwa_prompt_event = null;\nwindow.addEventListener('beforeinstallprompt', (e) => {\n  console.log('pwa: received before install prompt');\n  pwa_prompt_event = e;\n});\n\nexport function PromotionBar() {\n  let is_ios = /iPhone|iPad|iPod/i.test(window.navigator.userAgent);\n  let is_installed =\n    window.matchMedia('(display-mode: standalone)').matches ||\n    window.navigator.standalone;\n\n  if (is_installed) return null;\n\n  if (is_ios)\n    // noinspection JSConstructorReturnsPrimitive\n    return !navigator.standalone ? (\n      <div className=\"box promotion-bar\">\n        <span className=\"icon icon-about\" />\n        &nbsp; 用 Safari 把树洞 <b>添加到主屏幕</b> 更好用\n      </div>\n    ) : null;\n  // noinspection JSConstructorReturnsPrimitive\n  else\n    return pwa_prompt_event ? (\n      <div className=\"box promotion-bar\">\n        <span className=\"icon icon-about\" />\n        &nbsp; 把网页版树洞{' '}\n        <b>\n          <a\n            onClick={() => {\n              if (pwa_prompt_event) pwa_prompt_event.prompt();\n            }}\n          >\n            安装到桌面\n          </a>\n        </b>{' '}\n        更好用\n      </div>\n    ) : null;\n}\n\nexport function BrowserWarningBar() {\n  let cr_version = /Chrome\\/(\\d+)/.exec(navigator.userAgent);\n  cr_version = cr_version ? cr_version[1] : 0;\n  if (/MicroMessenger\\/|QQ\\//.test(navigator.userAgent))\n    return (\n      <div className=\"box box-tip box-warning\">\n        <b>您正在使用 QQ/微信 内嵌浏览器</b>\n        <br />\n        建议使用系统浏览器打开，否则可能出现兼容问题\n      </div>\n    );\n  if (/Edge\\/1/.test(navigator.userAgent))\n    return (\n      <div className=\"box box-tip box-warning\">\n        <b>您正在使用旧版 Microsoft Edge</b>\n        <br />\n        建议使用新版 Edge，否则可能出现兼容问题\n      </div>\n    );\n  else if (cr_version > 1 && cr_version < 57)\n    return (\n      <div className=\"box box-tip box-warning\">\n        <b>您正在使用古老的 Chrome {cr_version}</b>\n        <br />\n        建议使用新版浏览器，否则可能出现兼容问题\n      </div>\n    );\n  return null;\n}\n\nexport class ClickHandler extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      moved: true,\n      init_y: 0,\n      init_x: 0,\n    };\n    this.on_begin_bound = this.on_begin.bind(this);\n    this.on_move_bound = this.on_move.bind(this);\n    this.on_end_bound = this.on_end.bind(this);\n\n    this.MOVE_THRESHOLD = 3;\n    this.last_fire = 0;\n    this.popup_anchor = document.getElementById('img_viewer');\n  }\n\n  on_begin(e) {\n    //console.log('click',(e.touches?e.touches[0]:e).screenY,(e.touches?e.touches[0]:e).screenX);\n    this.setState({\n      moved: false,\n      init_y: (e.touches ? e.touches[0] : e).screenY,\n      init_x: (e.touches ? e.touches[0] : e).screenX,\n    });\n  }\n  on_move(e) {\n    if (!this.state.moved) {\n      let mvmt =\n        Math.abs((e.touches ? e.touches[0] : e).screenY - this.state.init_y) +\n        Math.abs((e.touches ? e.touches[0] : e).screenX - this.state.init_x);\n      //console.log('move',mvmt);\n      if (mvmt > this.MOVE_THRESHOLD)\n        this.setState({\n          moved: true,\n        });\n    }\n  }\n  on_end(event) {\n    //console.log('end');\n    if (!this.state.moved) this.do_callback(event);\n    this.setState({\n      moved: true,\n    });\n  }\n\n  do_callback(event) {\n    if (this.last_fire + 100 > +new Date()) return;\n    if (this.popup_anchor && this.popup_anchor.children.length !== 0) return;\n    this.last_fire = +new Date();\n    this.props.callback(event);\n  }\n\n  render() {\n    return (\n      <div\n        onTouchStart={this.on_begin_bound}\n        onMouseDown={this.on_begin_bound}\n        onTouchMove={this.on_move_bound}\n        onMouseMove={this.on_move_bound}\n        onClick={this.on_end_bound}\n      >\n        {this.props.children}\n      </div>\n    );\n  }\n}\n","export function on(el, eventName, callback, opts) {\n  opts = opts || false;\n  if (el.addEventListener) {\n    el.addEventListener(eventName, callback, opts);\n  } else if (el.attachEvent) {\n    el.attachEvent(`on${eventName}`, (e) => {\n      callback.call(el, e || window.event);\n    });\n  }\n}\n\nexport function off(el, eventName, callback, opts) {\n  opts = opts || false;\n  if (el.removeEventListener) {\n    el.removeEventListener(eventName, callback, opts);\n  } else if (el.detachEvent) {\n    el.detachEvent(`on${eventName}`, callback);\n  }\n}\n","/**\n * @fileOverview Find scroll parent\n */\n\nexport default (node) => {\n  if (!(node instanceof HTMLElement)) {\n    return document.documentElement;\n  }\n\n  const excludeStaticParent = node.style.position === 'absolute';\n  const overflowRegex = /(scroll|auto)/;\n  let parent = node;\n\n  while (parent) {\n    if (!parent.parentNode) {\n      return node.ownerDocument || document.documentElement;\n    }\n\n    const style = window.getComputedStyle(parent);\n    const position = style.position;\n    const overflow = style.overflow;\n    const overflowX = style['overflow-x'];\n    const overflowY = style['overflow-y'];\n\n    if (position === 'static' && excludeStaticParent) {\n      parent = parent.parentNode;\n      continue;\n    }\n\n    if (overflowRegex.test(overflow) && overflowRegex.test(overflowX) && overflowRegex.test(overflowY)) {\n      return parent;\n    }\n\n    parent = parent.parentNode;\n  }\n\n  return node.ownerDocument || node.documentElement || document.documentElement;\n};\n","/**\n * react-lazyload\n */\nimport React, { Component, PureComponent } from 'react';\nimport ReactDom from 'react-dom';\nimport PropTypes from 'prop-types';\nimport { on, off } from './utils/event';\nimport scrollParent from './utils/scrollParent';\nimport debounce from './utils/debounce';\nimport throttle from './utils/throttle';\n\nconst defaultBoundingClientRect = { top: 0, right: 0, bottom: 0, left: 0, width: 0, height: 0 };\nconst LISTEN_FLAG = 'data-lazyload-listened';\nconst listeners = [];\nlet pending = [];\n\n// try to handle passive events\nlet passiveEventSupported = false;\ntry {\n  const opts = Object.defineProperty({}, 'passive', {\n    get() {\n      passiveEventSupported = true;\n    }\n  });\n  window.addEventListener('test', null, opts);\n}\ncatch (e) { }\n// if they are supported, setup the optional params\n// IMPORTANT: FALSE doubles as the default CAPTURE value!\nconst passiveEvent = passiveEventSupported ? { capture: false, passive: true } : false;\n\n\n/**\n * Check if `component` is visible in overflow container `parent`\n * @param  {node} component React component\n * @param  {node} parent    component's scroll parent\n * @return {bool}\n */\nconst checkOverflowVisible = function checkOverflowVisible(component, parent) {\n  const node = ReactDom.findDOMNode(component);\n\n  let parentTop;\n  let parentHeight;\n\n  try {\n    ({ top: parentTop, height: parentHeight } = parent.getBoundingClientRect());\n  } catch (e) {\n    ({ top: parentTop, height: parentHeight } = defaultBoundingClientRect);\n  }\n\n  const windowInnerHeight = window.innerHeight || document.documentElement.clientHeight;\n\n  // calculate top and height of the intersection of the element's scrollParent and viewport\n  const intersectionTop = Math.max(parentTop, 0); // intersection's top relative to viewport\n  const intersectionHeight = Math.min(windowInnerHeight, parentTop + parentHeight) - intersectionTop; // height\n\n  // check whether the element is visible in the intersection\n  let top;\n  let height;\n\n  try {\n    ({ top, height } = node.getBoundingClientRect());\n  } catch (e) {\n    ({ top, height } = defaultBoundingClientRect);\n  }\n\n  const offsetTop = top - intersectionTop; // element's top relative to intersection\n\n  const offsets = Array.isArray(component.props.offset) ?\n                component.props.offset :\n                [component.props.offset, component.props.offset]; // Be compatible with previous API\n\n  return (offsetTop - offsets[0] <= intersectionHeight) &&\n         (offsetTop + height + offsets[1] >= 0);\n};\n\n/**\n * Check if `component` is visible in document\n * @param  {node} component React component\n * @return {bool}\n */\nconst checkNormalVisible = function checkNormalVisible(component) {\n  const node = ReactDom.findDOMNode(component);\n\n  // If this element is hidden by css rules somehow, it's definitely invisible\n  if (!(node.offsetWidth || node.offsetHeight || node.getClientRects().length)) return false;\n\n  let top;\n  let elementHeight;\n\n  try {\n    ({ top, height: elementHeight } = node.getBoundingClientRect());\n  } catch (e) {\n    ({ top, height: elementHeight } = defaultBoundingClientRect);\n  }\n\n  const windowInnerHeight = window.innerHeight || document.documentElement.clientHeight;\n\n  const offsets = Array.isArray(component.props.offset) ?\n                component.props.offset :\n                [component.props.offset, component.props.offset]; // Be compatible with previous API\n\n  return (top - offsets[0] <= windowInnerHeight) &&\n         (top + elementHeight + offsets[1] >= 0);\n};\n\n\n/**\n * Detect if element is visible in viewport, if so, set `visible` state to true.\n * If `once` prop is provided true, remove component as listener after checkVisible\n *\n * @param  {React} component   React component that respond to scroll and resize\n */\nconst checkVisible = function checkVisible(component) {\n  const node = ReactDom.findDOMNode(component);\n  if (!(node instanceof HTMLElement)) {\n    return;\n  }\n\n  const parent = scrollParent(node);\n  const isOverflow = component.props.overflow &&\n                     parent !== node.ownerDocument &&\n                     parent !== document &&\n                     parent !== document.documentElement;\n  const visible = isOverflow ?\n                  checkOverflowVisible(component, parent) :\n                  checkNormalVisible(component);\n  if (visible) {\n    // Avoid extra render if previously is visible\n    if (!component.state.visible || component.state.hidden) {\n      if (component.props.once) {\n        pending.push(component);\n      }\n\n      //console.log('lazyload 1');\n      component.setState({\n        visible: true,\n        hidden: false,\n      });\n    }\n  } else if (!component.props.once) {\n    if (component.props.unmountIfInvisible) {\n      if(component.visible===true)\n        component.setState({\n          visible: false,\n        });\n    } else if(component.props.hiddenIfInvisible) {\n      if(component.state.hidden===false) {\n        //console.log('lazyload 3');\n        component.setState({\n          hidden: true,\n        });\n      }\n    }\n  }\n};\n\n\nconst purgePending = function purgePending() {\n  pending.forEach((component) => {\n    const index = listeners.indexOf(component);\n    if (index !== -1) {\n      listeners.splice(index, 1);\n    }\n  });\n\n  pending = [];\n};\n\nconst lazyLoadHandler = () => {\n  for (let i = 0; i < listeners.length; ++i) {\n    const listener = listeners[i];\n    checkVisible(listener);\n  }\n  // Remove `once` component in listeners\n  purgePending();\n};\n\n// Depending on component's props\nlet delayType;\nlet finalLazyLoadHandler = null;\n\nconst isString = string => typeof string === 'string';\n\nclass LazyLoad extends PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state={\n      visible: false,\n      hidden: false,\n    };\n  }\n\n  componentDidMount() {\n    // It's unlikely to change delay type on the fly, this is mainly\n    // designed for tests\n    let scrollport = window;\n    const {\n      scrollContainer,\n    } = this.props;\n    if (scrollContainer) {\n      if (isString(scrollContainer)) {\n        scrollport = scrollport.document.querySelector(scrollContainer);\n      }\n    }\n    const needResetFinalLazyLoadHandler = (this.props.debounce !== undefined && delayType === 'throttle')\n      || (delayType === 'debounce' && this.props.debounce === undefined);\n\n    if (needResetFinalLazyLoadHandler) {\n      off(scrollport, 'scroll', finalLazyLoadHandler, passiveEvent);\n      off(window, 'resize', finalLazyLoadHandler, passiveEvent);\n      finalLazyLoadHandler = null;\n    }\n\n    if (!finalLazyLoadHandler) {\n      if (this.props.debounce !== undefined) {\n        finalLazyLoadHandler = debounce(lazyLoadHandler, typeof this.props.debounce === 'number' ?\n                                                         this.props.debounce :\n                                                         300);\n        delayType = 'debounce';\n      } else if (this.props.throttle !== undefined) {\n        finalLazyLoadHandler = throttle(lazyLoadHandler, typeof this.props.throttle === 'number' ?\n                                                         this.props.throttle :\n                                                         300);\n        delayType = 'throttle';\n      } else {\n        finalLazyLoadHandler = lazyLoadHandler;\n      }\n    }\n\n    if (this.props.overflow) {\n      const parent = scrollParent(ReactDom.findDOMNode(this));\n      if (parent && typeof parent.getAttribute === 'function') {\n        const listenerCount = 1 + (+parent.getAttribute(LISTEN_FLAG));\n        if (listenerCount === 1) {\n          parent.addEventListener('scroll', finalLazyLoadHandler, passiveEvent);\n        }\n        parent.setAttribute(LISTEN_FLAG, listenerCount);\n      }\n    } else if (listeners.length === 0 || needResetFinalLazyLoadHandler) {\n      const { scroll, resize } = this.props;\n\n      if (scroll) {\n        on(scrollport, 'scroll', finalLazyLoadHandler, passiveEvent);\n      }\n\n      if (resize) {\n        on(window, 'resize', finalLazyLoadHandler, passiveEvent);\n      }\n    }\n\n    listeners.push(this);\n    checkVisible(this);\n  }\n\n  componentWillUnmount() {\n    if (this.props.overflow) {\n      const parent = scrollParent(ReactDom.findDOMNode(this));\n      if (parent && typeof parent.getAttribute === 'function') {\n        const listenerCount = (+parent.getAttribute(LISTEN_FLAG)) - 1;\n        if (listenerCount === 0) {\n          parent.removeEventListener('scroll', finalLazyLoadHandler, passiveEvent);\n          parent.removeAttribute(LISTEN_FLAG);\n        } else {\n          parent.setAttribute(LISTEN_FLAG, listenerCount);\n        }\n      }\n    }\n\n    const index = listeners.indexOf(this);\n    if (index !== -1) {\n      listeners.splice(index, 1);\n    }\n\n    if (listeners.length === 0 && typeof window !== 'undefined') {\n      off(window, 'resize', finalLazyLoadHandler, passiveEvent);\n      off(window, 'scroll', finalLazyLoadHandler, passiveEvent);\n    }\n  }\n\n  render() {\n    //console.log('lazyload render');\n    if(this.state.visible) {\n      if(this.props.hiddenIfInvisible)\n        return this.state.hidden ?\n            <div style={{visibility: 'hidden'}}>{this.props.children}</div> :\n            <div>{this.props.children}</div>;\n      else\n        return this.props.children;\n    }\n    else\n      return this.props.placeholder ?\n                this.props.placeholder :\n                <div style={{ height: this.props.height }} className=\"lazyload-placeholder\" />;\n  }\n}\n\nLazyLoad.propTypes = {\n  once: PropTypes.bool,\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  offset: PropTypes.oneOfType([PropTypes.number, PropTypes.arrayOf(PropTypes.number)]),\n  overflow: PropTypes.bool,\n  resize: PropTypes.bool,\n  scroll: PropTypes.bool,\n  children: PropTypes.node,\n  throttle: PropTypes.oneOfType([PropTypes.number, PropTypes.bool]),\n  debounce: PropTypes.oneOfType([PropTypes.number, PropTypes.bool]),\n  placeholder: PropTypes.node,\n  scrollContainer: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  unmountIfInvisible: PropTypes.bool,\n  hiddenIfInvisible: PropTypes.bool,\n};\n\nLazyLoad.defaultProps = {\n  once: false,\n  offset: 0,\n  overflow: false,\n  resize: false,\n  scroll: true,\n  unmountIfInvisible: false,\n  hiddenIfInvisible: false,\n};\n\nconst getDisplayName = WrappedComponent => WrappedComponent.displayName || WrappedComponent.name || 'Component';\n\nconst decorator = (options = {}) => function lazyload(WrappedComponent) {\n  return class LazyLoadDecorated extends Component {\n    constructor() {\n      super();\n      this.displayName = `LazyLoad${getDisplayName(WrappedComponent)}`;\n    }\n\n    render() {\n      return (\n        <LazyLoad {...options}>\n          <WrappedComponent {...this.props} />\n        </LazyLoad>\n      );\n    }\n  };\n};\n\nexport { decorator as lazyload };\nexport default LazyLoad;\nexport { lazyLoadHandler as forceCheck };\n","export default function debounce(func, wait, immediate) {\n  let timeout;\n  let args;\n  let context;\n  let timestamp;\n  let result;\n\n  const later = function later() {\n    const last = +(new Date()) - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        if (!timeout) {\n          context = null;\n          args = null;\n        }\n      }\n    }\n  };\n\n  return function debounced() {\n    context = this;\n    args = arguments;\n    timestamp = +(new Date());\n\n    const callNow = immediate && !timeout;\n    if (!timeout) {\n      timeout = setTimeout(later, wait);\n    }\n\n    if (callNow) {\n      result = func.apply(context, args);\n      context = null;\n      args = null;\n    }\n\n    return result;\n  };\n}\n","/*eslint-disable */\nexport default function throttle(fn, threshhold, scope) {\n  threshhold || (threshhold = 250);\n  var last,\n      deferTimer;\n  return function () {\n    var context = scope || this;\n\n    var now = +new Date,\n        args = arguments;\n    if (last && now < last + threshhold) {\n      // hold on to it\n      clearTimeout(deferTimer);\n      deferTimer = setTimeout(function () {\n        last = now;\n        fn.apply(context, args);\n      }, threshhold);\n    } else {\n      last = now;\n      fn.apply(context, args);\n    }\n  };\n}\n","const HOLE_CACHE_DB_NAME = 'hole_v2_cache_db';\nconst CACHE_DB_VER = 1;\nconst MAINTENANCE_STEP = 150;\nconst MAINTENANCE_COUNT = 1000;\n\n//const ENC_KEY=42;\n\nclass Cache {\n  constructor() {\n    this.db = null;\n    this.added_items_since_maintenance = 0;\n    this.encrypt = this.encrypt.bind(this);\n    this.decrypt = this.decrypt.bind(this);\n    const open_req = indexedDB.open(HOLE_CACHE_DB_NAME, CACHE_DB_VER);\n    open_req.onerror = console.error.bind(console);\n    open_req.onupgradeneeded = (event) => {\n      console.log('comment cache db upgrade');\n      const db = event.target.result;\n      const store = db.createObjectStore('comment', {\n        keyPath: 'pid',\n      });\n      store.createIndex('last_access', 'last_access', { unique: false });\n    };\n    open_req.onsuccess = (event) => {\n      console.log('comment cache db loaded');\n      this.db = event.target.result;\n      setTimeout(this.maintenance.bind(this), 1);\n    };\n  }\n\n  // use window.hole_cache.encrypt() only after cache is loaded!\n  encrypt(pid, data) {\n    let s = JSON.stringify(data);\n    return s;\n    /*\n        let o='';\n        for(let i=0,key=(ENC_KEY^pid)%128;i<s.length;i++) {\n            let c=s.charCodeAt(i);\n            let new_key=(key^(c/2))%128;\n            o+=String.fromCharCode(key^s.charCodeAt(i));\n            key=new_key;\n        }\n        return o;\n        */\n  }\n\n  // use window.hole_cache.decrypt() only after cache is loaded!\n  decrypt(pid, s) {\n    return JSON.parse(s);\n    /*\n        let o='';\n        if(typeof(s)!==typeof('str'))\n            return null;\n\n        for(let i=0,key=(ENC_KEY^pid)%128;i<s.length;i++) {\n            let c=key^s.charCodeAt(i);\n            o+=String.fromCharCode(c);\n            key=(key^(c/2))%128;\n        }\n\n        try {\n            return JSON.parse(o);\n        } catch(e) {\n            console.error('decrypt failed');\n            console.trace(e);\n            return null;\n        }\n         */\n  }\n\n  get(pid, target_version) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve([null, 'fail']);\n      let get_req, store;\n      try {\n        const tx = this.db.transaction(['comment'], 'readwrite');\n        store = tx.objectStore('comment');\n        get_req = store.get(pid);\n      } catch (e) {\n        // ios sometimes fail at here, just ignore it\n        console.error(e);\n        resolve([null, 'fail']);\n      }\n      get_req.onsuccess = () => {\n        let res = get_req.result;\n        if (!res || !res.data_str) {\n          //console.log('comment cache miss',pid);\n          resolve([null, 'miss']);\n        } else if (target_version === res.version) {\n          // hit\n          console.log('comment cache hit', pid);\n          res.last_access = +new Date();\n          store.put(res);\n          let data = this.decrypt(pid, res.data_str);\n          resolve([data, 'hit']); // obj or null\n        } else {\n          // expired\n          console.log(\n            'comment cache expired',\n            pid,\n            ': ver',\n            res.version,\n            'target',\n            target_version,\n          );\n          store.delete(pid);\n          resolve([null, 'expired']);\n        }\n      };\n      get_req.onerror = (e) => {\n        console.warn('comment cache indexeddb open failed');\n        console.error(e);\n        resolve([null, 'fail']);\n      };\n    });\n  }\n\n  put(pid, target_version, data) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve();\n      try {\n        const tx = this.db.transaction(['comment'], 'readwrite');\n        const store = tx.objectStore('comment');\n        store.put({\n          pid: pid,\n          version: target_version,\n          data_str: this.encrypt(pid, data),\n          last_access: +new Date(),\n        });\n        if (++this.added_items_since_maintenance === MAINTENANCE_STEP)\n          setTimeout(this.maintenance.bind(this), 1);\n      } catch (e) {\n        console.error(e);\n        return resolve();\n      }\n    });\n  }\n\n  delete(pid) {\n    pid = parseInt(pid);\n    return new Promise((resolve, reject) => {\n      if (!this.db) return resolve();\n      let req;\n      try {\n        const tx = this.db.transaction(['comment'], 'readwrite');\n        const store = tx.objectStore('comment');\n        req = store.delete(pid);\n      } catch (e) {\n        console.error(e);\n        return resolve();\n      }\n      //console.log('comment cache delete',pid);\n      req.onerror = () => {\n        console.warn('comment cache delete failed ', pid);\n        return resolve();\n      };\n      req.onsuccess = () => resolve();\n    });\n  }\n\n  maintenance() {\n    if (!this.db) return;\n    const tx = this.db.transaction(['comment'], 'readwrite');\n    const store = tx.objectStore('comment');\n    let count_req = store.count();\n    count_req.onsuccess = () => {\n      let count = count_req.result;\n      if (count > MAINTENANCE_COUNT) {\n        console.log('comment cache db maintenance', count);\n        store.index('last_access').openKeyCursor().onsuccess = (e) => {\n          let cur = e.target.result;\n          if (cur) {\n            //console.log('maintenance: delete',cur);\n            store.delete(cur.primaryKey);\n            if (--count > MAINTENANCE_COUNT) cur.continue();\n          }\n        };\n      } else {\n        console.log('comment cache db no need to maintenance', count);\n      }\n      this.added_items_since_maintenance = 0;\n    };\n    count_req.onerror = console.error.bind(console);\n  }\n\n  clear() {\n    if (!this.db) return;\n    try {\n      indexedDB.deleteDatabase(HOLE_CACHE_DB_NAME);\n      console.log('delete comment cache db');\n    } catch (e) {\n      console.error(e);\n    }\n  }\n}\n\nexport function cache() {\n  if (!window.hole_cache) window.hole_cache = new Cache();\n  return window.hole_cache;\n}\n","import { API_VERSION_PARAM } from './old_infrastructure/functions';\nimport { API_ROOT } from './old_infrastructure/const';\nimport { cache } from './cache';\n\nexport { API_ROOT, API_VERSION_PARAM };\n\nexport function get_json(res) {\n  if (!res.ok) throw Error(`网络错误 ${res.status} ${res.statusText}`);\n  return res.text().then((t) => {\n    try {\n      return JSON.parse(t);\n    } catch (e) {\n      console.error('json parse error');\n      console.trace(e);\n      console.log(t);\n      throw new SyntaxError('JSON Parse Error ' + t.substr(0, 50));\n    }\n  });\n}\n\nfunction add_variant(li) {\n  li.forEach((item) => {\n    item.variant = {};\n  });\n}\n\nconst SEARCH_PAGESIZE = 50;\n\nconst handle_response = async (response, notify = false, add_v = true) => {\n  let json = await get_json(response);\n  if (json.code !== 0) {\n    if (json.msg) {\n      if (notify) alert(json.msg);\n      else throw new Error(json.msg);\n    } else throw new Error(JSON.stringify(json));\n  }\n  if (add_v) {\n    add_variant(json.data);\n  }\n  return json;\n};\n\nexport const API = {\n  load_replies: (pid, token, color_picker) => {\n    pid = parseInt(pid);\n    return fetch(\n      API_ROOT + 'contents/post/detail?pid=' + pid + API_VERSION_PARAM(),\n      {\n        headers: {\n          TOKEN: token,\n        },\n      },\n    )\n      .then(get_json)\n      .then((json) => {\n        if (json.code !== 0) {\n          throw new Error(json.msg);\n        }\n        cache().put(pid, json.post.updated_at, json);\n\n        // also change load_replies_with_cache!\n        json.post.variant = {};\n        json.data = json.data.map((info) => {\n          info._display_color = color_picker.get(info.name);\n          info.variant = {};\n          return info;\n        });\n\n        return json;\n      });\n  },\n\n  load_replies_with_cache: (pid, token, color_picker, cache_version) => {\n    pid = parseInt(pid);\n    return cache()\n      .get(pid, cache_version)\n      .then(([json, reason]) => {\n        if (json) {\n          // also change load_replies!\n          json.post.variant = {};\n          json.data = json.data.map((info) => {\n            info._display_color = color_picker.get(info.name);\n            info.variant = {};\n            return info;\n          });\n\n          return json;\n        } else {\n          return API.load_replies(pid, token, color_picker).then((json) => {\n            if (reason === 'expired') json.post.variant.new_reply = true;\n            return json;\n          });\n        }\n      });\n  },\n\n  get_latest_visited_cid: (pid) => {\n    return 0; // WIP\n  },\n\n  set_attention: async (pid, attention, token) => {\n    let data = new URLSearchParams();\n    data.append('pid', pid);\n    data.append('switch', attention ? '1' : '0');\n    let response = await fetch(\n      API_ROOT + 'edit/attention?' + API_VERSION_PARAM(),\n      {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n          TOKEN: token,\n        },\n        body: data,\n      },\n    );\n    // Delete cache to update `attention` on next reload\n    cache().delete(pid);\n    return handle_response(response, true, false);\n  },\n\n  report: (item_type, id, report_type, reason, token) => {\n    if (item_type !== 'post' && item_type !== 'comment')\n      throw Error('bad type');\n    let data = new URLSearchParams();\n    data.append('id', id);\n    data.append('reason', reason);\n    data.append('type', report_type);\n    return fetch(\n      API_ROOT + 'edit/report/' + item_type + '?' + API_VERSION_PARAM(),\n      {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded',\n          TOKEN: token,\n        },\n        body: data,\n      },\n    )\n      .then(get_json)\n      .then((json) => {\n        if (json.code !== 0) throw new Error(json.msg);\n\n        return json;\n      });\n  },\n\n  get_list: async (page, token) => {\n    let response = await fetch(\n      API_ROOT + 'contents/post/list' + '?page=' + page + API_VERSION_PARAM(),\n      {\n        headers: {\n          TOKEN: token,\n        },\n      },\n    );\n    return handle_response(response);\n  },\n\n  get_search: async (page, keyword, token, is_attention = false) => {\n    console.log(is_attention === true ? '/attentions' : '');\n    let response = await fetch(\n      API_ROOT +\n        'contents/search' +\n        (is_attention === true ? '/attentions' : '') +\n        '?pagesize=' +\n        SEARCH_PAGESIZE +\n        '&page=' +\n        page +\n        '&keywords=' +\n        encodeURIComponent(keyword) +\n        API_VERSION_PARAM(),\n      {\n        headers: {\n          TOKEN: token,\n        },\n      },\n    );\n    return handle_response(response);\n  },\n\n  get_attention: async (page, token) => {\n    let response = await fetch(\n      API_ROOT + 'contents/post/attentions?page=' + page + API_VERSION_PARAM(),\n      {\n        headers: {\n          TOKEN: token,\n        },\n      },\n    );\n    return handle_response(response);\n  },\n\n  get_messages: async (page, token, push_only = false, since_id = -1) => {\n    let response = await fetch(\n      API_ROOT +\n        `contents/my_msgs?page=${page}&push_only=${\n          push_only ? 1 : 0\n        }&since_id=${since_id}` +\n        API_VERSION_PARAM(),\n      {\n        headers: {\n          TOKEN: token,\n        },\n      },\n    );\n    return handle_response(response);\n  },\n};\n","import React, { PureComponent } from 'react';\nimport { API_ROOT, get_json, API_VERSION_PARAM } from './flows_api';\nimport { Time } from './Common';\n\nexport class MessageViewer extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'idle',\n      msg: [],\n    };\n  }\n\n  componentDidMount() {\n    this.load();\n  }\n\n  load() {\n    if (this.state.loading_status === 'loading') return;\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(API_ROOT + 'contents/system_msg?' + API_VERSION_PARAM(), {\n          headers: {\n            TOKEN: this.props.token,\n          },\n        })\n          .then(get_json)\n          .then((json) => {\n            if (json.code !== 0) throw new Error(json.msg);\n            else\n              this.setState({\n                loading_status: 'done',\n                msg: json.data,\n              });\n          })\n          .catch((err) => {\n            console.error(err);\n            alert('' + err);\n            this.setState({\n              loading_status: 'failed',\n            });\n          });\n      },\n    );\n  }\n\n  render() {\n    if (this.state.loading_status === 'loading')\n      return <p className=\"box box-tip\">加载中……</p>;\n    else if (this.state.loading_status === 'failed')\n      return (\n        <div className=\"box box-tip\">\n          <a\n            onClick={() => {\n              this.load();\n            }}\n          >\n            重新加载\n          </a>\n        </div>\n      );\n    else if (this.state.loading_status === 'done')\n      return this.state.msg.map((msg) => (\n        <div className=\"box\" key={msg.timestamp}>\n          <div className=\"box-header\">\n            <Time stamp={msg.timestamp} short={false} />\n            <b>{msg.title}</b>\n          </div>\n          <div className=\"box-content\">\n            <pre>{msg.content}</pre>\n          </div>\n        </div>\n      ));\n    else return null;\n  }\n}\n","import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './login.css';\n\nimport { API_ROOT } from './old_infrastructure/const';\nimport { API_VERSION_PARAM, get_json } from './old_infrastructure/functions';\n\nimport {\n  GoogleReCaptcha,\n  GoogleReCaptchaProvider,\n} from 'react-google-recaptcha-v3';\nimport ReCAPTCHA from 'react-google-recaptcha';\n\nimport UAParser from 'ua-parser-js';\n\nconst LOGIN_POPUP_ANCHOR_ID = 'pkuhelper_login_popup_anchor';\n\nclass LoginPopupSelf extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'idle',\n      recaptcha_verified: false,\n      phase: -1,\n      // excluded_scopes: [],\n    };\n\n    this.ref = {\n      username: React.createRef(),\n      email_verification: React.createRef(),\n      password: React.createRef(),\n      password_confirm: React.createRef(),\n\n      checkbox_terms: React.createRef(),\n      checkbox_account: React.createRef(),\n    };\n\n    this.popup_anchor = document.getElementById(LOGIN_POPUP_ANCHOR_ID);\n    if (!this.popup_anchor) {\n      this.popup_anchor = document.createElement('div');\n      this.popup_anchor.id = LOGIN_POPUP_ANCHOR_ID;\n      document.body.appendChild(this.popup_anchor);\n    }\n  }\n\n  next_step() {\n    if (this.state.loading_status === 'loading') return;\n    switch (this.state.phase) {\n      case -1:\n        this.verify_email('v3', () => {});\n        break;\n      case 0:\n        this.do_login(this.props.token_callback);\n        break;\n      case 1:\n        this.new_user_registration(this.props.token_callback);\n        break;\n      case 2:\n        this.old_user_registration(this.props.token_callback);\n        break;\n      case 3:\n        this.need_recaptcha();\n        break;\n    }\n  }\n\n  valid_registration() {\n    if (\n      !this.ref.checkbox_terms.current.checked ||\n      !this.ref.checkbox_account.current.checked\n    ) {\n      alert('请同意条款与条件！');\n      return 1;\n    }\n    if (this.ref.password.current.value.length < 8) {\n      alert('密码太短，至少应包含8个字符！');\n      return 2;\n    }\n    if (\n      this.ref.password.current.value !==\n      this.ref.password_confirm.current.value\n    ) {\n      alert('密码不一致！');\n      return 3;\n    }\n    return 0;\n  }\n\n  async sha256(message) {\n    // encode as UTF-8\n    const msgBuffer = new TextEncoder().encode(message);\n\n    // hash the message\n    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);\n\n    // convert ArrayBuffer to Array\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n\n    // convert bytes to hex string\n    return hashArray.map((b) => ('00' + b.toString(16)).slice(-2)).join('');\n  }\n\n  async hashpassword(password) {\n    let password_hashed = await this.sha256(password);\n    password_hashed = await this.sha256(password_hashed);\n    return password_hashed;\n  }\n\n  verify_email(version, failed_callback) {\n    const old_token = new URL(location.href).searchParams.get('old_token');\n    const email = this.ref.username.current.value;\n    const recaptcha_version = version;\n    const recaptcha_token = localStorage['recaptcha'];\n    // VALIDATE EMAIL IN FRONT-END HERE\n    const body = new URLSearchParams();\n    Object.entries({\n      email,\n      old_token,\n      recaptcha_version,\n      recaptcha_token,\n    }).forEach((param) => body.append(...param));\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(API_ROOT + 'security/login/check_email?' + API_VERSION_PARAM(), {\n          method: 'POST',\n          body,\n        })\n          .then((res) => res.json())\n          .then((json) => {\n            // COMMENT NEXT LINE\n            //json.code = 2;\n            if (json.code < 0) throw new Error(json.msg);\n            this.setState({\n              loading_status: 'done',\n              phase: json.code,\n            });\n            if (json.code === 3) failed_callback();\n          })\n          .catch((e) => {\n            alert('邮箱检验失败\\n' + e);\n            this.setState({\n              loading_status: 'done',\n            });\n            console.error(e);\n          });\n      },\n    );\n  }\n\n  async do_login(set_token) {\n    const email = this.ref.username.current.value;\n    const password = this.ref.password.current.value;\n    let password_hashed = await this.hashpassword(password);\n    const device_info = UAParser(navigator.userAgent).browser.name;\n    const body = new URLSearchParams();\n    Object.entries({\n      email,\n      password_hashed,\n      device_type: 0,\n      device_info,\n    }).forEach((param) => body.append(...param));\n\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(API_ROOT + 'security/login/login?' + API_VERSION_PARAM(), {\n          method: 'POST',\n          body,\n        })\n          .then(get_json)\n          .then((json) => {\n            if (json.code !== 0) {\n              if (json.msg) throw new Error(json.msg);\n              throw new Error(JSON.stringify(json));\n            }\n\n            set_token(json.token);\n            alert('登录成功');\n            this.setState({\n              loading_status: 'done',\n            });\n            this.props.on_close();\n          })\n          .catch((e) => {\n            console.error(e);\n            alert('登录失败\\n' + e);\n            this.setState({\n              loading_status: 'done',\n            });\n          });\n      },\n    );\n  }\n\n  async new_user_registration(set_token) {\n    if (this.valid_registration() !== 0) return;\n    const email = this.ref.username.current.value;\n    const valid_code = this.ref.email_verification.current.value;\n    const password = this.ref.password.current.value;\n    let password_hashed = await this.hashpassword(password);\n    const device_info = UAParser(navigator.userAgent).browser.name;\n    const body = new URLSearchParams();\n    Object.entries({\n      email,\n      password_hashed,\n      device_type: 0,\n      device_info,\n      valid_code,\n    }).forEach((param) => body.append(...param));\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(\n          API_ROOT + 'security/login/create_account?' + API_VERSION_PARAM(),\n          {\n            method: 'POST',\n            body,\n          },\n        )\n          .then(get_json)\n          .then((json) => {\n            if (json.code !== 0) {\n              if (json.msg) throw new Error(json.msg);\n              throw new Error(JSON.stringify(json));\n            }\n\n            set_token(json.token);\n            alert('登录成功');\n            this.setState({\n              loading_status: 'done',\n            });\n            this.props.on_close();\n          })\n          .catch((e) => {\n            console.error(e);\n            alert('登录失败\\n' + e);\n            this.setState({\n              loading_status: 'done',\n            });\n          });\n      },\n    );\n  }\n\n  async old_user_registration(set_token) {\n    if (this.valid_registration() !== 0) return;\n    const email = this.ref.username.current.value;\n    const old_token = new URL(location.href).searchParams.get('old_token');\n    const password = this.ref.password.current.value;\n    let password_hashed = await this.hashpassword(password);\n    const device_info = UAParser(navigator.userAgent).browser.name;\n    const body = new URLSearchParams();\n    Object.entries({\n      email,\n      password_hashed,\n      device_type: 0,\n      device_info,\n      old_token,\n    }).forEach((param) => body.append(...param));\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(\n          API_ROOT + 'security/login/create_account?' + API_VERSION_PARAM(),\n          {\n            method: 'POST',\n            body,\n          },\n        )\n          .then(get_json)\n          .then((json) => {\n            if (json.code !== 0) {\n              if (json.msg) throw new Error(json.msg);\n              throw new Error(JSON.stringify(json));\n            }\n\n            set_token(json.token);\n            alert('登录成功');\n            this.setState({\n              loading_status: 'done',\n            });\n            this.props.on_close();\n          })\n          .catch((e) => {\n            console.error(e);\n            alert('登录失败\\n' + e);\n            this.setState({\n              loading_status: 'done',\n            });\n          });\n      },\n    );\n  }\n\n  need_recaptcha() {\n    console.log(3);\n  }\n\n  render() {\n    window.recaptchaOptions = {\n      useRecaptchaNet: true,\n    };\n    return ReactDOM.createPortal(\n      <GoogleReCaptchaProvider\n        reCaptchaKey={process.env.REACT_APP_RECAPTCHA_V3_KEY}\n        useRecaptchaNet={true}\n      >\n        <div>\n          <div className=\"treehollow-login-popup-shadow\" />\n          <div className=\"treehollow-login-popup margin-popup\">\n            {this.state.phase === -1 && (\n              <>\n                <p>\n                  <b>输入邮箱来登录 {process.env.REACT_APP_TITLE}</b>\n                </p>\n              </>\n            )}\n            <p style={this.state.phase === -1 ? {} : { display: 'none' }}>\n              <label>\n                邮箱&nbsp;\n                <input\n                  ref={this.ref.username}\n                  type=\"email\"\n                  autoFocus={true}\n                  defaultValue=\"@mails.tsinghua.edu.cn\"\n                  onKeyDown={(event) => {\n                    if (event.key === 'Enter') {\n                      this.next_step();\n                    }\n                  }}\n                />\n              </label>\n            </p>\n            {this.state.phase === 0 && (\n              <>\n                <p>\n                  <b>输入密码来登录 {process.env.REACT_APP_TITLE}</b>\n                </p>\n                <p>\n                  <label>\n                    密码&nbsp;\n                    <input\n                      ref={this.ref.password}\n                      type=\"password\"\n                      autoFocus={true}\n                      onKeyDown={(event) => {\n                        if (event.key === 'Enter') {\n                          this.next_step();\n                        }\n                      }}\n                    />\n                  </label>\n                </p>\n                <p>\n                  <a\n                    onClick={() => {\n                      alert(\n                        '在树洞网页版的“账户”界面，可以注销账号之后重新注册树洞。',\n                      );\n                    }}\n                  >\n                    忘记密码？\n                  </a>\n                </p>\n              </>\n            )}\n            {this.state.phase === 1 && (\n              <>\n                <p>\n                  <b>{process.env.REACT_APP_TITLE} 新用户注册</b>\n                </p>\n                <p>\n                  <label>\n                    邮箱验证码&nbsp;\n                    <input\n                      ref={this.ref.email_verification}\n                      type=\"tel\"\n                      autoFocus={true}\n                    />\n                  </label>\n                </p>\n              </>\n            )}\n            {this.state.phase === 2 && (\n              <>\n                <p>\n                  <b>{process.env.REACT_APP_TITLE} 老用户注册</b>\n                </p>\n              </>\n            )}\n            {(this.state.phase === 1 || this.state.phase === 2) && (\n              <>\n                <p>\n                  <label>\n                    密码&nbsp;\n                    <input ref={this.ref.password} type=\"password\" />\n                  </label>\n                </p>\n                <p>\n                  <label>\n                    密码确认&nbsp;\n                    <input\n                      ref={this.ref.password_confirm}\n                      type=\"password\"\n                      onKeyDown={(event) => {\n                        if (event.key === 'Enter') {\n                          this.next_step();\n                        }\n                      }}\n                    />\n                  </label>\n                </p>\n                <p>\n                  <label>\n                    <input type=\"checkbox\" ref={this.ref.checkbox_terms} />\n                    我已经阅读并同意了\n                    <a href={process.env.REACT_APP_TOS_URL}>服务协议</a>、\n                    <a href={process.env.REACT_APP_PRIVACY_URL}>隐私政策</a>和\n                    <a href={process.env.REACT_APP_RULES_URL}>社区规范</a>。\n                  </label>\n                </p>\n                <p>\n                  <label>\n                    <input type=\"checkbox\" ref={this.ref.checkbox_account} />\n                    我已经了解了用户的个人信息会通过设定的密码加密，如果忘记密码会很难找回账户。\n                  </label>\n                </p>\n              </>\n            )}\n            {this.state.phase === 3 && (\n              <>\n                <p>\n                  <b>输入验证码 {process.env.REACT_APP_TITLE}</b>\n                </p>\n                <RecaptchaV2Popup\n                  callback={() => {\n                    this.verify_email('v2', () => {\n                      alert('reCAPTCHA风控系统校验失败');\n                    });\n                  }}\n                >\n                  {(do_popup) => (\n                    <p>\n                      {!this.state.recaptcha_verified && (\n                        <GoogleReCaptcha\n                          onVerify={(token) => {\n                            this.setState({\n                              recaptcha_verified: true,\n                            });\n                            console.log(token);\n                            localStorage['recaptcha'] = token;\n                            this.verify_email('v3', do_popup);\n                          }}\n                        />\n                      )}\n                    </p>\n                  )}\n                </RecaptchaV2Popup>\n              </>\n            )}\n            <p>\n              <button\n                onClick={this.next_step.bind(this)}\n                disabled={this.state.loading_status === 'loading'}\n              >\n                下一步\n              </button>\n              <button onClick={this.props.on_close}>取消</button>\n            </p>\n          </div>\n        </div>\n      </GoogleReCaptchaProvider>,\n      this.popup_anchor,\n    );\n  }\n}\n\nexport class LoginPopup extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      popup_show: false,\n    };\n    this.on_popup_bound = this.on_popup.bind(this);\n    this.on_close_bound = this.on_close.bind(this);\n  }\n\n  on_popup() {\n    this.setState({\n      popup_show: true,\n    });\n  }\n\n  on_close() {\n    this.setState({\n      popup_show: false,\n    });\n  }\n\n  render() {\n    return (\n      <>\n        {this.props.children(this.on_popup_bound)}\n        {this.state.popup_show && (\n          <LoginPopupSelf\n            token_callback={this.props.token_callback}\n            on_close={this.on_close_bound}\n          />\n        )}\n      </>\n    );\n  }\n}\n\nexport class RecaptchaV2Popup extends Component {\n  constructor(props, context) {\n    super(props, context);\n    this.onChange = this.onChange.bind(this);\n    this.state = {\n      popup_show: false,\n    };\n    this.on_popup_bound = this.on_popup.bind(this);\n    this.on_close_bound = this.on_close.bind(this);\n  }\n\n  on_popup() {\n    this.setState({\n      popup_show: true,\n    });\n  }\n\n  on_close() {\n    this.setState({\n      popup_show: false,\n    });\n  }\n\n  componentDidMount() {\n    if (this.captchaRef) {\n      console.log('started, just a second...');\n      this.captchaRef.reset();\n      this.captchaRef.execute();\n    }\n  }\n\n  onChange(recaptchaToken) {\n    localStorage['recaptcha'] = recaptchaToken;\n    this.setState({\n      popup_show: false,\n    });\n    this.props.callback();\n  }\n\n  render() {\n    return (\n      <>\n        {this.props.children(this.on_popup_bound)}\n        {this.state.popup_show && (\n          <div>\n            <div className=\"treehollow-login-popup-shadow\" />\n            <div className=\"treehollow-login-popup\">\n              <div className=\"g-recaptcha\">\n                <ReCAPTCHA\n                  ref={(el) => {\n                    this.captchaRef = el;\n                  }}\n                  sitekey={process.env.REACT_APP_RECAPTCHA_V2_KEY}\n                  // size={\"compact\"}\n                  onChange={this.onChange}\n                />\n              </div>\n\n              <p>\n                <button onClick={this.on_close_bound}>取消</button>\n              </p>\n            </div>\n          </div>\n        )}\n      </>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n\nimport './Config.css';\nimport { HighlightedMarkdown } from './Common';\n\nconst BUILTIN_IMGS = {\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg':\n    '寻觅繁星（默认）',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/eriri.jpg':\n    '平成著名画师',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/yurucamp.jpg':\n    '露营天下第一',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/minecraft.jpg':\n    '麦恩·库拉夫特',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/cyberpunk.jpg':\n    '赛博城市',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/bj.jpg':\n    '城市的星光',\n  'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/sif.jpg':\n    '梦开始的地方',\n};\n\nconst DEFAULT_CONFIG = {\n  background_img:\n    'https://cdn.jsdelivr.net/gh/thuhole/webhole@gh-pages/static/bg/gbp.jpg',\n  background_color: '#113366',\n  pressure: false,\n  easter_egg: true,\n  color_scheme: 'default',\n  fold: true,\n  block_words: [],\n  auto_order: true,\n  polling_interval: '30',\n};\n\nexport function load_config() {\n  let config = Object.assign({}, DEFAULT_CONFIG);\n  let loaded_config;\n  try {\n    loaded_config = JSON.parse(localStorage['hole_config'] || '{}');\n  } catch (e) {\n    alert('设置加载失败，将重置为默认设置！\\n' + e);\n    delete localStorage['hole_config'];\n    loaded_config = {};\n  }\n\n  // unrecognized configs are removed\n  Object.keys(loaded_config).forEach((key) => {\n    if (config[key] !== undefined) config[key] = loaded_config[key];\n  });\n\n  console.log('config loaded', config);\n  window.config = config;\n}\nexport function save_config() {\n  localStorage['hole_config'] = JSON.stringify(window.config);\n  load_config();\n}\n\nexport function bgimg_style(img, color) {\n  if (img === undefined) img = window.config.background_img;\n  if (color === undefined) color = window.config.background_color;\n  return {\n    background: 'transparent center center',\n    backgroundImage: img === null ? 'unset' : 'url(\"' + encodeURI(img) + '\")',\n    backgroundColor: color,\n    backgroundSize: 'cover',\n  };\n}\n\nclass ConfigBackground extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      img: window.config.background_img,\n      color: window.config.background_color,\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      background_img: this.state.img,\n      background_color: this.state.color,\n    });\n  }\n\n  on_select(e) {\n    let value = e.target.value;\n    this.setState(\n      {\n        img: value === '##other' ? '' : value === '##color' ? null : value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n  on_change_img(e) {\n    this.setState(\n      {\n        img: e.target.value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n  on_change_color(e) {\n    this.setState(\n      {\n        color: e.target.value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    let img_select =\n      this.state.img === null\n        ? '##color'\n        : Object.keys(BUILTIN_IMGS).indexOf(this.state.img) === -1\n        ? '##other'\n        : this.state.img;\n    return (\n      <div>\n        <p>\n          <b>背景图片：</b>\n          <select\n            className=\"config-select\"\n            value={img_select}\n            onChange={this.on_select.bind(this)}\n          >\n            {Object.keys(BUILTIN_IMGS).map((key) => (\n              <option key={key} value={key}>\n                {BUILTIN_IMGS[key]}\n              </option>\n            ))}\n            <option value=\"##other\">输入图片网址……</option>\n            <option value=\"##color\">纯色背景……</option>\n          </select>\n          &nbsp;\n          <small>#background_img</small>&nbsp;\n          {img_select === '##other' && (\n            <input\n              type=\"url\"\n              placeholder=\"图片网址\"\n              value={this.state.img}\n              onChange={this.on_change_img.bind(this)}\n            />\n          )}\n          {img_select === '##color' && (\n            <input\n              type=\"color\"\n              value={this.state.color}\n              onChange={this.on_change_color.bind(this)}\n            />\n          )}\n        </p>\n        <div\n          className=\"bg-preview\"\n          style={bgimg_style(this.state.img, this.state.color)}\n        />\n      </div>\n    );\n  }\n}\n\nclass ConfigSelect extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      value: window.config[props.id],\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      [this.props.id]: this.state.value,\n    });\n  }\n\n  on_select(e) {\n    let value = e.target.value;\n    this.setState(\n      {\n        value: value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <p>\n          <b>{this.props.name}：</b>\n          <select\n            className=\"config-select\"\n            value={this.state.value}\n            onChange={this.on_select.bind(this)}\n          >\n            {this.props.options.map(({ value, text }) => (\n              <option key={value} value={value}>\n                {text}\n              </option>\n            ))}\n          </select>\n          &nbsp;<small>#{this.props.id}</small>\n        </p>\n        <p className=\"config-description\">{this.props.description}</p>\n      </div>\n    );\n  }\n}\n\nclass ConfigTextArea extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      [props.id]: window.config[props.id],\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      [this.props.id]: this.props.sift(this.state[this.props.id]),\n    });\n  }\n\n  on_change(e) {\n    let value = this.props.parse(e.target.value);\n    this.setState(\n      {\n        [this.props.id]: value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <label>\n          <p>\n            <b>{this.props.name}</b>&nbsp;<small>#{this.props.id}</small>\n          </p>\n          <p className=\"config-description\">{this.props.description}</p>\n          <textarea\n            name={'config-' + this.props.id}\n            id={`config-textarea-${this.props.id}`}\n            className=\"config-textarea\"\n            value={this.props.display(this.state[this.props.id])}\n            onChange={this.on_change.bind(this)}\n          />\n        </label>\n      </div>\n    );\n  }\n}\n\n/* class ConfigBlockWords extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      block_words: window.config.block_words,\n    };\n  }\n\n  save_changes() {\n    this.props.callback({\n      block_words: this.state.block_words.filter((v) => v),\n    });\n  }\n\n  on_change(e) {\n    // Filter out those blank lines\n    let value = e.target.value.split('\\n');\n    this.setState(\n      {\n        block_words: value,\n      },\n      this.save_changes.bind(this),\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <p>\n          {' '}\n          <b>设置屏蔽词 </b>\n        </p>\n        <p>\n          <textarea\n            className=\"block-words\"\n            value={this.state.block_words.join('\\n')}\n            onChange={this.on_change.bind(this)}\n          />\n        </p>\n      </div>\n    );\n  }\n} */\n\nclass ConfigSwitch extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      switch: window.config[this.props.id],\n    };\n  }\n\n  on_change(e) {\n    let val = e.target.checked;\n    this.setState(\n      {\n        switch: val,\n      },\n      () => {\n        this.props.callback({\n          [this.props.id]: val,\n        });\n      },\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <p>\n          <label>\n            <input\n              name={'config-' + this.props.id}\n              type=\"checkbox\"\n              checked={this.state.switch}\n              onChange={this.on_change.bind(this)}\n            />\n            &nbsp;<b>{this.props.name}</b>\n            &nbsp;<small>#{this.props.id}</small>\n          </label>\n        </p>\n        <p className=\"config-description\">{this.props.description}</p>\n      </div>\n    );\n  }\n}\n\nexport class ConfigUI extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.save_changes_bound = this.save_changes.bind(this);\n  }\n\n  save_changes(chg) {\n    console.log(chg);\n    Object.keys(chg).forEach((key) => {\n      window.config[key] = chg[key];\n    });\n    save_config();\n  }\n\n  reset_settings() {\n    if (window.confirm('重置所有设置？')) {\n      window.config = {};\n      save_config();\n      window.location.reload();\n    }\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"box config-ui-header\">\n          <p>\n            这些功能仍在测试，可能不稳定（\n            <a onClick={this.reset_settings.bind(this)}>全部重置</a>）\n          </p>\n          <p>\n            <b>\n              修改设置后{' '}\n              <a\n                onClick={() => {\n                  window.location.reload();\n                }}\n              >\n                刷新页面\n              </a>{' '}\n              方可生效\n            </b>\n          </p>\n        </div>\n        <div className=\"box\">\n          <ConfigBackground\n            id=\"background\"\n            callback={this.save_changes_bound}\n          />\n          <hr />\n          <ConfigSelect\n            id=\"color_scheme\"\n            name=\"夜间模式\"\n            description=\"选择浅色或深色模式，深色模式下将会调暗图片亮度\"\n            options={[\n              { value: 'default', text: '跟随系统' },\n              { value: 'light', text: '始终浅色模式' },\n              { value: 'dark', text: '始终深色模式' },\n            ]}\n            callback={this.save_changes_bound}\n          />\n          <hr />\n          {/* <ConfigBlockWords\n            id=\"block-words\"\n            callback={this.save_changes_bound}\n          /> */}\n          <ConfigTextArea\n            id=\"block_words\"\n            callback={this.save_changes_bound}\n            name=\"设置屏蔽词\"\n            description={'包含屏蔽词的树洞会被折叠，每行写一个屏蔽词'}\n            display={(array) => array.join('\\n')}\n            sift={(array) => array.filter((v) => v)}\n            parse={(string) => string.split('\\n')}\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"pressure\"\n            name=\"快速返回\"\n            description=\"短暂按住 Esc 键或重压屏幕（3D Touch）可以快速返回或者刷新树洞\"\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"easter_egg\"\n            name=\"允许彩蛋\"\n            description=\"在某些情况下显示彩蛋\"\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"fold\"\n            name=\"折叠树洞\"\n            description=\"在时间线中折叠可能引起不适的树洞\"\n          />\n          <hr />\n          <ConfigSwitch\n            callback={this.save_changes_bound}\n            id=\"auto_order\"\n            name=\"自动倒序\"\n            description=\"从消息列表打开树洞时将评论设为倒序显示\"\n          />\n          <hr />\n          <ConfigSelect\n            id=\"polling_interval\"\n            name=\"更新频率\"\n            description=\"从服务器自动获取新消息的频率，或者禁用这项功能\"\n            options={[\n              { value: '15', text: '每 15 秒' },\n              { value: '30', text: '每 30 秒' },\n              { value: '60', text: '每分钟' },\n              { value: '120', text: '每 2 分钟' },\n              { value: '300', text: '每 5 分钟' },\n              { value: '-1', text: '禁用' },\n            ]}\n            callback={this.save_changes_bound}\n          />\n          {localStorage['hide_announcement'] && (\n            <div>\n              <hr />\n              <p>已隐藏的公告</p>\n              <div className=\"box flow-item box-announcement\">\n                <HighlightedMarkdown\n                  text={localStorage['hide_announcement']}\n                  color_picker={this.color_picker}\n                  show_pid={() => {}}\n                />\n                <a\n                  onClick={() => {\n                    delete localStorage['hide_announcement'];\n                    alert('已取消隐藏公告');\n                  }}\n                >\n                  [取消隐藏]\n                </a>\n              </div>\n            </div>\n          )}\n          <hr />\n          <p>\n            新功能建议或问题反馈请在&nbsp;\n            <a href={process.env.REACT_APP_GITHUB_ISSUES_URL} target=\"_blank\">\n              GitHub <span className=\"icon icon-github\" />\n            </a>\n            &nbsp;提出。\n          </p>\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './login.css';\n\nimport { API_ROOT } from './old_infrastructure/const';\nimport { get_json, API_VERSION_PARAM } from './old_infrastructure/functions';\nimport { RecaptchaV2Popup } from './login.js';\n\nimport {\n  GoogleReCaptchaProvider,\n  GoogleReCaptcha,\n} from 'react-google-recaptcha-v3';\n\nconst LOGIN_POPUP_ANCHOR_ID = 'pkuhelper_login_popup_anchor';\n\nclass UnregisterPopupSelf extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'idle',\n      recaptcha_verified: false,\n      phase: -1,\n      // excluded_scopes: [],\n    };\n\n    this.ref = {\n      username: React.createRef(),\n      email_verification: React.createRef(),\n      nonce: React.createRef(),\n      checkbox_account: React.createRef(),\n    };\n\n    this.popup_anchor = document.getElementById(LOGIN_POPUP_ANCHOR_ID);\n    if (!this.popup_anchor) {\n      this.popup_anchor = document.createElement('div');\n      this.popup_anchor.id = LOGIN_POPUP_ANCHOR_ID;\n      document.body.appendChild(this.popup_anchor);\n    }\n  }\n\n  valid_registration() {\n    if (!this.ref.checkbox_account.current.checked) {\n      alert('请同意条款与条件！');\n      return 1;\n    }\n    return 0;\n  }\n\n  next_step() {\n    if (this.state.loading_status === 'loading') return;\n    switch (this.state.phase) {\n      case -1:\n        this.verify_email('v3', () => {});\n        break;\n      case 1:\n        this.delete_account();\n        break;\n      case 3:\n        this.need_recaptcha();\n        break;\n    }\n  }\n\n  verify_email(version, failed_callback) {\n    const old_token = new URL(location.href).searchParams.get('old_token');\n    const email = this.ref.username.current.value;\n    const recaptcha_version = version;\n    const recaptcha_token = localStorage['recaptcha'];\n    // VALIDATE EMAIL IN FRONT-END HERE\n    const body = new URLSearchParams();\n    Object.entries({\n      email,\n      old_token,\n      recaptcha_version,\n      recaptcha_token,\n    }).forEach((param) => body.append(...param));\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(\n          API_ROOT +\n            'security/login/check_email_unregister?' +\n            API_VERSION_PARAM(),\n          {\n            method: 'POST',\n            body,\n          },\n        )\n          .then((res) => res.json())\n          .then((json) => {\n            // COMMENT NEXT LINE\n            //json.code = 2;\n            if (json.code < 0) throw new Error(json.msg);\n            this.setState({\n              loading_status: 'done',\n              phase: json.code,\n            });\n            if (json.code === 3) failed_callback();\n          })\n          .catch((e) => {\n            alert('邮箱检验失败\\n' + e);\n            this.setState({\n              loading_status: 'done',\n            });\n            console.error(e);\n          });\n      },\n    );\n  }\n\n  async delete_account() {\n    if (this.valid_registration() !== 0) return;\n    const email = this.ref.username.current.value;\n    const valid_code = this.ref.email_verification.current.value;\n    const nonce = this.ref.nonce.current.value;\n    const body = new URLSearchParams();\n    Object.entries({\n      email,\n      nonce,\n      valid_code,\n    }).forEach((param) => body.append(...param));\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        fetch(API_ROOT + 'security/login/unregister?' + API_VERSION_PARAM(), {\n          method: 'POST',\n          body,\n        })\n          .then(get_json)\n          .then((json) => {\n            if (json.code !== 0) {\n              if (json.msg) throw new Error(json.msg);\n              throw new Error(JSON.stringify(json));\n            }\n\n            alert('注销账户成功');\n            this.setState({\n              loading_status: 'done',\n            });\n            this.props.on_close();\n          })\n          .catch((e) => {\n            console.error(e);\n            alert('失败\\n' + e);\n            this.setState({\n              loading_status: 'done',\n            });\n          });\n      },\n    );\n  }\n\n  need_recaptcha() {\n    console.log(3);\n  }\n\n  render() {\n    window.recaptchaOptions = {\n      useRecaptchaNet: true,\n    };\n    return ReactDOM.createPortal(\n      <GoogleReCaptchaProvider\n        reCaptchaKey={process.env.REACT_APP_RECAPTCHA_V3_KEY}\n        useRecaptchaNet={true}\n      >\n        <div>\n          <div className=\"treehollow-login-popup-shadow\" />\n          <div className=\"treehollow-login-popup margin-popup\">\n            {this.state.phase === -1 && (\n              <>\n                <p>\n                  <b>输入邮箱来注销账户/找回密码</b>\n                </p>\n              </>\n            )}\n            <p style={this.state.phase === -1 ? {} : { display: 'none' }}>\n              <label>\n                邮箱&nbsp;\n                <input\n                  ref={this.ref.username}\n                  type=\"email\"\n                  autoFocus={true}\n                  defaultValue=\"@mails.tsinghua.edu.cn\"\n                  onKeyDown={(event) => {\n                    if (event.key === 'Enter') {\n                      this.next_step();\n                    }\n                  }}\n                />\n              </label>\n            </p>\n            {this.state.phase === 1 && (\n              <>\n                <p>\n                  <b>{process.env.REACT_APP_TITLE} 注销账户</b>\n                </p>\n                <p>\n                  <label>\n                    邮箱验证码&nbsp;\n                    <input\n                      ref={this.ref.email_verification}\n                      type=\"tel\"\n                      autoFocus={true}\n                    />\n                  </label>\n                </p>\n                <p>\n                  Nonce：&nbsp;\n                  <label>\n                    <input ref={this.ref.nonce} autoFocus={true} />\n                  </label>\n                </p>\n                <p>\n                  注：Nonce是注册树洞时欢迎邮件中的“找回密码口令”，形如xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx。\n                </p>\n                <p>\n                  <label>\n                    <input type=\"checkbox\" ref={this.ref.checkbox_account} />\n                    我已经了解了注销账户后，原账户的发帖、评论将保留；注销账户后可以重新注册树洞，但原账户的关注列表、评论区昵称等关联数据将丢失。\n                  </label>\n                </p>\n              </>\n            )}\n            {this.state.phase === 3 && (\n              <>\n                <p>\n                  <b>输入验证码 {process.env.REACT_APP_TITLE}</b>\n                </p>\n                <RecaptchaV2Popup\n                  callback={() => {\n                    this.verify_email('v2', () => {\n                      alert('reCAPTCHA风控系统校验失败');\n                    });\n                  }}\n                >\n                  {(do_popup) => (\n                    <p>\n                      {!this.state.recaptcha_verified && (\n                        <GoogleReCaptcha\n                          onVerify={(token) => {\n                            this.setState({\n                              recaptcha_verified: true,\n                            });\n                            console.log(token);\n                            localStorage['recaptcha'] = token;\n                            this.verify_email('v3', do_popup);\n                          }}\n                        />\n                      )}\n                    </p>\n                  )}\n                </RecaptchaV2Popup>\n              </>\n            )}\n            <p>\n              <button\n                onClick={this.next_step.bind(this)}\n                disabled={this.state.loading_status === 'loading'}\n              >\n                下一步\n              </button>\n              <button onClick={this.props.on_close}>取消</button>\n            </p>\n          </div>\n        </div>\n      </GoogleReCaptchaProvider>,\n      this.popup_anchor,\n    );\n  }\n}\n\nexport class UnregisterPopup extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      popup_show: false,\n    };\n    this.on_popup_bound = this.on_popup.bind(this);\n    this.on_close_bound = this.on_close.bind(this);\n  }\n\n  on_popup() {\n    this.setState({\n      popup_show: true,\n    });\n  }\n\n  on_close() {\n    this.setState({\n      popup_show: false,\n    });\n  }\n\n  render() {\n    return (\n      <>\n        {this.props.children(this.on_popup_bound)}\n        {this.state.popup_show && (\n          <UnregisterPopupSelf on_close={this.on_close_bound} />\n        )}\n      </>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport {\n  SafeTextarea,\n  PromotionBar,\n  HighlightedMarkdown,\n  BrowserWarningBar,\n} from './Common';\nimport { MessageViewer } from './Message';\nimport { LoginPopup } from './login';\nimport { ColorPicker } from './color_picker';\nimport { ConfigUI } from './Config';\nimport fixOrientation from 'fix-orientation';\nimport copy from 'copy-to-clipboard';\nimport { cache } from './cache';\nimport {\n  // API_VERSION_PARAM,\n  // THUHOLE_API_ROOT,\n  // API,\n  get_json,\n  API_ROOT,\n  API_VERSION_PARAM,\n} from './flows_api';\n\nimport './UserAction.css';\nimport { UnregisterPopup } from './delete_account';\n\nconst BASE64_RATE = 4 / 3;\nconst MAX_IMG_DIAM = 8000;\nconst MAX_IMG_PX = 5000000;\nconst MAX_IMG_FILESIZE = 450000 * BASE64_RATE;\n\nexport const TokenCtx = React.createContext({\n  value: null,\n  set_value: () => {},\n});\n\nexport function DoUpdate(clear_cache = true) {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.getRegistrations().then((registrations) => {\n      for (let registration of registrations) {\n        console.log('unregister', registration);\n        registration.unregister();\n      }\n    });\n  }\n  if (clear_cache) cache().clear();\n  setTimeout(() => {\n    window.location.reload(true);\n  }, 1000);\n}\n\nexport function InfoSidebar(props) {\n  return (\n    <div>\n      <PromotionBar />\n      <BrowserWarningBar />\n      <LoginForm show_sidebar={props.show_sidebar} />\n      <div className=\"box list-menu\">\n        <a href={process.env.REACT_APP_RULES_URL} target=\"_blank\">\n          <span className=\"icon icon-textfile\" />\n          <label>树洞规范</label>\n        </a>\n        &nbsp;&nbsp;\n        <a href={process.env.REACT_APP_TOS_URL} target=\"_blank\">\n          <span className=\"icon icon-textfile\" />\n          <label>服务协议</label>\n        </a>\n        &nbsp;&nbsp;\n        <a href={process.env.REACT_APP_PRIVACY_URL} target=\"_blank\">\n          <span className=\"icon icon-textfile\" />\n          <label>隐私政策</label>\n        </a>\n        <br />\n        <a\n          onClick={() => {\n            props.show_sidebar('设置', <ConfigUI />);\n          }}\n        >\n          <span className=\"icon icon-settings\" />\n          <label>设置</label>\n        </a>\n        &nbsp;&nbsp;\n        <a href={process.env.REACT_APP_GITHUB_ISSUES_URL} target=\"_blank\">\n          <span className=\"icon icon-github\" />\n          <label>意见反馈</label>\n        </a>\n        <br />\n        <UnregisterPopup>\n          {(do_popup) => (\n            <a onClick={do_popup}>\n              <span className=\"icon icon-refresh\" />\n              <label>注销账户/找回密码</label>\n            </a>\n          )}\n        </UnregisterPopup>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>\n          <a onClick={DoUpdate}>强制检查更新</a>\n          （当前版本：【{process.env.REACT_APP_BUILD_INFO || '---'}{' '}\n          {process.env.NODE_ENV}】 会自动在后台检查更新并在下次访问时更新）\n        </p>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>联系我们：{process.env.REACT_APP_CONTACT_EMAIL}</p>\n      </div>\n      <div className=\"box help-desc-box\">\n        <p>\n          {process.env.REACT_APP_TITLE} 网页版 by @\n          {process.env.REACT_APP_GITHUB_USER}， 基于&nbsp;\n          <a\n            href=\"https://www.gnu.org/licenses/gpl-3.0.zh-cn.html\"\n            target=\"_blank\"\n          >\n            GPLv3\n          </a>\n          &nbsp;协议在{' '}\n          <a href={process.env.REACT_APP_GITHUB_WEB_URL} target=\"_blank\">\n            GitHub\n          </a>{' '}\n          开源\n        </p>\n        <p>\n          {process.env.REACT_APP_TITLE} 网页版的诞生离不开&nbsp;\n          <a\n            href=\"https://github.com/pkuhelper-web/webhole\"\n            target=\"_blank\"\n            rel=\"noopener\"\n          >\n            P大树洞网页版 by @xmcp\n          </a>\n          、\n          <a href=\"https://reactjs.org/\" target=\"_blank\" rel=\"noopener\">\n            React\n          </a>\n          、\n          <a href=\"https://icomoon.io/#icons\" target=\"_blank\" rel=\"noopener\">\n            IcoMoon\n          </a>\n          &nbsp;等开源项目\n        </p>\n        <p>\n          This program is free software: you can redistribute it and/or modify\n          it under the terms of the GNU General Public License as published by\n          the Free Software Foundation, either version 3 of the License, or (at\n          your option) any later version.\n        </p>\n        <p>\n          This program is distributed in the hope that it will be useful, but\n          WITHOUT ANY WARRANTY; without even the implied warranty of\n          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the&nbsp;\n          <a\n            href=\"https://www.gnu.org/licenses/gpl-3.0.zh-cn.html\"\n            target=\"_blank\"\n          >\n            GNU General Public License\n          </a>\n          &nbsp;for more details.\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport class LoginForm extends Component {\n  // copy_token(token) {\n  //   if (copy(token))\n  //     alert(\n  //       '复制成功！\\n请一定不要泄露给其他人，或在' +\n  //         process.env.REACT_APP_WEBSITE_URL +\n  //         '以外的其他网站中输入token，否则可能会导致信息泄漏哦',\n  //     );\n  // }\n\n  render() {\n    return (\n      <TokenCtx.Consumer>\n        {(token) => (\n          <div>\n            <div className=\"login-form box\">\n              {token.value ? (\n                <div>\n                  <p>\n                    <b>您已登录。</b>\n                    <button\n                      type=\"button\"\n                      onClick={() => {\n                        fetch(\n                          API_ROOT + 'security/logout?' + API_VERSION_PARAM(),\n                          {\n                            method: 'POST',\n                            headers: {\n                              TOKEN: token.value,\n                            },\n                          },\n                        )\n                          .then(get_json)\n                          .then((json) => {\n                            if (json.code !== 0) throw new Error(json.msg);\n                            token.set_value(null);\n                          })\n                          .catch((err) => {\n                            console.error(err);\n                            alert('' + err);\n                            token.set_value(null);\n                          });\n                      }}\n                    >\n                      <span className=\"icon icon-logout\" /> 注销\n                    </button>\n                    <br />\n                  </p>\n                  <p>\n                    <a\n                      onClick={() => {\n                        this.props.show_sidebar(\n                          '系统消息',\n                          <MessageViewer token={token.value} />,\n                        );\n                      }}\n                    >\n                      查看系统消息\n                    </a>\n                    <br />\n                    当您发送的内容违规时，我们将用系统消息提示您\n                  </p>\n                  {/*<p>*/}\n                  {/*  <a onClick={this.copy_token.bind(this, token.value)}>*/}\n                  {/*    复制 User Token*/}\n                  {/*  </a>*/}\n                  {/*  <br />*/}\n                  {/*  复制 User Token*/}\n                  {/*  可以在新设备登录，切勿告知他人。若怀疑被盗号请重新邮箱验证码登录以重置Token。*/}\n                  {/*</p>*/}\n                </div>\n              ) : (\n                <LoginPopup token_callback={token.set_value}>\n                  {(do_popup) => (\n                    <div>\n                      <p>\n                        <button type=\"button\" onClick={do_popup}>\n                          <span className=\"icon icon-login\" />\n                          &nbsp;登录\n                        </button>\n                      </p>\n                      <p>\n                        <small>\n                          {process.env.REACT_APP_TITLE}\n                          面向T大学生，通过T大邮箱验证您的身份并提供服务。\n                        </small>\n                      </p>\n                    </div>\n                  )}\n                </LoginPopup>\n              )}\n            </div>\n          </div>\n        )}\n      </TokenCtx.Consumer>\n    );\n  }\n}\n\nexport class VoteEditBox extends Component {\n  constructor(props) {\n    super(props);\n    this.onChangeCheckAndSend = this.checkAndSend.bind(this);\n  }\n  checkAndSend(order) {\n    return (value) => {\n      const { sendVoteData } = this.props;\n      sendVoteData({ [order]: value });\n    };\n  }\n  render() {\n    let { num } = this.props;\n    const inputPile = [];\n    for (let i = 0; i < num; i += 1) {\n      inputPile.push(\n        <input\n          key={i}\n          maxLength=\"15\"\n          style={{ padding: '0 2px', margin: '2px 2px' }}\n          onChange={(event) => {\n            this.onChangeCheckAndSend(i + 1)(event.target.value);\n          }}\n          placeholder={i + 1}\n        />,\n      );\n    }\n    return (\n      <div>\n        <hr />\n        <p>设置2~4个选项，每项不超过15字符</p>\n        {inputPile}\n      </div>\n    );\n  }\n}\n\nexport class PostForm extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      text: '',\n      loading_status: 'done',\n      img_tip: null,\n      preview: false,\n      vote: false,\n      voteOptionNum: 0,\n      voteData: { 1: null, 2: null, 3: null, 4: null },\n      tag: '可选标签',\n    };\n    this.img_ref = React.createRef();\n    this.area_ref = this.props.area_ref || React.createRef();\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_img_change_bound = this.on_img_change.bind(this);\n    this.global_keypress_handler_bound = this.global_keypress_handler.bind(\n      this,\n    );\n    this.color_picker = new ColorPicker();\n  }\n\n  global_keypress_handler(e) {\n    if (\n      e.code === 'Enter' &&\n      !e.ctrlKey &&\n      !e.altKey &&\n      ['input', 'textarea'].indexOf(e.target.tagName.toLowerCase()) === -1\n    ) {\n      if (this.area_ref.current) {\n        e.preventDefault();\n        this.area_ref.current.focus();\n      }\n    }\n  }\n  componentDidMount() {\n    document.addEventListener('keypress', this.global_keypress_handler_bound);\n  }\n  componentWillUnmount() {\n    document.removeEventListener(\n      'keypress',\n      this.global_keypress_handler_bound,\n    );\n  }\n\n  on_change(value) {\n    this.setState({\n      text: value,\n    });\n  }\n\n  do_post(text, img) {\n    let data = new URLSearchParams();\n    let path;\n    if (this.props.action === 'docomment') {\n      data.append('pid', this.props.pid);\n      data.append('reply_to_cid', this.props.reply_to_ref.reply_to);\n      path = 'send/comment?';\n    } else {\n      path = 'send/post?';\n    }\n    data.append('text', this.state.text);\n    data.append('type', img ? 'image' : 'text');\n    if (this.state.tag !== '可选标签') {\n      data.append('tag', this.state.tag);\n    }\n    if (img) data.append('data', img);\n    // 投票\n    if (this.state.vote) {\n      let voteObj = this.state.voteData;\n      Object.keys(voteObj).forEach((item) => {\n        if (!voteObj[item]) delete voteObj[item];\n      });\n      let voteArray = Object.values(voteObj);\n      voteArray.map((char) => {\n        data.append('vote_options[]', char);\n      });\n    }\n\n    // fetch发送\n    fetch(API_ROOT + path + API_VERSION_PARAM(), {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        TOKEN: this.props.token,\n      },\n      body: data,\n    })\n      .then(get_json)\n      .then((json) => {\n        if (json.code !== 0) {\n          if (json.msg) alert(json.msg);\n          throw new Error(JSON.stringify(json));\n        }\n        this.setState({\n          loading_status: 'done',\n          text: '',\n          preview: false,\n        });\n        this.area_ref.current.clear();\n        this.props.on_complete();\n      })\n      .catch((e) => {\n        console.error(e);\n        alert('发表失败');\n        this.setState({\n          loading_status: 'done',\n        });\n      });\n  }\n\n  proc_img(file) {\n    return new Promise((resolve, reject) => {\n      function return_url(url) {\n        const idx = url.indexOf(';base64,');\n        if (idx === -1) throw new Error('img not base64 encoded');\n\n        return url.substr(idx + 8);\n      }\n\n      let reader = new FileReader();\n      function on_got_img(url) {\n        const image = new Image();\n        image.onload = () => {\n          let width = image.width;\n          let height = image.height;\n          let compressed = false;\n\n          if (width > MAX_IMG_DIAM) {\n            height = (height * MAX_IMG_DIAM) / width;\n            width = MAX_IMG_DIAM;\n            compressed = true;\n          }\n          if (height > MAX_IMG_DIAM) {\n            width = (width * MAX_IMG_DIAM) / height;\n            height = MAX_IMG_DIAM;\n            compressed = true;\n          }\n          if (height * width > MAX_IMG_PX) {\n            let rate = Math.sqrt((height * width) / MAX_IMG_PX);\n            height /= rate;\n            width /= rate;\n            compressed = true;\n          }\n          console.log('chosen img size', width, height);\n\n          let canvas = document.createElement('canvas');\n          let ctx = canvas.getContext('2d');\n          canvas.width = width;\n          canvas.height = height;\n          ctx.drawImage(image, 0, 0, width, height);\n\n          let quality_l = 0.1,\n            quality_r = 0.9,\n            quality,\n            new_url;\n          while (quality_r - quality_l >= 0.03) {\n            quality = (quality_r + quality_l) / 2;\n            new_url = canvas.toDataURL('image/jpeg', quality);\n            console.log(\n              quality_l,\n              quality_r,\n              'trying quality',\n              quality,\n              'size',\n              new_url.length,\n            );\n            if (new_url.length <= MAX_IMG_FILESIZE) quality_l = quality;\n            else quality_r = quality;\n          }\n          if (quality_l >= 0.101) {\n            console.log('chosen img quality', quality);\n            resolve({\n              img: return_url(new_url),\n              quality: quality,\n              width: Math.round(width),\n              height: Math.round(height),\n              compressed: compressed,\n            });\n          } else {\n            reject('图片过大，无法上传');\n          }\n        };\n        image.src = url;\n      }\n      reader.onload = (event) => {\n        fixOrientation(event.target.result, {}, (fixed_dataurl) => {\n          on_got_img(fixed_dataurl);\n        });\n      };\n      reader.readAsDataURL(file);\n    });\n  }\n\n  on_img_change() {\n    if (this.img_ref.current && this.img_ref.current.files.length)\n      this.setState(\n        {\n          img_tip: '（正在处理图片……）',\n        },\n        () => {\n          this.proc_img(this.img_ref.current.files[0])\n            .then((d) => {\n              this.setState({\n                img_tip:\n                  `（${d.compressed ? '压缩到' : '尺寸'} ${d.width}*${\n                    d.height\n                  } / ` +\n                  `质量 ${Math.floor(d.quality * 100)}% / ${Math.floor(\n                    d.img.length / BASE64_RATE / 1000,\n                  )}KB）`,\n              });\n            })\n            .catch((e) => {\n              this.setState({\n                img_tip: `图片无效：${e}`,\n              });\n            });\n        },\n      );\n    else\n      this.setState({\n        img_tip: null,\n      });\n  }\n\n  on_submit(event) {\n    if (event) event.preventDefault();\n    if (this.state.loading_status === 'loading') return;\n    if (this.img_ref.current.files.length) {\n      this.setState({\n        loading_status: 'processing',\n      });\n      this.proc_img(this.img_ref.current.files[0])\n        .then((d) => {\n          this.setState({\n            loading_status: 'loading',\n          });\n          this.do_post(this.state.text, d.img);\n        })\n        .catch((e) => {\n          alert(e);\n        });\n    } else {\n      this.setState({\n        loading_status: 'loading',\n      });\n      this.do_post(this.state.text, null);\n    }\n  }\n\n  toggle_preview() {\n    this.setState({\n      preview: !this.state.preview,\n    });\n  }\n\n  addVote() {\n    let { voteOptionNum } = this.state;\n    if (voteOptionNum >= 4) {\n      alert('最大支持4个选项');\n    } else if (voteOptionNum == 0) {\n      voteOptionNum = 2;\n    } else {\n      voteOptionNum++;\n    }\n    this.setState({ voteOptionNum });\n  }\n\n  render() {\n    const { vote } = this.state;\n    let replyClassName =\n      'reply-form box' + (this.state.text ? ' reply-sticky' : '');\n    let tagsArrayAfter = process.env.REACT_APP_SENDABLE_TAGS.split(',');\n    return (\n      <form\n        onSubmit={this.on_submit.bind(this)}\n        className={\n          this.props.action === 'dopost' ? 'post-form box' : replyClassName\n        }\n      >\n        <div className=\"post-form-bar\">\n          <label>\n            {/*<a>上传图片</a>*/}\n            <span className={'post-upload'}>\n              <span className=\"icon icon-image\" />\n              &nbsp;插入图片\n            </span>\n            <input\n              ref={this.img_ref}\n              type=\"file\"\n              accept=\"image/*\"\n              disabled={this.state.loading_status !== 'done'}\n              onChange={this.on_img_change_bound}\n            />\n          </label>\n          {/* 发起投票，不可在评论区发送投票*/}\n          {this.props.action === 'dopost' ? (\n            !vote ? (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  this.setState({ vote: true, voteOptionNum: 2 });\n                }}\n              >\n                <span className=\"icon icon-how_to_vote\" />\n                &nbsp;投票\n              </button>\n            ) : (\n              <button\n                type=\"button\"\n                onClick={() => {\n                  this.addVote();\n                }}\n              >\n                <span className=\"icon icon-how_to_vote\" />\n                &nbsp;添加\n              </button>\n            )\n          ) : (\n            <div></div>\n          )}\n          {this.state.preview ? (\n            <button\n              type=\"button\"\n              onClick={() => {\n                this.toggle_preview();\n              }}\n            >\n              <span className=\"icon icon-eye-blocked\" />\n              &nbsp;编辑\n            </button>\n          ) : (\n            <button\n              type=\"button\"\n              onClick={() => {\n                this.toggle_preview();\n              }}\n            >\n              <span className=\"icon icon-eye\" />\n              &nbsp;预览\n            </button>\n          )}\n          {this.state.loading_status !== 'done' ? (\n            <button disabled=\"disabled\">\n              <span className=\"icon icon-loading\" />\n              &nbsp;\n              {this.state.loading_status === 'processing' ? '处理' : '上传'}\n            </button>\n          ) : (\n            <button type=\"submit\">\n              <span className=\"icon icon-send\" />\n              &nbsp;发表\n            </button>\n          )}\n        </div>\n        {!!this.state.img_tip && (\n          <p className=\"post-form-img-tip\">\n            <a\n              onClick={() => {\n                this.img_ref.current.value = '';\n                this.on_img_change();\n              }}\n            >\n              删除图片\n            </a>\n            {this.state.img_tip}\n          </p>\n        )}\n        {this.state.preview ? (\n          <div\n            className={\n              this.props.action === 'dopost' ? 'post-preview' : 'reply-preview'\n            }\n          >\n            <HighlightedMarkdown\n              text={this.state.text}\n              color_picker={this.color_picker}\n              show_pid={() => {}}\n            />\n          </div>\n        ) : (\n          <SafeTextarea\n            ref={this.area_ref}\n            id={this.props.pid}\n            on_change={this.on_change_bound}\n            on_submit={this.on_submit.bind(this)}\n          />\n        )}\n        {this.state.voteOptionNum !== 0 && (\n          <VoteEditBox\n            num={this.state.voteOptionNum}\n            sendVoteData={(voteDataObj) => {\n              let preVoteData = this.state.voteData;\n              Object.assign(preVoteData, voteDataObj);\n              this.setState({ voteData: preVoteData });\n            }}\n          />\n        )}\n        {this.props.action === 'dopost' && (\n          <div>\n            <small>\n              发帖前请阅读并同意\n              <a href={process.env.REACT_APP_RULES_URL} target=\"_blank\">\n                树洞规范\n              </a>\n              &nbsp;\n              <span style={{ float: 'right' }}>\n                <select\n                  className=\"selectCss\"\n                  onChange={(e) => this.setState({ tag: e.target.value })}\n                >\n                  <option className=\"selectOption\">可选标签</option>\n                  {tagsArrayAfter.map((tag, i) => (\n                    <option className=\"selectOption\" key={i} value={tag}>\n                      #{tag}\n                    </option>\n                  ))}\n                </select>\n              </span>\n            </small>\n          </div>\n        )}\n      </form>\n    );\n  }\n}\n","import React, {\n  Component,\n  PureComponent,\n  useContext,\n  useState,\n  useMemo,\n  useEffect,\n} from 'react';\nimport { CSSTransition, SwitchTransition } from 'react-transition-group';\nimport PubSub from 'pubsub-js';\nimport copy from 'copy-to-clipboard';\nimport ReactDOM from 'react-dom';\nconst { detect } = require('detect-browser');\nconst browser = detect();\nimport ImageSlides from 'react-imageslides';\nimport { API_ROOT } from './old_infrastructure/const';\nimport { ColorPicker } from './color_picker';\nimport {\n  split_text,\n  NICKNAME_RE,\n  PID_RE,\n  URL_RE,\n  // URL_PID_RE,\n} from './text_splitter';\nimport {\n  format_time,\n  Time,\n  TitleLine,\n  ClickHandler,\n  ColoredSpan,\n  HighlightedMarkdown,\n  escape_regex,\n} from './Common';\nimport './Flows.css';\nimport LazyLoad, { forceCheck } from './react-lazyload/src';\n// import { AudioWidget } from './AudioWidget';\nimport { TokenCtx, ReplyForm, PostForm, DoUpdate } from './UserAction';\nimport { API, API_VERSION_PARAM, get_json } from './flows_api';\nimport { nanoid } from 'nanoid';\nconst ADMIN_COMMANDS = [\n  'logs',\n  'rep_dels',\n  'rep_folds',\n  'log_tags',\n  'log_dels',\n  'rep_recalls',\n  'log_unbans',\n  'msgs',\n  'dels',\n];\nimport { cache } from './cache';\n\n// const process.env.REACT_APP_IMG_BASE_URL = 'https://thimg.yecdn.com/';\n// const process.env.REACT_APP_IMG_BASE_BAK_URL = 'https://img2.thuhole.com/';\n// const AUDIO_BASE=THUHOLE_API_ROOT+'services/thuhole/audios/';\n\nconst CLICKABLE_TAGS = { a: true, audio: true, button: true };\nconst PREVIEW_REPLY_COUNT = 10;\n// const QUOTE_BLACKLIST=['23333','233333','66666','666666','10086','10000','100000','99999','999999','55555','555555'];\nconst QUOTE_BLACKLIST = [];\n\nwindow.LATEST_POST_ID = parseInt(localStorage['_LATEST_POST_ID'], 10) || 0;\nlet not_show_deleted = false;\n\nconst DZ_NAME = '洞主';\n\nconst ImageComponent = (props) => (\n  <p className=\"img\">\n    <img\n      src={process.env.REACT_APP_IMG_BASE_URL + props.path}\n      onError={(e) => {\n        if (e.target.src === process.env.REACT_APP_IMG_BASE_URL + props.path) {\n          e.target.src = process.env.REACT_APP_IMG_BASE_BAK_URL + props.path;\n        }\n      }}\n      alt={process.env.REACT_APP_IMG_BASE_URL + props.path}\n    />\n  </p>\n);\n\nclass ImageViewer extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      visible: false,\n    };\n\n    this.popup_anchor = document.getElementById('img_viewer');\n    if (!this.popup_anchor) {\n      this.popup_anchor = document.createElement('div');\n      this.popup_anchor.id = 'img_viewer';\n      document.body.appendChild(this.popup_anchor);\n    }\n  }\n\n  render() {\n    if (!this.props.in_sidebar) {\n      return <ImageComponent path={this.props.url} />;\n    }\n    if (\n      browser &&\n      (browser.name === 'ios-webview' || browser.name === 'chromium-webview')\n    ) {\n      return (\n        <div>\n          <a\n            className=\"no-underline\"\n            onClick={() => {\n              this.setState({ visible: true });\n            }}\n            target=\"_blank\"\n          >\n            <ImageComponent path={this.props.url} />\n          </a>\n          {this.state.visible &&\n            ReactDOM.createPortal(\n              <div>\n                <ImageSlides\n                  images={[process.env.REACT_APP_IMG_BASE_URL + this.props.url]}\n                  isOpen\n                  onClose={() => {\n                    this.setState({ visible: false });\n                  }}\n                />\n              </div>,\n              this.popup_anchor,\n            )}\n        </div>\n      );\n    }\n    return (\n      <a\n        className=\"no-underline\"\n        href={process.env.REACT_APP_IMG_BASE_URL + this.props.url}\n        target=\"_blank\"\n      >\n        <ImageComponent path={this.props.url} />\n      </a>\n    );\n  }\n}\n\nexport function load_single_meta(show_sidebar, token) {\n  return (pid, replace = false) => {\n    pid = parseInt(pid);\n    let color_picker = new ColorPicker();\n    let title_elem = '树洞 #' + pid;\n    show_sidebar(\n      title_elem,\n      <div className=\"box box-tip\">正在加载 #{pid}</div>,\n      replace ? 'replace' : 'push',\n    );\n    API.load_replies(pid, token, color_picker)\n      .then((json) => {\n        show_sidebar(\n          title_elem,\n          <FlowSidebar\n            key={+new Date()}\n            info={json.post}\n            replies={json.data}\n            token={token}\n            show_sidebar={show_sidebar}\n            color_picker={color_picker}\n          />,\n          'replace',\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        show_sidebar(\n          title_elem,\n          <div className=\"box box-tip\">\n            <p>\n              <a\n                onClick={() => load_single_meta(show_sidebar, token)(pid, true)}\n              >\n                重新加载\n              </a>\n            </p>\n            <p>{'' + e}</p>\n          </div>,\n          'replace',\n        );\n      });\n  };\n}\n\nfunction search_hit(txt, search_param) {\n  new RegExp(\n    `(${search_param\n      .split(' ')\n      .filter((x) => !!x)\n      .map(escape_regex)\n      .join('|')})`,\n    'gi',\n  ).test(txt);\n  // return terms.filter((t) => t).some((term) => txt.indexOf(term) !== -1);\n}\n\nclass Reply extends PureComponent {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    if (\n      this.props.info.deleted &&\n      not_show_deleted &&\n      !ADMIN_COMMANDS.includes(this.props.search_param)\n    ) {\n      return <></>;\n    }\n\n    let props = this.props;\n\n    const author = '[' + this.props.info.name + ']',\n      replyText = this.props.info.text;\n    return (\n      <div\n        className={'flow-reply box'}\n        style={\n          this.props.info._display_color\n            ? {\n                '--box-bgcolor-light': this.props.info._display_color[0],\n                '--box-bgcolor-dark': this.props.info._display_color[1],\n              }\n            : null\n        }\n      >\n        <div className=\"box-header\">\n          {props.header_badges}\n          <code className=\"box-id\">#{this.props.info.cid}</code>\n          &nbsp;\n          {this.props.info.tag !== null && (\n            <span className=\"box-header-tag\">{this.props.info.tag}</span>\n          )}\n          <Time stamp={this.props.info.timestamp} short={false} />\n        </div>\n        {this.props.info.deleted && (\n          <p key=\"deleted-hint\" className=\"flow-variant-warning\">\n            （已删除）\n          </p>\n        )}\n        {this.props.info.variant.report_widget && this.props.in_sidebar && (\n          <ReportWidget\n            key=\"report\"\n            info={props.info}\n            is_reply={true}\n            set_variant={props.set_variant}\n          />\n        )}\n        <div className=\"box-content\">\n          <HighlightedMarkdown\n            author={author}\n            text={replyText}\n            search_param={this.props.search_param}\n            color_picker={this.props.color_picker}\n            show_pid={this.props.show_pid}\n          />\n          {this.props.info.type === 'image' && (\n            <ImageViewer\n              in_sidebar={this.props.in_sidebar}\n              url={this.props.info.url}\n            />\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n\nfunction ReportWidget(props) {\n  let [fold_reason, set_fold_reason] = useState('');\n  let [tag_text, set_tag_text] = useState('others');\n\n  function report(report_type) {\n    const item_type = props.is_reply ? 'comment' : 'post';\n    let id = props.is_reply ? props.info.cid : props.info.pid;\n\n    let report_type_str = {\n      fold: '举报折叠',\n      delete: '删除',\n      undelete_unban: '撤销删除',\n      delete_ban: '删帖禁言',\n      unban: '解封',\n      set_tag: '打tag',\n      report: '举报删除',\n    }[report_type];\n    let item_type_str = { post: '树洞', comment: '评论' }[item_type];\n\n    let reason;\n    switch (report_type) {\n      case 'fold':\n        reason = fold_reason;\n        if (reason === 'select') return;\n        if (\n          !window.confirm(\n            `确认因为 ${reason} 举报折叠 ${item_type_str} #${id} 吗？`,\n          )\n        )\n          return;\n        break;\n      case 'set_tag':\n        reason = tag_text;\n        if (reason === 'select') return;\n        if (reason === 'others') {\n          reason = window.prompt(item_type_str + ' #' + id + ' 的tag：');\n          if (!reason) return;\n        }\n        if (\n          !window.confirm(`确认设置${item_type_str} #${id}的tag=${reason}吗？`)\n        )\n          return;\n        break;\n      case 'report':\n      default:\n        reason = window.prompt(\n          `${report_type_str}` + item_type_str + ' #' + id + ' 的理由：',\n        );\n        if (!reason) return;\n        if (\n          !window.confirm(\n            `确认因为 ${reason} 的理由 ${report_type_str} ${item_type_str} #${id} 吗？`,\n          )\n        )\n          return;\n        break;\n    }\n\n    let token = localStorage['TOKEN'];\n    API.report(item_type, id, report_type, reason, token)\n      .then((json) => {\n        alert(`${report_type_str}成功`);\n      })\n      .catch((e) => {\n        alert('举报失败：' + e);\n        console.error(e);\n      });\n  }\n\n  return (\n    <div className=\"interactive flow-item-toolbar report-toolbar\">\n      {!props.info.permissions.includes('set_tag') &&\n        props.info.permissions.includes('fold') && (\n          <p>\n            <button onClick={() => report('fold')}>折叠</button>\n            <select\n              value={fold_reason}\n              onChange={(e) => set_fold_reason(e.target.value)}\n            >\n              <option value=\"select\">选择理由……</option>\n              {process.env.REACT_APP_REPORTABLE_TAGS.split(',').map(\n                (tag, i) => (\n                  <option key={i} value={tag}>\n                    #{tag}\n                  </option>\n                ),\n              )}\n            </select>\n          </p>\n        )}\n      {!props.info.permissions.includes('delete') &&\n        !props.info.permissions.includes('undelete_unban') &&\n        props.info.permissions.includes('report') && (\n          <p>\n            <button onClick={() => report('report')}>删除</button>\n            <span className=\"report-reason\">\n              这条{props.is_reply ? '回复' : '树洞'}违反\n              <a href={process.env.REACT_APP_RULES_URL} target=\"_blank\">\n                社区规范\n              </a>\n              ，应被禁止\n            </span>\n          </p>\n        )}\n      {props.info.permissions.includes('delete') && (\n        <p>\n          <button onClick={() => report('delete')}>\n            {props.info.permissions.includes('delete_ban') ? '删除' : '撤回'}\n          </button>\n          <span className=\"report-reason\">\n            {props.info.permissions.includes('delete_ban')\n              ? '没有禁言惩罚的删除。'\n              : '树洞发送两分钟内可以撤回，不会禁言。'}\n          </span>\n        </p>\n      )}\n      {props.info.permissions.includes('undelete_unban') && (\n        <p>\n          <button onClick={() => report('undelete_unban')}>撤销删除</button>\n          <span className=\"report-reason\">\n            撤销删除并解除禁言（如果存在禁言的话）\n          </span>\n        </p>\n      )}\n      {props.info.permissions.includes('delete_ban') && (\n        <p>\n          <button onClick={() => report('delete_ban')}>删帖禁言</button>\n          <span className=\"report-reason\">\n            删除并禁言。删除理由会通知用户。\n          </span>\n        </p>\n      )}\n      {props.info.permissions.includes('unban') && (\n        <p>\n          <button onClick={() => report('unban')}>解封</button>\n          <span className=\"report-reason\">解封，但不撤销删除</span>\n        </p>\n      )}\n      {props.info.permissions.includes('set_tag') && (\n        <p>\n          <button onClick={() => report('set_tag')}>打tag</button>\n          <select\n            value={tag_text}\n            onChange={(e) => set_tag_text(e.target.value)}\n          >\n            <option value=\"select\">选择理由……</option>\n            {process.env.REACT_APP_REPORTABLE_TAGS.split(',').map((tag, i) => (\n              <option key={i} value={tag}>\n                #{tag}\n              </option>\n            ))}\n            <option value=\"\">无tag</option>\n            <option value=\"others\">其他</option>\n          </select>\n        </p>\n      )}\n    </div>\n  );\n}\n\nclass VoteShowBox extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      alreadyVote: false,\n      yourVoteText: '',\n      yourVoteIndex: null,\n      totalCount: 0,\n      eachNums: [],\n      loading: false,\n      vote_data: 0,\n    };\n    this.sendVoteOption = this.sendVote.bind(this);\n  }\n  componentDidMount() {\n    const {\n      voteOptions: { voted, vote_data },\n    } = this.props;\n    let totalCount = 0;\n    let opIndex = 0;\n    let yourVoteIndex = null;\n    let eachNums = [];\n    if (voted !== '') {\n      for (let option in vote_data) {\n        eachNums.push(vote_data[option]);\n        totalCount += vote_data[option];\n        if (voted === option) {\n          yourVoteIndex = opIndex;\n        }\n        opIndex++;\n      }\n      this.setState({\n        alreadyVote: true,\n        yourVoteText: voted,\n        yourVoteIndex,\n        totalCount,\n        eachNums,\n      });\n    }\n  }\n  sendVote(optionText) {\n    let data = new URLSearchParams();\n    let path = 'send/vote?';\n    const { pid } = this.props;\n    data.append('pid', pid);\n    data.append('option', optionText);\n    this.setState({ loading: true });\n    // fetch发送\n    fetch(API_ROOT + path + API_VERSION_PARAM(), {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        TOKEN: this.props.token,\n      },\n      body: data,\n    })\n      .then(get_json)\n      .then((json) => {\n        if (json.code !== 0) {\n          if (json.msg) alert(json.msg);\n          throw new Error(JSON.stringify(json));\n        }\n        // 投完票后从json中获取票数\n        const { voted, vote_data } = json.vote;\n        let totalCount = 0;\n        let opIndex = 0;\n        let yourVoteIndex = null;\n        let eachNums = [];\n        if (voted !== '') {\n          for (let option in vote_data) {\n            eachNums.push(vote_data[option]);\n            totalCount += vote_data[option];\n            if (voted === option) {\n              yourVoteIndex = opIndex;\n            }\n            opIndex++;\n          }\n          this.setState({\n            alreadyVote: true,\n            yourVoteText: voted,\n            loading: false,\n            yourVoteIndex,\n            totalCount,\n            eachNums,\n            vote_data,\n          });\n          // 通知FlowItemRow在点击后先刷新\n          // 发送pid，限制某pid更新，不会波及到其他FlowItemRow\n          PubSub.publish('VoteDoneClickFreshSideBarFirst', this.props.pid);\n        }\n      })\n      .catch((e) => {\n        console.error(e);\n        alert('投票失败');\n        this.setState({\n          alreadyVote: false,\n          loading: false,\n        });\n      });\n  }\n  render() {\n    const {\n      alreadyVote,\n      eachNums,\n      yourVoteIndex,\n      totalCount,\n      loading,\n    } = this.state;\n    let { vote_data } = this.state;\n    if (vote_data == 0) {\n      vote_data = this.props.voteOptions.vote_data;\n    }\n    const voteData = Object.keys(vote_data);\n    const resultPile = [];\n    const buttonPile = [];\n    if (alreadyVote) {\n      // 结果显示组\n      voteData.map((voteSingle, index) => {\n        resultPile.push(\n          index == yourVoteIndex ? (\n            <div\n              key={nanoid()}\n              className=\"div-shell\"\n              style={{ borderColor: '#ffe5d8' }}\n            >\n              <div className=\"div-background\"></div>\n              <div\n                className=\"div-votedOptionBar\"\n                style={{ width: (eachNums[index] / totalCount) * 100 + '%' }}\n              ></div>\n              <div className=\"div-text\">\n                <p\n                  className=\"p-voteDataShow\"\n                  style={{\n                    left: '0.5em',\n                    fontSize: voteSingle.length > 18 ? '12px' : '14px',\n                  }}\n                >\n                  {voteSingle}\n                </p>\n                <p\n                  className=\"p-voteDataShow-right\"\n                  style={{\n                    right: '0.5em',\n                    fontSize: eachNums[index] > 999 ? '12px' : '14px',\n                  }}\n                >\n                  {eachNums[index]}\n                </p>\n                <span className=\"liu_area\"></span>\n              </div>\n            </div>\n          ) : (\n            <div key={nanoid()} className=\"div-shell\">\n              <div className=\"div-background\"></div>\n              <div\n                className=\"div-optionBar\"\n                style={{\n                  width: (eachNums[index] / totalCount) * 100 + '%',\n                  display: eachNums[index] == 0 ? 'none' : 'inline',\n                }}\n              ></div>\n              <div className=\"div-text\">\n                <p\n                  className=\"p-voteDataShow\"\n                  style={{\n                    left: '0.5em',\n                    fontSize: voteSingle.length > 18 ? '12px' : '14px',\n                  }}\n                >\n                  {voteSingle}\n                </p>\n                <p\n                  className=\"p-voteDataShow-right\"\n                  style={{\n                    right: '0.5em',\n                    fontSize: eachNums[index] > 999 ? '12px' : '14px',\n                  }}\n                >\n                  {eachNums[index]}\n                </p>\n                <span className=\"liu_area\"></span>\n              </div>\n            </div>\n          ),\n        );\n      });\n    } else {\n      // 投票按钮组\n      voteData.map((voteSingle, index) => {\n        buttonPile.push(\n          <button\n            className=\"voteButton\"\n            key={index}\n            onClick={(event) => {\n              this.sendVoteOption(event.target.innerText);\n            }}\n          >\n            {voteSingle}\n          </button>,\n        );\n      });\n    }\n    if (loading) {\n      return <p className=\"box box-tip\">投票中……</p>;\n    }\n    return (\n      <div>\n        <hr />\n        <div className=\"voteGroupPanel\">\n          {alreadyVote ? <div>{resultPile}</div> : <div>{buttonPile}</div>}\n        </div>\n      </div>\n    );\n  }\n}\n\nclass FlowItem extends PureComponent {\n  copy_link(event) {\n    event.preventDefault();\n    copy(\n      `${event.target.href}${\n        this.props.info.tag ? ' 【' + this.props.info.tag + '】' : ''\n      }\\n` +\n        `${this.props.info.text}${\n          this.props.info.type === 'image'\n            ? ' [图片]'\n            : this.props.info.type === 'audio'\n            ? ' [语音]'\n            : ''\n        }\\n` +\n        `（${format_time(new Date(this.props.info.timestamp * 1000))} ${\n          this.props.info.likenum\n        }关注 ${this.props.info.reply}回复）\\n` +\n        `${\n          this.props.info.vote && this.props.info.vote.vote_options\n            ? '\\n【投票】：' +\n              this.props.info.vote.vote_options.map((v) => v).join('\\n')\n            : ''\n        }\\n` +\n        this.props.replies\n          .map(\n            (r) =>\n              (r.tag ? '【' + r.tag + '】' : '') +\n              '[' +\n              r.name +\n              '] ' +\n              r.text +\n              (r.type === 'image' ? ' [图片]' : ''),\n          )\n          .join('\\n'),\n    );\n  }\n\n  render() {\n    let props = this.props;\n    let voteOptionNum = Object.keys(props.info.vote).length;\n    return (\n      <div\n        className={\n          'flow-item' +\n          (props.is_quote ? ' flow-item-quote' : '') +\n          (props.from_msg ? ' flow-item-compact' : '')\n        }\n      >\n        {!!props.is_quote && (\n          <div className=\"quote-tip black-outline\">\n            <div>\n              <span className=\"icon icon-quote\" />\n            </div>\n          </div>\n        )}\n        <div className=\"box\">\n          {!!window.LATEST_POST_ID && props.info.pid > window.LATEST_POST_ID ? (\n            <div className=\"flow-item-dot flow-item-dot-post\" />\n          ) : props.info.variant.new_reply ? (\n            <div className=\"flow-item-dot flow-item-dot-comment\" />\n          ) : null}\n          <div className=\"box-header\">\n            {props.header_badges}\n            <code className=\"box-id\">\n              <a\n                href={'##' + props.info.pid}\n                onClick={this.copy_link.bind(this)}\n              >\n                #{props.info.pid}\n              </a>\n            </code>\n            &nbsp;\n            {props.info.tag !== null && (\n              <span className=\"box-header-tag\">{props.info.tag}</span>\n            )}\n            <Time stamp={props.info.timestamp} short={!props.in_sidebar} />\n          </div>\n          {props.info.deleted && (\n            <p key=\"deleted-hint\" className=\"flow-variant-warning\">\n              （已删除）\n            </p>\n          )}\n          {props.info.variant.report_widget && props.in_sidebar && (\n            <ReportWidget\n              key=\"report\"\n              info={props.info}\n              is_reply={false}\n              set_variant={props.set_variant}\n            />\n          )}\n          <div className=\"box-content\">\n            <HighlightedMarkdown\n              text={props.info.text}\n              color_picker={props.color_picker}\n              search_param={props.search_param}\n              show_pid={props.show_pid}\n            />\n            {props.info.type === 'image' && (\n              <ImageViewer in_sidebar={props.in_sidebar} url={props.info.url} />\n            )}\n          </div>\n          {voteOptionNum !== 0 && (\n            <VoteShowBox\n              voteOptions={props.info.vote}\n              // voteOptions={{vote_data:{第一个选项:300,第二个选项第二个选项:200,第三个选项第三个选项第三个选项:400,第四个选项第四个选项第四个选项:1000},voted:\"第四个选项第四个选项第四个选项\"}}\n              pid={props.info.pid}\n              token={this.props.token}\n            />\n          )}\n          {!!(props.attention && props.info.variant.latest_reply) && (\n            <p className=\"box-footer\">\n              最新回复{' '}\n              <Time stamp={props.info.variant.latest_reply} short={false} />\n            </p>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n\nclass FlowSidebar extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      info: props.info,\n      replies: props.replies,\n      loading_status: 'done',\n      error_msg: null,\n      filter_name: null,\n      rev: !!this.props.reverse,\n    };\n    this.color_picker = props.color_picker;\n    this.syncState = props.sync_state || (() => {});\n    this.reply_ref = React.createRef();\n    this.reply_to_ref = { reply_to: -1 };\n  }\n  componentDidMount() {\n    if (this.props.freshFirst) {\n      this.load_replies();\n    }\n  }\n  set_variant(cid, variant) {\n    this.setState(\n      (prev) => {\n        if (cid)\n          return {\n            replies: prev.replies.map((reply) => {\n              if (reply.cid === cid)\n                return Object.assign({}, reply, {\n                  variant: Object.assign({}, reply.variant, variant),\n                });\n              else return reply;\n            }),\n          };\n        else\n          return {\n            info: Object.assign({}, prev.info, {\n              variant: Object.assign({}, prev.info.variant, variant),\n            }),\n          };\n      },\n      function () {\n        this.syncState({\n          info: this.state.info,\n          replies: this.state.replies,\n        });\n      },\n    );\n  }\n\n  load_replies() {\n    this.setState({\n      loading_status: 'loading',\n      error_msg: null,\n    });\n    API.load_replies(this.state.info.pid, this.props.token, this.color_picker)\n      .then((json) => {\n        this.setState(\n          {\n            replies: json.data,\n            info: json.post,\n            loading_status: 'done',\n            error_msg: null,\n          },\n          () => {\n            this.syncState({\n              replies: json.data,\n              info: json.post,\n            });\n            if (json.data.length)\n              this.set_variant(null, {\n                latest_reply: Math.max.apply(\n                  null,\n                  this.state.replies.map((r) => r.timestamp),\n                ),\n              });\n          },\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState({\n          replies: [],\n          loading_status: 'done',\n          error_msg: '' + e,\n        });\n      });\n  }\n\n  toggle_attention() {\n    this.setState({\n      loading_status: 'loading',\n    });\n    const next_attention = !this.state.info.attention;\n    API.set_attention(this.state.info.pid, next_attention, this.props.token)\n      .then((json) => {\n        if (json.data.length)\n          json.data.variant = {\n            latest_reply: Math.max.apply(\n              null,\n              json.data.map((r) => r.timestamp),\n            ),\n          };\n        else json.data.variant = {};\n\n        this.setState({\n          loading_status: 'done',\n          info: json.data,\n        });\n        this.syncState({\n          info: json.data,\n        });\n      })\n      .catch((e) => {\n        this.setState({\n          loading_status: 'done',\n        });\n        alert('设置关注失败');\n        console.error(e);\n      });\n  }\n\n  set_filter_name(name) {\n    this.setState((prevState) => ({\n      filter_name: name === prevState.filter_name ? null : name,\n    }));\n  }\n\n  toggle_rev() {\n    this.setState((prevState) => ({\n      rev: !prevState.rev,\n    }));\n  }\n\n  show_reply_bar(name, reply_to, event) {\n    this.reply_to_ref.reply_to = reply_to;\n    if (\n      this.reply_ref.current &&\n      !event.target.closest('a, .clickable, .interactive')\n    ) {\n      let text = this.reply_ref.current.get();\n      if (\n        /^\\s*(?:Re (?:|洞主|(?:[A-Z][a-z]+ )?(?:[A-Z][a-z]+)|You Win(?: \\d+)?):)?\\s*$/.test(\n          text,\n        )\n      ) {\n        // text is nearly empty so we can replace it\n        let should_text = 'Re ' + name + ': ';\n        if (should_text === this.reply_ref.current.get())\n          this.reply_ref.current.set('');\n        else this.reply_ref.current.set(should_text);\n      }\n    }\n  }\n\n  render_self() {\n    if (this.state.loading_status === 'loading')\n      return <p className=\"box box-tip\">加载中……</p>;\n\n    let show_pid = load_single_meta(this.props.show_sidebar, this.props.token);\n\n    let replies_to_show = this.state.filter_name\n      ? this.state.replies.filter((r) => r.name === this.state.filter_name)\n      : this.state.replies.slice();\n    if (this.state.rev) replies_to_show.reverse();\n\n    // key for lazyload elem\n    let view_mode_key =\n      (this.state.rev ? 'y-' : 'n-') + (this.state.filter_name || 'null');\n\n    let replies_cnt = { [DZ_NAME]: 1 };\n    replies_to_show.forEach((r) => {\n      if (replies_cnt[r.name] === undefined) replies_cnt[r.name] = 0;\n      replies_cnt[r.name]++;\n    });\n\n    // hide main thread when filtered\n    let main_thread_elem =\n      this.state.filter_name && this.state.filter_name !== DZ_NAME ? null : (\n        <ClickHandler\n          callback={(e) => {\n            this.show_reply_bar('', -1, e);\n          }}\n        >\n          <FlowItem\n            token={this.props.token}\n            info={this.state.info}\n            in_sidebar={true}\n            color_picker={this.color_picker}\n            show_pid={show_pid}\n            replies={this.state.replies}\n            set_variant={(variant) => {\n              this.set_variant(null, variant);\n            }}\n            header_badges={\n              <>\n                {this.state.info.permissions.length > 0 &&\n                  (!this.state.info.variant.report_widget ? (\n                    <span\n                      className=\"reply-header-badge clickable\"\n                      onClick={() => {\n                        this.set_variant(null, { report_widget: true });\n                      }}\n                    >\n                      <span className=\"icon icon-flag\" />\n                      <label>\n                        {this.state.info.permissions.includes('delete') &&\n                        !this.state.info.permissions.includes('delete_ban')\n                          ? '撤回'\n                          : '举报'}\n                      </label>\n                    </span>\n                  ) : (\n                    <span\n                      className=\"reply-header-badge clickable\"\n                      onClick={() => {\n                        this.set_variant(null, { report_widget: false });\n                      }}\n                    >\n                      <span className=\"icon icon-flag\" />\n                      <label>取消</label>\n                    </span>\n                  ))}\n                {replies_cnt[DZ_NAME] > 1 && (\n                  <span\n                    className=\"reply-header-badge clickable\"\n                    onClick={() => {\n                      this.set_filter_name(DZ_NAME);\n                    }}\n                  >\n                    <span className=\"icon icon-locate\" />\n                    <label>只看</label>\n                  </span>\n                )}\n              </>\n            }\n          />\n        </ClickHandler>\n      );\n\n    return (\n      <div className=\"flow-item-row sidebar-flow-item\">\n        <div className=\"box box-tip\">\n          <a onClick={this.load_replies.bind(this)}>\n            <span className=\"icon icon-refresh\" />\n            <label>刷新</label>\n          </a>\n          {(this.state.replies.length >= 1 || this.state.rev) && (\n            <span>\n              &nbsp;&nbsp;\n              <a onClick={this.toggle_rev.bind(this)}>\n                <span\n                  className={\n                    'icon icon-order-rev' + (this.state.rev ? '-down' : '')\n                  }\n                />\n                <label>{this.state.info.reply} 回复</label>\n              </a>\n            </span>\n          )}\n          &nbsp;&nbsp;\n          <a\n            onClick={() => {\n              this.toggle_attention();\n            }}\n          >\n            <span>\n              <span\n                className={\n                  'icon icon-star' + (this.state.info.attention ? '-ok' : '')\n                }\n              />\n              <label>{this.state.info.likenum} 关注</label>\n            </span>\n          </a>\n        </div>\n        {!!this.state.filter_name && (\n          <div className=\"box box-tip flow-item filter-name-bar\">\n            <p>\n              <span style={{ float: 'left' }}>\n                <a\n                  onClick={() => {\n                    this.set_filter_name(null);\n                  }}\n                >\n                  还原\n                </a>\n              </span>\n              <span className=\"icon icon-locate\" />\n              &nbsp;当前只看&nbsp;\n              <ColoredSpan\n                colors={this.color_picker.get(this.state.filter_name)}\n              >\n                {this.state.filter_name}\n              </ColoredSpan>\n            </p>\n          </div>\n        )}\n        {!this.state.rev && main_thread_elem}\n        {!!this.state.error_msg && (\n          <div className=\"box box-tip flow-item\">\n            <p>回复加载失败</p>\n            <p>{this.state.error_msg}</p>\n          </div>\n        )}\n        {replies_to_show.map((reply, i) => (\n          <LazyLoad\n            key={i}\n            offset={1500}\n            height=\"5em\"\n            overflow={true}\n            once={true}\n          >\n            <ClickHandler\n              callback={(e) => {\n                this.show_reply_bar(reply.name, reply.cid, e);\n              }}\n            >\n              <Reply\n                info={reply}\n                color_picker={this.color_picker}\n                show_pid={show_pid}\n                in_sidebar={true}\n                set_variant={(variant) => {\n                  this.set_variant(reply.cid, variant);\n                }}\n                header_badges={\n                  <>\n                    {reply.permissions.length > 0 &&\n                      (!reply.variant.report_widget ? (\n                        <span\n                          className=\"reply-header-badge clickable\"\n                          onClick={() => {\n                            this.set_variant(reply.cid, {\n                              report_widget: true,\n                            });\n                          }}\n                        >\n                          <span className=\"icon icon-flag\" />\n                          {/*<label>举报</label>*/}\n                        </span>\n                      ) : (\n                        <span\n                          className=\"reply-header-badge clickable\"\n                          onClick={() => {\n                            this.set_variant(reply.cid, {\n                              report_widget: false,\n                            });\n                          }}\n                        >\n                          <span className=\"icon icon-flag\" />\n                          <label>取消</label>\n                        </span>\n                      ))}\n                    {replies_cnt[reply.name] > 1 && (\n                      <span\n                        className=\"reply-header-badge clickable\"\n                        onClick={() => {\n                          this.set_filter_name(reply.name);\n                        }}\n                      >\n                        <span className=\"icon icon-locate\" />\n                        {/*<label>只看</label>*/}\n                      </span>\n                    )}\n                  </>\n                }\n              />\n            </ClickHandler>\n          </LazyLoad>\n        ))}\n        {this.state.rev && main_thread_elem}\n        {this.props.token ? (\n          <PostForm\n            pid={this.state.info.pid}\n            token={this.props.token}\n            action={'docomment'}\n            area_ref={this.reply_ref}\n            reply_to_ref={this.reply_to_ref}\n            on_complete={this.load_replies.bind(this)}\n          />\n        ) : (\n          <div className=\"box box-tip flow-item\">登录后可以回复树洞</div>\n        )}\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <SwitchTransition mode=\"out-in\">\n        <CSSTransition\n          key={this.state.loading_status}\n          timeout={100}\n          classNames=\"flows-anim\"\n          appear={true}\n        >\n          {this.render_self()}\n        </CSSTransition>\n      </SwitchTransition>\n    );\n  }\n}\n\nclass FlowItemRow extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.needFold =\n      process.env.REACT_APP_FOLD_TAGS.split(',').indexOf(props.info.tag) > -1 &&\n      (props.search_param === '热榜' || !props.search_param) &&\n      !ADMIN_COMMANDS.includes(props.search_param) &&\n      window.config.fold &&\n      !props.info.attention;\n    this.state = {\n      freshFirst: false,\n      replies: props.replies || [],\n      reply_status: 'done',\n      reply_error: null,\n      info: Object.assign({}, props.info, { variant: {} }),\n      hidden:\n        window.config.block_words.some((word) =>\n          props.info.text.includes(word),\n        ) || this.needFold,\n    };\n    this.color_picker = this.props.color_picker || new ColorPicker();\n    this.pubSubToken = PubSub.subscribe(\n      'VoteDoneClickFreshSideBarFirst',\n      this.handleFreshForVote.bind(this),\n    );\n  }\n  handleFreshForVote(msg, data) {\n    if (this.props.info.pid == data) {\n      this.setState({ freshFirst: true });\n    }\n  }\n  componentWillUnmount() {\n    PubSub.unsubscribe(this.pubSubToken);\n  }\n  componentDidMount() {\n    if (\n      this.state.info.reply &&\n      this.state.replies.length === 0 &&\n      !this.state.info.comments\n    ) {\n      this.load_replies(null, /*update_post=*/ false);\n    } else if (this.state.info.comments) {\n      this.setState({\n        replies: this.state.info.comments.map((info) => {\n          info._display_color = this.color_picker.get(info.name);\n          return info;\n        }),\n        freshFirst: this.state.info.comments.length !== this.state.info.reply,\n      });\n    }\n  }\n\n  load_replies(callback, update_post = true) {\n    console.log('fetching reply', this.state.info.pid);\n    this.setState({\n      reply_status: 'loading',\n      reply_error: null,\n    });\n    API.load_replies_with_cache(\n      this.state.info.pid,\n      this.props.token,\n      this.color_picker,\n      this.state.info.updated_at,\n    )\n      .then((json) => {\n        this.setState(\n          (prev) => ({\n            replies: json.data,\n            info: {\n              ...(update_post ? json.post : prev.info),\n              variant: {\n                ...(prev.info.variant || {}),\n                ...json.post.variant,\n                latest_reply: Math.max.apply(\n                  null,\n                  json.data.map((r) => r.timestamp),\n                ),\n              },\n            },\n            reply_status: 'done',\n            reply_error: null,\n          }),\n          callback,\n        );\n      })\n      .catch((e) => {\n        console.error(e);\n        this.setState(\n          {\n            replies: [],\n            reply_status: 'failed',\n            reply_error: '' + e,\n          },\n          callback,\n        );\n      });\n  }\n\n  show_sidebar(freshFirst) {\n    this.props.show_sidebar(\n      '树洞 #' + this.state.info.pid,\n      <FlowSidebar\n        key={+new Date()}\n        info={this.state.info}\n        replies={this.state.replies}\n        sync_state={this.setState.bind(this)}\n        token={this.props.token}\n        show_sidebar={this.props.show_sidebar}\n        color_picker={this.color_picker}\n        freshFirst={freshFirst}\n        reverse={config.auto_order && this.props.from_msg}\n      />,\n    );\n  }\n\n  render() {\n    if (\n      this.state.info.deleted &&\n      not_show_deleted &&\n      !ADMIN_COMMANDS.includes(this.props.search_param)\n    ) {\n      return <></>;\n    }\n\n    let show_pid = load_single_meta(this.props.show_sidebar, this.props.token, [\n      this.state.info.pid,\n    ]);\n\n    let hl_rules = [\n      ['url', URL_RE],\n      ['pid', PID_RE],\n      ['nickname', NICKNAME_RE],\n    ];\n    let parts = split_text(this.state.info.text, hl_rules);\n\n    let quote_id = null;\n    if (!this.props.is_quote)\n      for (let [mode, content] of parts) {\n        content = content.length > 0 ? content.substring(1) : content;\n        if (\n          mode === 'pid' &&\n          QUOTE_BLACKLIST.indexOf(content) === -1 &&\n          (parseInt(content) < parseInt(this.state.info.pid) ||\n            ADMIN_COMMANDS.includes(this.props.search_param))\n        )\n          if (quote_id === null) quote_id = parseInt(content);\n          else {\n            quote_id = null;\n            break;\n          }\n      }\n\n    let showing_replies;\n    let shown_results = 0;\n    if (this.props.from_msg) {\n      showing_replies = [];\n    } else if (\n      !this.props.is_quote &&\n      this.props.search_param &&\n      this.props.search_param !== '' + this.state.info.pid &&\n      this.props.search_param !== '热榜' &&\n      this.props.search_param.charAt(0) !== '#'\n    ) {\n      // filter replies based on search param\n      let search_reg = new RegExp(\n        `(${this.props.search_param\n          .split(' ')\n          .filter((x) => !!x)\n          .map(escape_regex)\n          .join('|')})`,\n        'gi',\n      );\n      showing_replies = this.state.replies\n        .map((reply) => {\n          if (shown_results >= PREVIEW_REPLY_COUNT) return null;\n          if (\n            search_reg.test(reply.text) ||\n            (reply.deleted && this.props.search_param === 'dels')\n          ) {\n            shown_results++;\n            return (\n              <Reply\n                key={reply.cid}\n                info={reply}\n                color_picker={this.color_picker}\n                search_param={this.props.search_param}\n                show_pid={show_pid}\n                header_badges={null}\n                in_sidebar={false}\n                set_variant={(v) => {}}\n              />\n            );\n          } else return null;\n        })\n        .filter((x) => x !== null);\n    } // show all replies\n    else {\n      shown_results =\n        this.state.replies.length > PREVIEW_REPLY_COUNT\n          ? PREVIEW_REPLY_COUNT\n          : this.state.replies.length;\n      showing_replies = this.state.replies\n        .slice(0, PREVIEW_REPLY_COUNT)\n        .map((reply) => (\n          <Reply\n            key={reply.cid}\n            info={reply}\n            color_picker={this.color_picker}\n            search_param={this.props.search_param}\n            show_pid={show_pid}\n            header_badges={null}\n            in_sidebar={false}\n            set_variant={(v) => {}}\n          />\n        ));\n    }\n\n    let res = (\n      <div\n        className={\n          'flow-item-row flow-item-row-with-prompt' +\n          (this.props.is_quote ? ' flow-item-row-quote' : '')\n        }\n        onClick={(e) => {\n          if (!CLICKABLE_TAGS[e.target.tagName.toLowerCase()]) {\n            // 如果需要售出刷新就发送信号\n            if (this.state.freshFirst) {\n              this.show_sidebar(true);\n              this.setState({ freshFirst: false });\n            } else {\n              this.show_sidebar(false);\n            }\n          }\n        }}\n      >\n        <FlowItem\n          info={this.state.info}\n          in_sidebar={false}\n          is_quote={this.props.is_quote}\n          from_msg={this.props.from_msg}\n          color_picker={this.color_picker}\n          search_param={this.props.search_param}\n          show_pid={show_pid}\n          replies={this.state.replies}\n          set_variant={(v) => {}}\n          token={this.props.token}\n          header_badges={\n            <>\n              {!!this.state.info.likenum && (\n                <span className=\"box-header-badge\">\n                  {this.state.info.likenum}&nbsp;\n                  <span\n                    className={\n                      'icon icon-' +\n                      (this.state.info.attention ? 'star-ok' : 'star')\n                    }\n                  />\n                </span>\n              )}\n              {!!this.state.info.reply && (\n                <span className=\"box-header-badge\">\n                  {this.state.info.reply}&nbsp;\n                  <span className=\"icon icon-reply\" />\n                </span>\n              )}\n            </>\n          }\n        />\n        {!this.props.from_msg && (\n          <div className=\"flow-reply-row\">\n            {this.state.reply_status === 'loading' && (\n              <div className=\"box box-tip\">加载中</div>\n            )}\n            {this.state.reply_status === 'failed' && (\n              <div className=\"box box-tip\">\n                <p>\n                  <a\n                    onClick={() => {\n                      this.load_replies();\n                    }}\n                  >\n                    重新加载评论\n                  </a>\n                </p>\n                <p>{this.state.reply_error}</p>\n              </div>\n            )}\n            {showing_replies}\n            {this.state.info.reply > shown_results && (\n              <div className=\"box box-tip\">\n                还有 {this.state.info.reply - shown_results} 条\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    );\n\n    if (this.state.hidden) {\n      return (\n        <div\n          className=\"flow-item-row flow-item-row-with-prompt\"\n          onClick={(event) => {\n            if (!CLICKABLE_TAGS[event.target.tagName.toLowerCase()])\n              this.show_sidebar(this.state.freshFirst);\n          }}\n        >\n          <div\n            className={\n              'flow-item' + (this.props.is_quote ? ' flow-item-quote' : '')\n            }\n          >\n            {!!this.props.is_quote && (\n              <div className=\"quote-tip black-outline\">\n                <div>\n                  <span className=\"icon icon-quote\" />\n                </div>\n                {/*<div>*/}\n                {/*  <small>提到</small>*/}\n                {/*</div>*/}\n              </div>\n            )}\n            <div className=\"box\">\n              <div className=\"box-header\">\n                <code className=\"box-id\">#{this.props.info.pid}</code>\n                &nbsp;\n                {this.props.info.tag !== null && (\n                  <span className=\"box-header-tag\">{this.props.info.tag}</span>\n                )}\n                <Time stamp={this.props.info.timestamp} short={true} />\n                <span className=\"box-header-badge\">\n                  {this.needFold ? '已隐藏' : '已屏蔽'}\n                </span>\n                <div style={{ clear: 'both' }} />\n              </div>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return quote_id ? (\n      <div>\n        {res}\n        <FlowItemQuote\n          pid={quote_id}\n          show_sidebar={this.props.show_sidebar}\n          token={this.props.token}\n          search_param={this.props.search_param}\n        />\n      </div>\n    ) : (\n      res\n    );\n  }\n}\n\nexport class FlowItemQuote extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'empty',\n      error_msg: null,\n      info: null,\n    };\n    this.color_picker = this.props.color_picker || new ColorPicker();\n  }\n\n  componentDidMount() {\n    this.load();\n  }\n\n  load() {\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        API.load_replies(this.props.pid, this.props.token, this.color_picker)\n          .then((json) => {\n            this.setState({\n              loading_status: 'done',\n              info: json,\n            });\n          })\n          .catch((err) => {\n            if (('' + err).indexOf('找不到这条树洞') !== -1 && !this.props.from_msg)\n              this.setState({\n                loading_status: 'empty',\n              });\n            else\n              this.setState({\n                loading_status: 'error',\n                error_msg: '' + err,\n              });\n          });\n      },\n    );\n  }\n\n  render() {\n    if (this.state.loading_status === 'empty') return null;\n    else if (this.state.loading_status === 'loading')\n      return (\n        <div className=\"aux-margin\">\n          <div className=\"box box-tip\">\n            <span className=\"icon icon-loading\" />\n            提到了 #{this.props.pid}\n          </div>\n        </div>\n      );\n    else if (this.state.loading_status === 'error')\n      return (\n        <div className=\"aux-margin\">\n          <div className=\"box box-tip\">\n            <p>\n              <a onClick={this.load.bind(this)}>重新加载</a>\n            </p>\n            <p>{this.state.error_msg}</p>\n          </div>\n        </div>\n      );\n    // 'done'\n    else\n      return (\n        <FlowItemRow\n          info={this.state.info.post}\n          replies={this.state.info.data}\n          color_picker={this.color_picker}\n          show_sidebar={this.props.show_sidebar}\n          search_param={this.props.search_param}\n          token={this.props.token}\n          is_quote={true}\n          from_msg={!!this.props.from_msg}\n        />\n      );\n  }\n}\n\nfunction FlowChunk(props) {\n  return (\n    <TokenCtx.Consumer>\n      {({ value: token }) => (\n        <div className=\"flow-chunk\">\n          {!!props.title && <TitleLine text={props.title} />}\n          {props.list.map((info, ind) => (\n            <LazyLoad\n              key={info.pid}\n              offset={500}\n              height=\"15em\"\n              hiddenIfInvisible={false}\n            >\n              <div>\n                <FlowItemRow\n                  info={info}\n                  show_sidebar={props.show_sidebar}\n                  token={token}\n                  search_param={props.search_param}\n                  color_picker={null}\n                />\n              </div>\n            </LazyLoad>\n          ))}\n        </div>\n      )}\n    </TokenCtx.Consumer>\n  );\n}\n\nexport class Flow extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      mode: props.mode,\n      search_param: props.search_text,\n      loaded_pages: 0,\n      chunks: {\n        title: '',\n        data: [],\n      },\n      announcement: '',\n      has_update: false,\n      loading_status: 'done',\n      error_msg: null,\n    };\n    this.on_scroll_bound = this.on_scroll.bind(this);\n    window.LATEST_POST_ID = parseInt(localStorage['_LATEST_POST_ID'], 10) || 0;\n  }\n\n  load_page(page) {\n    const failed = (err) => {\n      console.error(err);\n      this.setState((prev, props) => ({\n        loaded_pages: prev.loaded_pages - 1,\n        loading_status: 'failed',\n        error_msg: '' + err,\n      }));\n    };\n\n    if (page > this.state.loaded_pages + 1) throw new Error('bad page');\n    if (page === this.state.loaded_pages + 1) {\n      if (this.state.mode === 'list') {\n        API.get_list(page, this.props.token)\n          .then((json) => {\n            let announcement = this.state.announcement;\n            let has_update = this.state.has_update;\n            if (page === 1 && json.data.length) {\n              // update latest_post_id\n              let max_id = -1;\n              json.data.forEach((x) => {\n                if (parseInt(x.pid, 10) > max_id) max_id = parseInt(x.pid, 10);\n              });\n              localStorage['_LATEST_POST_ID'] = '' + max_id;\n              if (json.config) {\n                if (json.config.announcement) {\n                  announcement = json.config.announcement;\n                }\n                let versions_remote = json.config.web_frontend_version\n                  .substring(1)\n                  .split('.');\n                console.log('remote version:', versions_remote);\n                if (process.env.REACT_APP_BUILD_INFO) {\n                  let versions_local = process.env.REACT_APP_BUILD_INFO.substring(\n                    1,\n                  ).split('.');\n                  if (versions_remote.length >= 3) {\n                    if (\n                      versions_remote[0] > versions_local[0] ||\n                      (versions_remote[1] - versions_local[1] > 0 &&\n                        versions_remote[0] === versions_local[0]) ||\n                      (versions_remote[0] === versions_local[0] &&\n                        versions_remote[1] === versions_local[1] &&\n                        versions_remote[2] - versions_local[2] > 0)\n                    ) {\n                      has_update = true;\n                      DoUpdate(\n                        versions_remote[0] > versions_local[0] ||\n                          versions_remote[1] > versions_local[1],\n                      );\n                    }\n                  }\n                }\n              }\n            }\n            const finished = json.data.length === 0;\n            json.data.forEach((item, ind) => {\n              let comments = json.comments[item.pid];\n              if (!comments) {\n                comments = [];\n              }\n              json.data[ind].comments = comments;\n              json.data[ind].comments.forEach((item) => {\n                item.variant = {};\n              });\n            });\n            this.setState((prev, props) => ({\n              chunks: {\n                title: 'News Feed',\n                data: prev.chunks.data.concat(\n                  json.data.filter(\n                    (x) =>\n                      prev.chunks.data.length === 0 ||\n                      !prev.chunks.data\n                        .slice(-100)\n                        .some((p) => p.pid === x.pid),\n                  ),\n                ),\n              },\n              announcement: announcement,\n              has_update: has_update,\n              mode: finished ? 'list_finished' : 'list',\n              loading_status: 'done',\n            }));\n          })\n          .catch(failed);\n      } else if (this.state.mode === 'search') {\n        API.get_search(page, this.state.search_param, this.props.token)\n          .then((json) => {\n            const finished = json.data.length === 0;\n\n            json.data.forEach((item, ind) => {\n              let comments = json.comments[item.pid];\n              if (!comments) {\n                comments = [];\n              }\n              json.data[ind].comments = comments;\n              json.data[ind].comments.forEach((item) => {\n                item.variant = {};\n              });\n            });\n            this.setState((prev, props) => ({\n              chunks: {\n                title: 'Result for \"' + this.state.search_param + '\"',\n                data: prev.chunks.data.concat(\n                  json.data.filter(\n                    (x) =>\n                      prev.chunks.data.length === 0 ||\n                      !prev.chunks.data\n                        .slice(-100)\n                        .some((p) => p.pid === x.pid),\n                  ),\n                ),\n              },\n              mode: finished ? 'search_finished' : 'search',\n              loading_status: 'done',\n            }));\n          })\n          .catch(failed);\n      } else if (this.state.mode === 'single') {\n        const pid = parseInt(this.state.search_param.substr(1), 10);\n        API.load_replies(pid, this.props.token, new ColorPicker())\n          .then((json) => {\n            this.setState({\n              chunks: {\n                title: 'PID = ' + pid,\n                data: [json.post],\n              },\n              mode: 'single_finished',\n              loading_status: 'done',\n            });\n          })\n          .catch(failed);\n      } else if (this.state.mode === 'attention') {\n        let use_search = !!this.state.search_param;\n        if (use_search) {\n          API.get_search(page, this.state.search_param, this.props.token, true)\n            .then((json) => {\n              const finished = json.data.length === 0;\n              this.setState((prev, props) => ({\n                chunks: {\n                  title:\n                    'Result for \"' +\n                    this.state.search_param +\n                    '\" in Attention List',\n                  data: prev.chunks.data.concat(\n                    json.data.filter(\n                      (x) =>\n                        prev.chunks.data.length === 0 ||\n                        !prev.chunks.data\n                          .slice(-100)\n                          .some((p) => p.pid === x.pid),\n                    ),\n                  ),\n                },\n                mode: finished ? 'attention_finished' : 'attention',\n                loading_status: 'done',\n              }));\n            })\n            .catch(failed);\n        } else {\n          API.get_attention(page, this.props.token)\n            .then((json) => {\n              const finished = json.data.length === 0;\n              this.setState((prev, props) => ({\n                chunks: {\n                  title: 'Attention List',\n                  data: prev.chunks.data.concat(\n                    json.data.filter(\n                      (x) =>\n                        prev.chunks.data.length === 0 ||\n                        !prev.chunks.data\n                          .slice(-100)\n                          .some((p) => p.pid === x.pid),\n                    ),\n                  ),\n                },\n                mode: finished ? 'attention_finished' : 'attention',\n                loading_status: 'done',\n              }));\n            })\n            .catch(failed);\n        }\n      } else {\n        console.log('nothing to load');\n        return;\n      }\n\n      this.setState((prev, props) => ({\n        loaded_pages: prev.loaded_pages + 1,\n        loading_status: 'loading',\n        error_msg: null,\n      }));\n    }\n  }\n\n  on_scroll(event) {\n    if (event.target === document) {\n      const avail =\n        document.body.scrollHeight - window.scrollY - window.innerHeight;\n      if (avail < window.innerHeight && this.state.loading_status === 'done')\n        this.load_page(this.state.loaded_pages + 1);\n    }\n  }\n\n  componentDidMount() {\n    this.load_page(1);\n    window.addEventListener('scroll', this.on_scroll_bound);\n    window.addEventListener('resize', this.on_scroll_bound);\n  }\n  componentWillUnmount() {\n    window.removeEventListener('scroll', this.on_scroll_bound);\n    window.removeEventListener('resize', this.on_scroll_bound);\n  }\n\n  render() {\n    not_show_deleted = localStorage['NOT_SHOW_DELETED'] === 'on';\n    let show_pid = load_single_meta(this.props.show_sidebar, this.props.token);\n    return (\n      <div className=\"flow-container\">\n        {this.state.announcement &&\n          this.state.announcement !== localStorage['hide_announcement'] && (\n            <div className=\"box flow-item box-announcement\">\n              <HighlightedMarkdown\n                text={this.state.announcement}\n                color_picker={this.color_picker}\n                show_pid={show_pid}\n              />\n              <a\n                onClick={() => {\n                  localStorage['hide_announcement'] = this.state.announcement;\n                  this.setState({ announcement: '' });\n                }}\n              >\n                [隐藏此公告]\n              </a>\n            </div>\n          )}\n\n        {this.state.has_update ? (\n          <div className=\"box flow-item box-warning\">\n            <p>检测到更新，正在更新树洞...</p>\n            <p>\n              <a onClick={DoUpdate}>[强制更新]</a>\n            </p>\n          </div>\n        ) : (\n          <FlowChunk\n            title={this.state.chunks.title}\n            list={this.state.chunks.data}\n            mode={this.state.mode}\n            search_param={this.state.search_param || null}\n            show_sidebar={this.props.show_sidebar}\n          />\n        )}\n        {this.state.loading_status === 'failed' && (\n          <div className=\"aux-margin\">\n            <div className=\"box box-tip\">\n              <p>\n                <a\n                  onClick={() => {\n                    this.load_page(this.state.loaded_pages + 1);\n                  }}\n                >\n                  重新加载\n                </a>\n              </p>\n              <p>{this.state.error_msg}</p>\n            </div>\n          </div>\n        )}\n        <TitleLine\n          text={\n            this.state.loading_status === 'loading' ? (\n              <span>\n                <span className=\"icon icon-loading\" />\n                &nbsp;Loading...\n              </span>\n            ) : (\n              '© ' + process.env.REACT_APP_COPYRIGHT_STRING\n            )\n          }\n        />\n      </div>\n    );\n  }\n}\n","import { API } from './flows_api';\n\nconst LATEST_MESSAGE_KEY = '_LATEST_MESSAGE_ID';\nconst MAX_DISPLAY_COUNT = 9;\n\nexport function read_latest_id() {\n  return parseInt(localStorage.getItem(LATEST_MESSAGE_KEY)) || 0;\n}\n\nexport class PollingManager {\n  constructor({ token }) {\n    this.polling_timer = null;\n    this.unread_count = 0;\n    this.token = token;\n    this.latest_messages = [];\n\n    this.fetch_messages_bound = this.fetch_messages.bind(this);\n\n    this.pubSubKey = PubSub.subscribe(\n      'MessageCountShouldUpdate',\n      (msg, params = {}) => this.update(params.messages, params.callback_key),\n    );\n\n    this.setup_timer();\n  }\n\n  cleanup() {\n    this.clear_timer();\n    PubSub.unsubscribe(this.pubSubKey);\n  }\n\n  setup_timer() {\n    this.clear_timer();\n\n    const interval = parseInt(config.polling_interval);\n    if (interval > 0) {\n      setInterval(this.fetch_messages_bound, interval * 1000);\n      this.fetch_messages();\n    }\n  }\n\n  clear_timer() {\n    if (this.polling_timer) clearInterval(this.polling_timer);\n  }\n\n  async update(messages, latest_id = null) {\n    const from_sidebar = latest_id !== null;\n    const latest_cid_map = new Map();\n\n    if (!from_sidebar) latest_id = read_latest_id();\n\n    if (messages) {\n      this.latest_messages = messages;\n\n      if (from_sidebar) {\n        const new_latest_id = messages.reduce(\n          (x, msg) => Math.max(x, msg.id),\n          read_latest_id(),\n        );\n        localStorage.setItem(LATEST_MESSAGE_KEY, new_latest_id);\n      }\n    } else {\n      messages = this.latest_messages;\n    }\n\n    const get_latest_cid = async (pid) => {\n      if (latest_cid_map.has(pid)) {\n        return latest_cid_map.get(pid);\n      } else {\n        const result = await API.get_latest_visited_cid(pid);\n        latest_cid_map.set(pid, result);\n        return result;\n      }\n    };\n\n    const is_new_message = async (msg) => {\n      if (!latest_id || msg.id <= latest_id) return false;\n      if (msg.pid && msg.cid) {\n        const latest_cid = await get_latest_cid(msg.pid);\n        return !latest_cid || msg.cid > latest_cid;\n      }\n      return true;\n    };\n\n    let count = 0;\n\n    for (const msg of messages) {\n      const is_new = await is_new_message(msg);\n      if (is_new) count++;\n      if (msg.variant) msg.variant.is_new = is_new;\n    }\n\n    count = Math.min(count, from_sidebar ? 0 : MAX_DISPLAY_COUNT);\n\n    if (count !== this.unread_count) {\n      this.unread_count = count;\n      PubSub.publish('MessageCountUpdate', count);\n    }\n\n    return messages;\n  }\n\n  async fetch_messages() {\n    if (this.unread_count > MAX_DISPLAY_COUNT) return;\n\n    try {\n      const json = await API.get_messages(\n        1,\n        this.token,\n        true,\n        read_latest_id(),\n      );\n      await this.update(json.data);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n}\n","import React, { createRef, PureComponent } from 'react';\nimport { API } from './flows_api';\nimport { Time, HighlightedMarkdown } from './Common';\nimport LazyLoad from './react-lazyload/src';\nimport { FlowItemQuote, load_single_meta } from './Flows';\nimport './PushMessage.css';\nimport { ColorPicker } from './color_picker';\nimport { read_latest_id } from './polling';\n\n/**\n * @typedef {{\n *  id: number; // message id\n *  pid?: number; // post id\n *  cid?: number; // comment id\n *  timestamp: number;\n *  title: string; // eg. xxx replied #xxx\n *  body: string; // content\n *  type: number;\n * }} PushMessageData\n */\n\n// todo: change icon to bell (control bar)\n// todo (low): choose what to show\n\nexport class PushMessageViewer extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      loading_status: 'idle',\n      loaded_pages: 0,\n      all_loaded: false,\n      /** @type {PushMessageData[]} */\n      messages: [],\n      error_msg: null,\n      latest_id: 0,\n    };\n    this.root = createRef();\n    this.on_scroll_bound = this.on_scroll.bind(this);\n    this.color_picker_map = new Map();\n\n    this.on_message_update_bound = this.on_message_update.bind(this);\n\n    this.pubSubKey = null;\n  }\n\n  componentDidMount() {\n    this.reload_all();\n    this.root.current.parentNode.addEventListener(\n      'scroll',\n      this.on_scroll_bound,\n      false,\n    );\n\n    this.pubSubKey = PubSub.subscribe(\n      'MessageCountUpdate',\n      this.on_message_update_bound,\n    );\n  }\n\n  componentWillUnmount() {\n    this.root.current.parentNode.removeEventListener(\n      'scroll',\n      this.on_scroll_bound,\n      false,\n    );\n\n    PubSub.unsubscribe(this.pubSubKey);\n  }\n\n  on_message_update(msg, count) {\n    //\n  }\n\n  load_page(page) {\n    if (this.state.loading_status === 'loading') return;\n    if (page !== this.state.loaded_pages + 1 || this.state.all_loaded) return;\n    this.setState(\n      {\n        loading_status: 'loading',\n      },\n      () => {\n        API.get_messages(page, this.props.token, true)\n          .then((json) => {\n            for (const msg of json.data) msg.variant = {};\n\n            return this.props.polling_manager.update(\n              json.data,\n              this.state.latest_id,\n            );\n          })\n          .then((messages) => {\n            this.setState((prev, props) => {\n              const visited = new Set(prev.messages.map((msg) => msg.id));\n\n              return {\n                loading_status: 'done',\n                loaded_pages: page,\n                all_loaded: messages.length === 0,\n                messages: prev.messages.concat(\n                  messages.filter((msg) => !visited.has(msg.id)),\n                ),\n              };\n            });\n          })\n          .catch((err) => {\n            console.error(err);\n            this.setState({\n              loading_status: 'failed',\n              error_msg: err.message,\n            });\n          });\n      },\n    );\n  }\n\n  load_more_pages() {\n    this.load_page(this.state.loaded_pages + 1);\n  }\n\n  reload_all() {\n    this.setState(\n      {\n        loaded_pages: 0,\n        messages: [],\n        latest_id: read_latest_id(),\n      },\n      () => this.load_more_pages(),\n    );\n  }\n\n  on_scroll(evt) {\n    const target = evt.target;\n    const avail = target.scrollHeight - target.scrollTop - target.clientHeight;\n    if (avail < target.clientHeight) this.load_more_pages();\n  }\n\n  get_color_picker(pid) {\n    const map = this.color_picker_map;\n    if (map.has(pid)) {\n      return map.get(pid);\n    } else {\n      const color_picker = new ColorPicker();\n      map.set(pid, color_picker);\n      return color_picker;\n    }\n  }\n\n  render() {\n    return (\n      <div ref={this.root} className=\"push-message-container\">\n        <div className=\"box box-tip push-message-hover-bar\">\n          <a onClick={() => this.reload_all()}>\n            <span className=\"icon icon-refresh\" />\n            <label>刷新</label>\n          </a>\n        </div>\n        {this.state.messages.map((msg, index, list) => (\n          <LazyLoad\n            key={msg.id}\n            offset={500}\n            height=\"5em\"\n            overflow={true}\n            once={true}\n          >\n            <PushMessage\n              is_new={msg.variant.is_new}\n              msg={msg}\n              token={this.props.token}\n              show_sidebar={this.props.show_sidebar}\n              color_picker={this.get_color_picker(msg.pid)}\n              cascade={\n                !!msg.pid &&\n                index + 1 < list.length &&\n                list[index + 1].pid === msg.pid\n              }\n            />\n          </LazyLoad>\n        ))}\n        {this.state.loading_status === 'done' && this.state.all_loaded && (\n          <p className=\"box box-tip\">没有更多消息了</p>\n        )}\n        {this.state.loading_status === 'loading' && (\n          <p className=\"box box-tip\">加载中……</p>\n        )}\n        {this.state.loading_status === 'failed' && (\n          <div className=\"box box-tip\">\n            <p>加载失败：{this.state.error_msg}</p>\n            <a onClick={() => this.load_more_pages()}>重新加载</a>\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n\nclass PushMessage extends PureComponent {\n  render() {\n    const show_pid = load_single_meta(\n      this.props.show_sidebar,\n      this.props.token,\n    );\n\n    /** @type {PushMessageData} */\n    const msg = this.props.msg;\n    let content,\n      style = null;\n\n    if (typeof msg.pid === 'number') {\n      // markdown\n\n      // an ugly way to figure out the author\n      const result = msg.title.match(/^(.+)回复了树洞#(\\d+)$/);\n      const author = result ? result[1] : '';\n      const colors = this.props.color_picker.get(author);\n\n      content = (\n        <HighlightedMarkdown\n          author={'[' + author + ']'}\n          text={msg.body}\n          color_picker={this.props.color_picker}\n          show_pid={show_pid}\n        />\n      );\n\n      style = {\n        '--box-bgcolor-light': colors[0],\n        '--box-bgcolor-dark': colors[1],\n      };\n    } else {\n      // plain text\n      content = <pre>{msg.body}</pre>;\n    }\n\n    return (\n      <div\n        className={'push-message-item' + (this.props.cascade ? ' cascade' : '')}\n      >\n        <div key={msg.id} className=\"box push-message-detail\" style={style}>\n          {this.props.is_new && (\n            <div className=\"flow-item-dot flow-item-dot-message\" />\n          )}\n          <div className=\"box-header\">\n            <Time stamp={msg.timestamp} short={true} />\n            <b>{msg.title}</b>\n          </div>\n          <div className=\"box-content\">{content}</div>\n        </div>\n        {msg.pid && !this.props.cascade && (\n          <FlowItemQuote\n            pid={msg.pid}\n            from_msg={true}\n            show_sidebar={this.props.show_sidebar}\n            token={this.props.token}\n            search_param={''}\n            color_picker={this.props.color_picker}\n          />\n        )}\n      </div>\n    );\n  }\n}\n","import React, { PureComponent } from 'react';\n// import {AppSwitcher} from './infrastructure/widgets';\nimport { InfoSidebar, PostForm } from './UserAction';\nimport { TokenCtx } from './UserAction';\n\nimport './Title.css';\nimport { PushMessageViewer } from './PushMessage';\nimport { PollingManager } from './polling';\n\nconst flag_re = /^\\/\\/setflag ([a-zA-Z0-9_]+)=(.*)$/;\n\nclass ControlBar extends PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      search_text: '',\n      new_message_count: 0,\n    };\n    this.set_mode = props.set_mode;\n\n    this.on_change_bound = this.on_change.bind(this);\n    this.on_keypress_bound = this.on_keypress.bind(this);\n    this.do_refresh_bound = this.do_refresh.bind(this);\n    this.do_attention_bound = this.do_attention.bind(this);\n    this.do_hot_posts_bound = this.do_hot_posts.bind(this);\n    this.on_message_update_bound = this.on_message_update.bind(this);\n\n    this.polling_manager = new PollingManager({\n      token: this.props.token,\n    });\n\n    this.pubSubKey = null;\n  }\n\n  componentDidMount() {\n    if (window.location.hash) {\n      let text = decodeURIComponent(window.location.hash).substr(1);\n      if (text.lastIndexOf('?') !== -1)\n        text = text.substr(0, text.lastIndexOf('?')); // fuck wechat '#param?nsukey=...'\n      this.setState(\n        {\n          search_text: text,\n        },\n        () => {\n          this.on_keypress({ key: 'Enter' });\n        },\n      );\n    }\n\n    this.pubSubKey = PubSub.subscribe(\n      'MessageCountUpdate',\n      this.on_message_update_bound,\n    );\n  }\n\n  componentWillUnmount() {\n    this.polling_manager.cleanup();\n    PubSub.unsubscribe('MessageCountUpdate', this.pubSubKey);\n  }\n\n  on_message_update(msg, count) {\n    this.setState({\n      new_message_count: count,\n    });\n  }\n\n  on_change(event) {\n    this.setState({\n      search_text: event.target.value,\n    });\n  }\n\n  on_keypress(event) {\n    if (event.key === 'Enter') {\n      let flag_res = flag_re.exec(this.state.search_text);\n      if (flag_res) {\n        let r = confirm('Please confirm:\\n' + this.state.search_text);\n        if (r === true) {\n          if (flag_res[2]) {\n            localStorage[flag_res[1]] = flag_res[2];\n            alert(\n              'Set Flag ' +\n                flag_res[1] +\n                '=' +\n                flag_res[2] +\n                '\\nYou may need to refresh this webpage.',\n            );\n          } else {\n            delete localStorage[flag_res[1]];\n            alert(\n              'Clear Flag ' +\n                flag_res[1] +\n                '\\nYou may need to refresh this webpage.',\n            );\n          }\n        }\n        return;\n      }\n\n      const mode = /#[0-9]+/.test(this.state.search_text)\n        ? 'single'\n        : this.props.mode !== 'attention'\n        ? 'search'\n        : 'attention';\n      this.set_mode(mode, this.state.search_text || '');\n    }\n  }\n\n  do_refresh() {\n    window.scrollTo(0, 0);\n    this.setState({\n      search_text: '',\n    });\n    this.set_mode('list', null);\n  }\n\n  do_attention() {\n    window.scrollTo(0, 0);\n    this.setState({\n      search_text: '',\n    });\n    this.set_mode('attention', null);\n  }\n\n  do_hot_posts() {\n    window.scrollTo(0, 0);\n    this.setState({\n      search_text: '热榜',\n    });\n    this.set_mode('search', '热榜');\n  }\n\n  render() {\n    return (\n      <TokenCtx.Consumer>\n        {({ value: token }) => (\n          <div className=\"control-bar\">\n            <a\n              className=\"no-underline control-btn\"\n              onClick={this.do_refresh_bound}\n            >\n              <span className=\"icon icon-refresh\" />\n              <span className=\"control-btn-label\">最新</span>\n            </a>\n            {!!token && (\n              <a\n                className=\"no-underline control-btn\"\n                onClick={this.do_attention_bound}\n              >\n                <span className=\"icon icon-attention\" />\n                <span className=\"control-btn-label\">关注</span>\n              </a>\n            )}\n            <a\n              className=\"no-underline control-btn\"\n              onClick={this.do_hot_posts_bound}\n            >\n              <span className=\"icon icon-fire\" />\n              <span className=\"control-btn-label\">热榜</span>\n            </a>\n            <input\n              className=\"control-search\"\n              value={this.state.search_text}\n              placeholder={`${\n                this.props.mode === 'attention' ? '在关注列表中' : ''\n              }搜索 或 #树洞号`}\n              onChange={this.on_change_bound}\n              onKeyPress={this.on_keypress_bound}\n            />\n            <a\n              className=\"no-underline control-btn\"\n              onClick={() => {\n                this.props.show_sidebar(\n                  process.env.REACT_APP_TITLE,\n                  <InfoSidebar show_sidebar={this.props.show_sidebar} />,\n                );\n              }}\n            >\n              <span className={'icon icon-' + (token ? 'about' : 'login')} />\n              <span className=\"control-btn-label\">\n                {token ? '账户' : '登录'}\n              </span>\n            </a>\n            {!!token && (\n              <a\n                className=\"no-underline control-btn\"\n                onClick={() => {\n                  this.props.show_sidebar(\n                    '发表树洞',\n                    <PostForm\n                      token={token}\n                      action={'dopost'}\n                      pid={'new_post'}\n                      on_complete={() => {\n                        this.props.show_sidebar(null, null, 'clear');\n                        this.do_refresh();\n                      }}\n                    />,\n                  );\n                }}\n              >\n                <span className=\"icon icon-plus\" />\n                <span className=\"control-btn-label\">发表</span>\n              </a>\n            )}\n            {!!token && (\n              /* use bell icon here, update icomoon */\n              <a\n                className=\"no-underline control-btn\"\n                onClick={() => {\n                  this.props.show_sidebar(\n                    '消息列表',\n                    <PushMessageViewer\n                      token={token}\n                      show_sidebar={this.props.show_sidebar}\n                      polling_manager={this.polling_manager}\n                    />,\n                  );\n                }}\n              >\n                {this.state.new_message_count > 0 && (\n                  <div className=\"control-btn-dot\">\n                    {this.state.new_message_count}\n                  </div>\n                )}\n                <span className=\"icon icon-bell\" />\n                <span className=\"control-btn-label\">消息</span>\n              </a>\n            )}\n          </div>\n        )}\n      </TokenCtx.Consumer>\n    );\n  }\n}\n\nexport function Title(props) {\n  return (\n    <div className=\"title-bar\">\n      {/* <AppSwitcher appid=\"hole\" /> */}\n      <div className=\"aux-margin\">\n        <div className=\"title\">\n          <p className=\"centered-line\">\n            <span\n              onClick={() =>\n                props.show_sidebar(\n                  process.env.REACT_APP_TITLE,\n                  <InfoSidebar show_sidebar={props.show_sidebar} />,\n                )\n              }\n            >\n              {process.env.REACT_APP_TITLE}\n            </span>\n          </p>\n        </div>\n        <TokenCtx.Consumer>\n          {({ value: token }) => (\n            <ControlBar\n              show_sidebar={props.show_sidebar}\n              set_mode={props.set_mode}\n              mode={props.mode}\n              token={token}\n            />\n          )}\n        </TokenCtx.Consumer>\n      </div>\n    </div>\n  );\n}\n","import React, { PureComponent } from 'react';\nimport { PushMessageViewer } from './PushMessage';\nimport './Sidebar.css';\n\nexport class Sidebar extends PureComponent {\n  constructor(props) {\n    super(props);\n    // this.sidebar_ref = React.createRef();\n    this.do_close_bound = this.do_close.bind(this);\n    this.do_back_bound = this.do_back.bind(this);\n  }\n\n  do_close() {\n    this.props.show_sidebar(null, null, 'clear');\n  }\n  do_back() {\n    this.props.show_sidebar(null, null, 'pop');\n  }\n\n  render() {\n    // hide old contents to remember state\n    let contents = this.props.stack.map(\n      ({ 1: content }, i) =>\n        content && (\n          <div\n            key={i}\n            className={\n              'sidebar-content ' +\n              (i === this.props.stack.length - 1\n                ? 'sidebar-content-show'\n                : 'sidebar-content-hide') +\n              (content.type === PushMessageViewer ? ' sidebar-no-scroll' : '')\n            }\n          >\n            {content}\n          </div>\n        ),\n    );\n    let cur_title = this.props.stack[this.props.stack.length - 1][0];\n    return (\n      <div\n        className={\n          'sidebar-container ' +\n          (cur_title !== null ? 'sidebar-on' : 'sidebar-off')\n        }\n      >\n        <div\n          className=\"sidebar-shadow\"\n          onClick={this.do_back_bound}\n          onTouchEnd={(e) => {\n            e.preventDefault();\n            e.target.click();\n          }}\n        />\n        <div className=\"sidebar\">{contents}</div>\n        <div className=\"sidebar-title\">\n          <a className=\"no-underline\" onClick={this.do_close_bound}>\n            &nbsp;\n            <span className=\"icon icon-close\" />\n            &nbsp;\n          </a>\n          {this.props.stack.length > 2 && (\n            <a className=\"no-underline\" onClick={this.do_back_bound}>\n              &nbsp;\n              <span className=\"icon icon-back\" />\n              &nbsp;\n            </a>\n          )}\n          {cur_title}\n        </div>\n      </div>\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport Pressure from 'pressure';\n\nimport './PressureHelper.css';\n\nconst THRESHOLD = 0.4;\nconst MULTIPLIER = 25;\nconst BORDER_WIDTH = 500; // also change css!\n\nexport class PressureHelper extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      level: 0,\n      fired: false,\n    };\n    this.callback = props.callback;\n    this.esc_interval = null;\n  }\n\n  do_fire() {\n    if (this.esc_interval) {\n      clearInterval(this.esc_interval);\n      this.esc_interval = null;\n    }\n    this.setState({\n      level: 1,\n      fired: true,\n    });\n    this.callback();\n    window.setTimeout(() => {\n      this.setState({\n        level: 0,\n        fired: false,\n      });\n    }, 300);\n  }\n\n  componentDidMount() {\n    if (window.config.pressure) {\n      Pressure.set(\n        document.body,\n        {\n          change: (force) => {\n            if (!this.state.fired) {\n              if (force >= 0.999) {\n                this.do_fire();\n              } else\n                this.setState({\n                  level: force,\n                });\n            }\n          },\n          end: () => {\n            this.setState({\n              level: 0,\n              fired: false,\n            });\n          },\n        },\n        {\n          polyfill: false,\n          only: 'touch',\n          preventSelect: false,\n        },\n      );\n\n      document.addEventListener('keydown', (e) => {\n        if (!e.repeat && e.key === 'Escape') {\n          if (this.esc_interval) clearInterval(this.esc_interval);\n          this.setState(\n            {\n              level: THRESHOLD / 2,\n            },\n            () => {\n              this.esc_interval = setInterval(() => {\n                let new_level = this.state.level + 0.1;\n                if (new_level >= 0.999) this.do_fire();\n                else\n                  this.setState({\n                    level: new_level,\n                  });\n              }, 30);\n            },\n          );\n        }\n      });\n      document.addEventListener('keyup', (e) => {\n        if (e.key === 'Escape') {\n          if (this.esc_interval) {\n            clearInterval(this.esc_interval);\n            this.esc_interval = null;\n          }\n          this.setState({\n            level: 0,\n          });\n        }\n      });\n    }\n  }\n\n  render() {\n    const pad = MULTIPLIER * (this.state.level - THRESHOLD) - BORDER_WIDTH;\n    return (\n      <div\n        className={\n          'pressure-box' +\n          (this.state.fired ? ' pressure-box-fired' : '') +\n          (this.state.level <= 0.0001 ? ' pressure-box-empty' : '')\n        }\n        style={{\n          left: pad,\n          right: pad,\n          top: pad,\n          bottom: pad,\n        }}\n      />\n    );\n  }\n}\n","import React, { Component } from 'react';\nimport { Flow } from './Flows';\nimport { Title } from './Title';\nimport { Sidebar } from './Sidebar';\nimport { SwitchTransition, CSSTransition } from 'react-transition-group';\nimport { PressureHelper } from './PressureHelper';\nimport { TokenCtx } from './UserAction';\nimport { load_config, bgimg_style } from './Config';\nimport { listen_darkmode } from './old_infrastructure/functions';\nimport { TitleLine } from './old_infrastructure/widgets';\nimport { LoginPopup } from './login';\nimport { cache } from './cache';\nimport './App.css';\n\nconst MAX_SIDEBAR_STACK_SIZE = 10;\n\nfunction DeprecatedAlert(props) {\n  return <div id=\"global-hint-container\" style={{ display: 'none' }} />;\n}\n\nfunction needShowSuicidePrompt(text) {\n  return text && text.indexOf('自杀') !== -1;\n}\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    load_config();\n    listen_darkmode(\n      { default: undefined, light: false, dark: true }[\n        window.config.color_scheme\n      ],\n    );\n    this.state = {\n      sidebar_stack: [[null, null]], // list of [status, content]\n      mode: 'list', // list, single, search, attention\n      search_text: null,\n      flow_render_key: +new Date(),\n      token: localStorage['TOKEN'] || null,\n      override_suicide: false,\n    };\n    this.show_sidebar_bound = this.show_sidebar.bind(this);\n    this.set_mode_bound = this.set_mode.bind(this);\n    this.on_pressure_bound = this.on_pressure.bind(this);\n    // a silly self-deceptive approach to ban guests, enough to fool those muggles\n    //                     document             cookie                    'pku_ip_flag=yes'\n    this.inthu_flag =\n      window[atob('ZG9jdW1lbnQ')][atob('Y29va2ll')].indexOf(\n        atob('dGh1X2lwX2ZsYWc9eWVz'),\n      ) !== -1;\n  }\n\n  static is_darkmode() {\n    if (window.config.color_scheme === 'dark') return true;\n    if (window.config.color_scheme === 'light') return false;\n    else {\n      // 'default'\n      return window.matchMedia('(prefers-color-scheme: dark)').matches;\n    }\n  }\n  componentDidMount() {\n    cache(); // init indexeddb\n  }\n\n  on_pressure() {\n    if (this.state.sidebar_stack.length > 1)\n      this.show_sidebar(null, null, 'clear');\n    else this.set_mode('list', null);\n  }\n\n  show_sidebar(title, content, mode = 'push') {\n    this.setState((prevState) => {\n      let ns = prevState.sidebar_stack.slice();\n      if (mode === 'push') {\n        if (ns.length === 1) {\n          document.body.style.top = `-${window.scrollY}px`;\n          document.body.style.position = 'fixed';\n          document.body.style.width = '100vw'; // Be responsive with fixed position\n        }\n        if (ns.length > MAX_SIDEBAR_STACK_SIZE) ns.splice(1, 1);\n        ns = ns.concat([[title, content]]);\n      } else if (mode === 'pop') {\n        if (ns.length === 1) return;\n        if (ns.length === 2) {\n          const scrollY = document.body.style.top;\n          document.body.style.position = '';\n          document.body.style.top = '';\n          document.body.style.width = '';\n          window.scrollTo(0, parseInt(scrollY || '0') * -1);\n        }\n        ns.pop();\n      } else if (mode === 'replace') {\n        ns.pop();\n        ns = ns.concat([[title, content]]);\n      } else if (mode === 'clear') {\n        const scrollY = document.body.style.top;\n        document.body.style.position = '';\n        document.body.style.top = '';\n        document.body.style.width = '';\n        window.scrollTo(0, parseInt(scrollY || '0') * -1);\n        ns = [[null, null]];\n      } else throw new Error('bad show_sidebar mode');\n      return {\n        sidebar_stack: ns,\n      };\n    });\n  }\n\n  set_mode(mode, search_text) {\n    this.setState({\n      mode: mode,\n      search_text: search_text,\n      flow_render_key: +new Date(),\n    });\n  }\n\n  render() {\n    return (\n      <TokenCtx.Provider\n        value={{\n          value: this.state.token,\n          set_value: (x) => {\n            localStorage['TOKEN'] = x || '';\n            this.setState({\n              token: x,\n            });\n          },\n        }}\n      >\n        <PressureHelper callback={this.on_pressure_bound} />\n        <div className=\"bg-img\" style={bgimg_style()} />\n        <Title\n          show_sidebar={this.show_sidebar_bound}\n          set_mode={this.set_mode_bound}\n          mode={this.state.mode}\n        />\n        <TokenCtx.Consumer>\n          {(token) => (\n            <div className=\"left-container\">\n              <DeprecatedAlert token={token.value} />\n              {!token.value && (\n                <div className=\"flow-item-row aux-margin\">\n                  <div className=\"box box-tip\">\n                    <p>\n                      <LoginPopup token_callback={token.set_value}>\n                        {(do_popup) => (\n                          <a onClick={do_popup}>\n                            <span className=\"icon icon-login\" />\n                            &nbsp;登录到 {process.env.REACT_APP_TITLE}\n                          </a>\n                        )}\n                      </LoginPopup>\n                    </p>\n                  </div>\n                </div>\n              )}\n              {needShowSuicidePrompt(this.state.search_text) &&\n                !this.state.override_suicide && (\n                  <div className=\"flow-item-row\">\n                    <div className=\"flow-item box box-tip\">\n                      <p style={{ textAlign: 'left' }}>需要帮助？</p>\n                      <p style={{ textAlign: 'left' }}>\n                        北京24小时心理援助热线：\n                        <a href=\"tel:01082951332\">010-8295-1332</a>\n                      </p>\n                      <p style={{ textAlign: 'left' }}>\n                        希望24小时热线：\n                        <a href=\"tel:4001619995\">400-161-9995</a>\n                      </p>\n                      <hr />\n                      <p>\n                        <button\n                          onClick={() => {\n                            window.location.href =\n                              'https://www.zhihu.com/question/25082178/answer/106073121';\n                          }}\n                        >\n                          了解更多\n                        </button>\n                        &nbsp; &nbsp; &nbsp;\n                        <button\n                          onClick={() => {\n                            this.setState({\n                              override_suicide: true,\n                            });\n                          }}\n                        >\n                          展示结果\n                        </button>\n                      </p>\n                    </div>\n                  </div>\n                )}\n              {this.inthu_flag || token.value ? (\n                (this.state.override_suicide ||\n                  !needShowSuicidePrompt(this.state.search_text)) && (\n                    <SwitchTransition mode=\"out-in\">\n                      <CSSTransition\n                        key={this.state.flow_render_key}\n                        timeout={100}\n                        classNames=\"flows-anim\"\n                      >\n                        <Flow\n                          key={this.state.flow_render_key}\n                          show_sidebar={this.show_sidebar_bound}\n                          mode={this.state.mode}\n                          search_text={this.state.search_text}\n                          token={token.value}\n                        />\n                      </CSSTransition>\n                    </SwitchTransition>\n                )\n              ) : (\n                <TitleLine text=\"请登录后查看内容\" />\n              )}\n              <br />\n            </div>\n          )}\n        </TokenCtx.Consumer>\n        <Sidebar\n          show_sidebar={this.show_sidebar_bound}\n          stack={this.state.sidebar_stack}\n        />\n      </TokenCtx.Provider>\n    );\n  }\n}\n\nexport default App;\n","import React, { Component } from 'react';\n\nexport class ErrorBoundary extends Component {\n  constructor(props) {\n    super(props);\n    this.state = { error: null };\n  }\n\n  static getDerivedStateFromError(error) {\n    console.log(error);\n    return { error: error };\n  }\n\n  render() {\n    if (this.state.error)\n      return (\n        <div style={{ margin: '1em', userSelect: 'initial' }}>\n          <h1>Frontend Exception</h1>\n          <p>Please report this bug to developers.</p>\n          <hr />\n          <pre>{'' + this.state.error}</pre>\n          <hr />\n          <pre>{this.state.error.stack || '(no stack info)'}</pre>\n        </div>\n      );\n    else return this.props.children;\n  }\n}\n","// In production, we register a service worker to serve assets from local cache.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\n// cached resources are updated in the background.\n\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\n// This link also includes instructions on opting out of this behavior.\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/,\n    ),\n);\n\nexport default function register() {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    // const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\n    // if (publicUrl.origin !== window.location.origin) {\n    // Our service worker won't work if PUBLIC_URL is on a different origin\n    // from what our page is served on. This might happen if a CDN is used to\n    // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\n    // return;\n    // }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Lets check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://goo.gl/SC7cgQ',\n          );\n        });\n      } else {\n        // Is not local host. Just register service worker\n        registerValidSW(swUrl);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then((registration) => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the old content will have been purged and\n              // the fresh content will have been added to the cache.\n              // It's the perfect time to display a \"New content is\n              // available; please refresh.\" message in your web app.\n              console.log('New content is available; please refresh.');\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n            }\n          }\n        };\n      };\n    })\n    .catch((error) => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then((response) => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      if (\n        response.status === 404 ||\n        response.headers.get('content-type').indexOf('javascript') === -1\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then((registration) => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.',\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then((registration) => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport { ErrorBoundary } from './ErrorBoundary';\n//import {elevate} from './infrastructure/elevator';\nimport registerServiceWorker from './registerServiceWorker';\n\n//elevate();\n\nReactDOM.render(\n  <ErrorBoundary>\n    <App />\n  </ErrorBoundary>,\n  document.getElementById('root'),\n);\nregisterServiceWorker();\n"],"sourceRoot":""}